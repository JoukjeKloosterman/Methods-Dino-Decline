# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.001379581786591,0.001477718421852,0.001731782155333,0.001731782155333,0.001731782155333,0.001731782155333,0.001477718421852,0.001131589594074,0.000981660203653,0.000981660203653,0.069899737401717,0.074167238212528,0.075924724893336,0.075924724893336,0.075924724893336,0.075924724893336,0.076362407422847,0.075924724893336,0.075924724893336,0.070108813466908,0.072134920500194,0.073080677533146,0.073713375352254,0.069899737401717,0.073713375352254,0.073713375352254,0.073713375352254,0.073713375352254,0.073713375352254,0.069899737401717,0.069899737401717,0.069899737401717,0.069899737401717,0.069899737401717,0.069899737401717,0.069899737401717,0.069899737401717,0.069899737401717,0.069899737401717,0.073713375352254,0.073713375352254,0.068881002985602,0.068881002985602,0.068881002985602,0.068881002985602,0.068066621118873,0.068881002985602,0.069899737401717,0.068881002985602,0.068066621118873,0.068881002985602,0.068066621118873,0.076400116728715,0.074942282470848,0.069899737401717,0.068881002985602,0.068881002985602,0.068881002985602,0.068881002985602,0.063439017222539,0.063439017222539,0.063439017222539,0.070973679930358)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.148173280545073,0.14812061155097,0.148173280545073,0.148173280545073,0.14812061155097,0.148173280545073,0.148173280545073,0.14823462698529,0.152918695751361,0.180926149675739,0.206885807077244,0.207205151238862,0.207205151238862,0.207205151238862,0.206885807077244,0.206885807077244,0.206885807077244,0.206263572688506,0.206025882861167,0.198277796518632,0.198277796518632,0.198277796518632,0.198277796518632,0.193626556278899,0.198277796518632,0.198277796518632,0.198277796518632,0.198277796518632,0.198277796518632,0.193626556278899,0.193626556278899,0.193626556278899,0.193626556278899,0.193626556278899,0.193626556278899,0.193626556278899,0.193626556278899,0.193626556278899,0.193626556278899,0.198277796518632,0.198277796518632,0.193626556278899,0.193626556278899,0.193626556278899,0.193626556278899,0.193626556278899,0.192247261432487,0.193626556278899,0.193626556278899,0.193626556278899,0.198277796518632,0.198277796518632,0.207205151238862,0.207205151238862,0.206885807077244,0.217927027131868,0.245782546184642,0.299351246520455,0.354478951476706,0.39725920636812,0.47441202158569,0.562132777964384,0.70013692945487)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.055546987310362,0.055546987310362,0.062793012243782,0.064059291859109,0.062793012243782,0.062793012243782,0.064694495124879,0.06816442069821,0.062793012243782,0.054730772996594,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.062545530560821,0.062545530560821,0.062545530560821,0.062545530560821,0.062545530560821,0.063525608697134,0.063525608697134,0.063525608697134,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.058943541848064,0.057984832273586,0.057984832273586,0.055546987310362,0.055546987310362)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.9825690212659,0.42928350136271,0.330283755814361,0.307571309970347,0.289622662043872,0.28342631314352,0.265181308660334,0.24370725173878,0.228169610789311,0.193481822606886,0.171536785871137,0.160272925128511,0.160272925128511,0.15828724770069,0.15828724770069,0.15828724770069,0.15828724770069,0.158553051486478,0.160542350847288,0.160542350847288,0.160542350847288,0.160542350847288,0.160542350847288,0.16246554862411,0.16246554862411,0.16246554862411,0.15828724770069,0.15828724770069,0.15828724770069,0.15828724770069,0.158553051486478,0.158553051486478,0.158628999589474,0.158628999589474,0.158628999589474,0.158553051486478,0.158553051486478,0.158553051486478,0.158553051486478,0.158553051486478,0.158553051486478,0.158553051486478,0.158553051486478,0.158553051486478,0.158628999589474,0.158628999589474,0.158628999589474,0.158628999589474,0.158628999589474,0.158628999589474,0.158628999589474,0.159388901235501,0.160272925128511,0.159388901235501,0.159388901235501,0.158628999589474,0.160542350847288,0.162000236688541,0.163722233489118,0.163722233489118,0.163722233489118,0.16246554862411,0.16246554862411)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.973129438564761,-0.381290397271323,-0.265969058368225,-0.240353148924344,-0.227216518686342,-0.213349974849375,-0.206690266202788,-0.163548206223999,-0.151324888781486,-0.151324888781486,-0.058531348686741,-0.058531348686741,-0.058531348686741,-0.058531348686741,-0.058531348686741,-0.058531348686741,-0.058531348686741,-0.054078576222012,-0.054078576222012,-0.04982148174373,-0.04982148174373,-0.04982148174373,-0.049363088619439,-0.049363088619439,-0.04982148174373,-0.04982148174373,-0.04982148174373,-0.04982148174373,-0.049363088619439,-0.049363088619439,-0.04982148174373,-0.04982148174373,-0.049363088619439,-0.049363088619439,-0.049363088619439,-0.049363088619439,-0.049363088619439,-0.049363088619439,-0.049363088619439,-0.04982148174373,-0.053360921356148,-0.053686770719071,-0.054078576222012,-0.053686770719071,-0.054078576222012,-0.055694904024353,-0.055694904024353,-0.054078576222012,-0.057721660556126,-0.058531348686741,-0.058531348686741,-0.058531348686741,-0.058531348686741,-0.058396948720422,-0.04982148174373,-0.058531348686741,-0.075862402329722,-0.079808625784873,-0.078293838333042,-0.089054919179933,-0.079808625784873,-0.063415739546482,-0.078293838333042)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.065180518284265,0.068439085107214,0.068439085107214,0.068439085107214,0.068439085107214,0.068439085107214,0.068439085107214,0.068439085107214,0.07443471889664,0.085266296654883,0.122994714697344,0.10001575900749,0.10001575900749,0.098949027283503,0.098949027283503,0.098949027283503,0.09816781408008,0.101825392421651,0.098949027283503,0.101825392421651,0.100372038583896,0.100372038583896,0.100372038583896,0.09816781408008,0.09816781408008,0.09816781408008,0.09816781408008,0.09816781408008,0.100372038583896,0.09816781408008,0.09816781408008,0.09816781408008,0.100372038583896,0.100372038583896,0.100372038583896,0.100372038583896,0.100372038583896,0.100372038583896,0.100372038583896,0.100372038583896,0.09816781408008,0.09816781408008,0.09816781408008,0.09816781408008,0.09816781408008,0.09816781408008,0.09816781408008,0.100372038583896,0.09816781408008,0.09816781408008,0.101825392421651,0.100372038583896,0.101825392421651,0.108408883372592,0.12369401725587,0.12369401725587,0.15292069646736,0.214879703553276,0.275910303978969,0.324482730652059,0.455539301460799,0.539743818504497,0.639369384347273)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.078572901165837,0.077780825285896,0.077070736748101,0.077070736748101,0.077031067519811,0.077252491499429,0.077883126146005,0.079285047040192,0.08497494680313,0.110862233656561,0.130189718789433,0.130753090684593,0.130908465283739,0.131207715905488,0.131416543491378,0.132264899232296,0.132309643175985,0.131860413254733,0.131665896492155,0.131504541606624,0.131103902939818,0.130974280851582,0.130741793170942,0.130593289191208,0.130829424022357,0.130883121557018,0.130883121557018,0.130883121557018,0.130687120997587,0.130356645339796,0.130476575409309,0.130560108533362,0.130614832793547,0.130617544611747,0.130681430781352,0.130596328023033,0.130566843066017,0.130637219108874,0.130780894165795,0.131009180513888,0.130917227232602,0.130722798888735,0.130754460522442,0.130634866180533,0.130741317134344,0.130706958639262,0.130780740987654,0.130903756710666,0.131102308734298,0.131285015899261,0.132199398569162,0.132310447973391,0.132949106334538,0.134077651655822,0.135997770049399,0.139535890049908,0.14691657011034,0.152135174749176,0.156854061103869,0.166269349580793,0.179811294018387,0.191832175740747,0.213177046726594)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.270388456781004,0.169945221889698,0.147954209309683,0.139536673723085,0.136015680667767,0.134418917399645,0.131508812966604,0.126577191810838,0.123475968752467,0.118816175606349,0.112610512911212,0.10944396885083,0.1090225860948,0.10873652805031,0.10873652805031,0.108732652820856,0.108732652820856,0.108766243149528,0.108622678355146,0.108622678355146,0.109317246935127,0.109317246935127,0.109312648287518,0.108672156637515,0.108644638994322,0.108644638994322,0.108578745749257,0.108578745749257,0.108605303604637,0.108605303604637,0.108657687129561,0.108552260553763,0.108736411020455,0.108736411020455,0.108736411020455,0.108833369086916,0.108774595246664,0.108774595246664,0.108774595246664,0.108738755634192,0.108738755634192,0.108692098775169,0.108619789394871,0.108619789394871,0.108699790280963,0.108699790280963,0.108684270715862,0.108741654497019,0.108741654497019,0.108704178244077,0.108749140451868,0.108847826506675,0.109104205958624,0.108966297288291,0.108966297288291,0.108891789282194,0.109614310932051,0.109814579198401,0.110847620053905,0.111356773939357,0.111390319443894,0.112156396861965,0.112121112490239)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.191815555615168,-0.092164396603802,-0.070883472561582,-0.062465936974984,-0.058984613147956,-0.057166425900216,-0.0536256868206,-0.047292144770646,-0.038501021949337,-0.007953941949788,0.017579205878221,0.021309121833763,0.021885879188939,0.022471187855178,0.022680015441067,0.02353224641144,0.02357699035513,0.023094170105206,0.023043218137008,0.022881863251477,0.021786656004691,0.021657033916455,0.021429144883424,0.021921132553693,0.022184785028035,0.022238482562695,0.02230437580776,0.02230437580776,0.02208181739295,0.021751341735159,0.021818888279748,0.022007847979599,0.021878421773093,0.021881133591293,0.021945019760898,0.021762958936117,0.021792247819354,0.02186262386221,0.022006298919131,0.022270424879697,0.02217847159841,0.022030700113566,0.022134671127571,0.022015076785662,0.022041526853381,0.022007168358299,0.022096470271792,0.022162102213646,0.022360654237279,0.022580837655185,0.023450258117294,0.023462621466716,0.023844900375914,0.02511135436753,0.027031472761108,0.030644100767714,0.037302259178289,0.042320595550775,0.046006441049964,0.054912575641436,0.068420974574493,0.079675778878782,0.101055934236355)
trans=0.5
age=(0:(130-1))* -1
plot(age,age,type = 'n', ylim = c(0, 0.7701506224003571), xlim = c(-136.5,-60.5), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 1.08082592339249), xlim = c(-136.5,-60.5), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-1.0704423824212372, 0.7033063227820003), xlim = c(-136.5,-60.5), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()