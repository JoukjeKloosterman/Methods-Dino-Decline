# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.025718633643719,0.024027130226156,0.024027130226156,0.024027130226156,0.024467958546362,0.024027130226156,0.024027130226156,0.024027130226156,0.024027130226156,0.024027130226156,0.024467958546362,0.024027130226156,0.025718633643719,0.024027130226156,0.011738356278948,0.014742278763149,0.05253722876431,0.053870147522793)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.152713772760019,0.145508814553762,0.143581482552666,0.143581482552666,0.143581482552666,0.141879338224863,0.1400628683153,0.138428355336599,0.141879338224863,0.141077310457476,0.14366435513668,0.143581482552666,0.149555881557636,0.148953635611427,0.166788469428222,1.178838260712677,1.704483481788875,1.931333593799597)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.020534162017888,0.020042632136658,0.022882839898994,0.018572159513483,0.018572159513483,0.018988652147929,0.019746234011746,0.019746234011746,0.020042632136658,0.019746234011746,0.018988652147929,0.018988652147929,0.015751719426525,0.023202026796625,0.023202026796625,0.018988652147929,0.018988652147929,0.018988652147929)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,1.626285847666804,0.143496747818556,0.140173705036949,0.133253185558621,0.129026209382331,0.128131310979424,0.128131310979424,0.128131310979424,0.128131310979424,0.128131310979424,0.128131310979424,0.128131310979424,0.128131310979424,0.140173705036949,0.14226451166871,0.145009090253426,0.159721959774064,0.288965970133418)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-1.586614222335303,-0.090673335114291,-0.086925920390883,-0.085265136168995,-0.073986560514903,-0.075003492242352,-0.073986560514903,-0.07232180661554,-0.073986560514903,-0.073986560514903,-0.075003492242352,-0.075003492242352,-0.082784544133758,-0.089537525984922,-0.10309852507419,-0.151836662385034,-0.050339177801965,-0.041854514825419)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.14438102721429,0.097156780136571,0.094576816404501,0.094576816404501,0.102466022192663,0.097156780136571,0.094576816404501,0.094576816404501,0.094252815875911,0.094576816404501,0.094576816404501,0.094576816404501,0.094576816404501,0.094252815875911,0.152225437873866,1.113749554556966,1.658475978551758,1.965967155512229)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.082097020854087,0.081310335147974,0.081242788950993,0.081356883987348,0.081207388583926,0.080603946517621,0.079566368972862,0.078619196237848,0.07861005171294,0.07845168438735,0.078702401753062,0.078557913831644,0.079184447175066,0.079782454934342,0.094122490640984,0.360379645986431,0.890584685200621,1.029513379162726)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.373041930850714,0.079494831797392,0.075966507658084,0.075225766619429,0.074301291204388,0.07390517909799,0.073759277353896,0.073797160066147,0.073715180080703,0.073786740685701,0.073955795763711,0.073925585349759,0.074530865986827,0.076402505174849,0.077301994568088,0.079579666789214,0.083695218123419,0.118696948875503)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.290944909996627,0.001815503350581,0.005276281292909,0.006131117367919,0.006906097379538,0.006698767419631,0.005807091618966,0.004822036171701,0.004894871632237,0.004664943701649,0.00474660598935,0.004632328481884,0.004653581188238,0.003379949759493,0.016820496072896,0.280799979197217,0.806889467077202,0.910816430287224)
trans=0.5
age=(0:(85-1))* -1
plot(age,age,type = 'n', ylim = c(0, 2.124466953179557), xlim = c(-89.25,-62.75), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 1.7889144324334847), xlim = c(-89.25,-62.75), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-1.7452756445688336, 2.162563871063452), xlim = c(-89.25,-62.75), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()