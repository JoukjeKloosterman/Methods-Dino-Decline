# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.075999170526496,0.078449654552494,0.081373806480927,0.081373806480927,0.081373806480927,0.081970174169526,0.081970174169526,0.081970174169526,0.081970174169526,0.08214399839996,0.081373806480927,0.081373806480927,0.081373806480927,0.081373806480927,0.081373806480927,0.081373806480927,0.081373806480927,0.081373806480927,0.081373806480927,0.081373806480927,0.081970174169526,0.081970174169526,0.081535322475876,0.081535322475876,0.081373806480927,0.078449654552494,0.077064773714546,0.077064773714546,0.077064773714546,0.077064773714546,0.077064773714546,0.077064773714546,0.077064773714546,0.077064773714546,0.077064773714546,0.076112305890363,0.073898578239971,0.068133539826397,0.068949482130538,0.068133539826397,0.068133539826397,0.068133539826397,0.068133539826397,0.068292764709757,0.068292764709757,0.068133539826397,0.068133539826397,0.068133539826397,0.061989301197753,0.057896707790564,0.068133539826397,0.068133539826397,0.034306583560267,0.02453634110225,0.02453634110225,0.001537164313597,0.074179982020336,0.078449654552494,0.082421474453542,0.078449654552494,0.078449654552494,0.078668549041975,0.076442931580912,0.075999170526496,0.075999170526496,0.075999170526496,0.070266663024555,0.075999170526496,0.075999170526496,0.075999170526496,0.086692376214322,0.082421474453542,0.082421474453542,0.082421474453542,0.067346306804397,0.067346306804397,0.098038411062586,0.101176863880918,0.101176863880918,0.101176863880918,0.101176863880918,0.101176863880918,0.101424113665838,0.101176863880918,0.101176863880918,0.101176863880918,0.101176863880918)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.200699834703932,0.202839694585293,0.201173475304125,0.201173475304125,0.200699834703932,0.200699834703932,0.200699834703932,0.200699834703932,0.200699834703932,0.200699834703932,0.199269770531251,0.199269770531251,0.199269770531251,0.19893170237327,0.199269770531251,0.199269770531251,0.199269770531251,0.199269770531251,0.199269770531251,0.199269770531251,0.200699834703932,0.200699834703932,0.200699834703932,0.200699834703932,0.200699834703932,0.201173475304125,0.200699834703932,0.200699834703932,0.200699834703932,0.200699834703932,0.200699834703932,0.201173475304125,0.201173475304125,0.201173475304125,0.201173475304125,0.200699834703932,0.202409462327293,0.19893170237327,0.201173475304125,0.200699834703932,0.201173475304125,0.202409462327293,0.203462412744354,0.206831448019035,0.20694011286879,0.20694011286879,0.20694011286879,0.211062212274275,0.20694011286879,0.20694011286879,0.222792460620576,0.220815015785303,0.20694011286879,0.20694011286879,0.224021798421827,0.237320680411667,0.41684636571773,0.415524451730926,0.41684636571773,0.415524451730926,0.415524451730926,0.41684636571773,0.41684636571773,0.441974945143624,0.464004825738155,0.517337761903827,1.216759229553621,1.80955000463156,2.845727193835975,3.185738895400776,3.240228742302696,3.242072053529596,3.286208625914407,3.410463326625786,3.456678585251918,3.549508785700622,3.641229927386742,3.662253594246867,3.706856775367336,3.730503773711586,3.786384477536116,3.81546356673325,3.894880289497344,3.894880289497344,3.894880289497344,3.894880289497344,3.894880289497344)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.059402449567119,0.059402449567119,0.06582777959571,0.079960741764046,0.082243682843654,0.083762043306534,0.079960741764046,0.079960741764046,0.079960741764046,0.079960741764046,0.079960741764046,0.079960741764046,0.079960741764046,0.079960741764046,0.079960741764046,0.079960741764046,0.079960741764046,0.079960741764046,0.079960741764046,0.079960741764046,0.079960741764046,0.079960741764046,0.079960741764046,0.079960741764046,0.079960741764046,0.080056333969417,0.080056333969417,0.080056333969417,0.080056333969417,0.080056333969417,0.080056333969417,0.081179813943337,0.081179813943337,0.081179813943337,0.080056333969417,0.080056333969417,0.080056333969417,0.080056333969417,0.080056333969417,0.080056333969417,0.080056333969417,0.080056333969417,0.080056333969417,0.080056333969417,0.081179813943337,0.080056333969417,0.080056333969417,0.080056333969417,0.080056333969417,0.080056333969417,0.080056333969417,0.080056333969417,0.080056333969417,0.080056333969417,0.074410507556755,0.080056333969417,0.080056333969417,0.080056333969417,0.080056333969417,0.077411307364195,0.077411307364195,0.077411307364195,0.077411307364195,0.074410507556755,0.072909065612849,0.072909065612849,0.065187484828274,0.06815449710347,0.059402449567119,0.016086436389486,0.057093753300365,0.057093753300365,0.057093753300365,0.016086436389486,0.043749729692622,0.043749729692622,0.057093753300365,0.016086436389486,0.057093753300365,0.016086436389486,0.057093753300365,0.082265674829774,0.083762043306534,0.083762043306534,0.075536923466216,0.065187484828274,0.075536923466216)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.765219319419386,0.318111397554164,0.228821479457191,0.218912230838517,0.218912230838517,0.218912230838517,0.214204020383094,0.213093483399209,0.212190247178651,0.206472437339991,0.201257651467198,0.19923658160885,0.199055705713859,0.198296281951918,0.197136089987592,0.196856378283781,0.195745751489584,0.196856378283781,0.196856378283781,0.196856378283781,0.196856378283781,0.195745751489584,0.195745751489584,0.195745751489584,0.196856378283781,0.196856378283781,0.196856378283781,0.196856378283781,0.196856378283781,0.197136089987592,0.197136089987592,0.19923658160885,0.19923658160885,0.19923658160885,0.197136089987592,0.197136089987592,0.197136089987592,0.197136089987592,0.197136089987592,0.197136089987592,0.197136089987592,0.197136089987592,0.197136089987592,0.197136089987592,0.19923658160885,0.198296281951918,0.198296281951918,0.198296281951918,0.198296281951918,0.198296281951918,0.199055705713859,0.199055705713859,0.201561955003626,0.20385304823212,0.19923658160885,0.205794994756346,0.207799895600368,0.207799895600368,0.207799895600368,0.207799895600368,0.207799895600368,0.207799895600368,0.207799895600368,0.206472437339991,0.205794994756346,0.207799895600368,0.207799895600368,0.218989942613748,0.329816644512825,1.064616026653941,1.564172049186824,2.075406062781077,2.578825861858514,2.700980587411317,3.004007538261835,3.051079308449716,3.301606332073664,3.414147155553996,3.585428485977686,3.585428485977686,3.789955070211819,3.831021881379864,3.831021881379864,3.831021881379864,3.831021881379864,3.831021881379864,3.881828215291714)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.682665380172041,-0.207800175622013,-0.108746152984598,-0.108746152984598,-0.093401181332175,-0.093401181332175,-0.09797680434378,-0.093401181332175,-0.093401181332175,-0.092109380115084,-0.091204420290926,-0.092109380115084,-0.091204420290926,-0.091204420290926,-0.091204420290926,-0.091204420290926,-0.093062541859947,-0.091204420290926,-0.091204420290926,-0.08072077613456,-0.091204420290926,-0.091204420290926,-0.091958306478091,-0.091958306478091,-0.089803443699804,-0.091204420290926,-0.091204420290926,-0.091204420290926,-0.091204420290926,-0.091204420290926,-0.091204420290926,-0.091204420290926,-0.091204420290926,-0.091204420290926,-0.091204420290926,-0.091204420290926,-0.091204420290926,-0.091204420290926,-0.091204420290926,-0.099089517303173,-0.095551357396192,-0.093062541859947,-0.095551357396192,-0.093062541859947,-0.095551357396192,-0.097177032062909,-0.097177032062909,-0.09797680434378,-0.099089517303173,-0.101972229168693,-0.091204420290926,-0.091204420290926,-0.119910895632913,-0.100646056988068,-0.119831803617636,-0.132917780044908,-0.132917780044908,-0.098451885676836,-0.100646056988068,-0.098451885676836,-0.093062541859947,-0.098451885676836,-0.098451885676836,-0.088138877786172,-0.096341119277234,-0.091408879993505,-0.236077900254978,-0.236077900254978,-0.229213215076846,-0.364037953110385,-1.11411517808495,-1.79778233056634,-1.907337986597058,-2.30746374430345,-2.91147481212402,-2.929046274560053,-2.747180359798432,-2.91147481212402,-2.902633358429731,-2.902633358429731,-2.91147481212402,-3.446253001463212,-3.251884575789804,-3.283759000034782,-3.341098216032732,-3.341098216032732,-2.948938127679466)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.104174400966208,0.104174400966208,0.097972296526232,0.077946413056273,0.086672709163661,0.084524558595752,0.077946413056273,0.081091628427816,0.077946413056273,0.07489438736825,0.070852023203845,0.068311056283946,0.068311056283946,0.068311056283946,0.068311056283946,0.068133866615767,0.065806751013792,0.068133866615767,0.067669680370353,0.077946413056273,0.068311056283946,0.068311056283946,0.068311056283946,0.068311056283946,0.071187162564547,0.07017374712968,0.070852023203845,0.07017374712968,0.07017374712968,0.07017374712968,0.07017374712968,0.070852023203845,0.070852023203845,0.070852023203845,0.07017374712968,0.070852023203845,0.074843159510622,0.07558116783088,0.077946413056273,0.07558116783088,0.077946413056273,0.077946413056273,0.077946413056273,0.077946413056273,0.077946413056273,0.077946413056273,0.077946413056273,0.077946413056273,0.077946413056273,0.077946413056273,0.093308957002431,0.088074065128039,0.077946413056273,0.101854924238329,0.093308957002431,0.118754242487425,0.239050701627732,0.305381567007659,0.305381567007659,0.324335630511845,0.326568706011883,0.324335630511845,0.326568706011883,0.359604858429017,0.36729428252509,0.449624215458585,1.116809539805689,1.749546446788013,3.126314721119017,3.553689650963298,3.669062348748594,3.45614244557535,3.947424855353533,3.880944984326924,3.529745723616224,3.45614244557535,3.522802094214487,3.522802094214487,3.522802094214487,3.522802094214487,3.466701139895194,2.900788012866215,3.040333798231562,3.040333798231562,3.040333798231562,3.040333798231562,3.466701139895194)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.134743815060049,0.134917996072569,0.135539828655602,0.135550237940511,0.135676215377825,0.135678665578666,0.135678665578666,0.135731394090507,0.135731394090507,0.135683898414808,0.135483723889636,0.135483723889636,0.135483723889636,0.135513181415661,0.135605765863767,0.135605765863767,0.135605765863767,0.135573412932391,0.135573412932391,0.135573412932391,0.135149038265339,0.135123638224789,0.134980712666353,0.134953674509135,0.134729922030469,0.13423823295599,0.134183370811035,0.133944281612669,0.133944281612669,0.133944281612669,0.133899487348657,0.133821353984156,0.133762392039947,0.133762392039947,0.133497851351413,0.13334314861112,0.132596359360525,0.131910339807839,0.131695806612136,0.131519296822734,0.131328359802478,0.131134638186629,0.130967602828494,0.131176765696939,0.131070666602116,0.130955643984461,0.13100689109087,0.130872329698377,0.130990864998065,0.131570621955237,0.131865222417876,0.132392317280287,0.133882342481071,0.135626848681427,0.137949352187495,0.145685756203497,0.161570654834967,0.17368851981569,0.176545639051634,0.178606993023866,0.177914878082659,0.178543779016865,0.17999580339705,0.18363326911987,0.189774378969351,0.202088794151827,0.295696788952741,0.445088563950109,0.69496774140668,0.840260259280683,0.939637760166729,0.984012029011116,1.034074583701218,1.100914631420236,1.143985386897127,1.186621542270034,1.232842728159584,1.264004807178469,1.306675950941108,1.332832265658272,1.38125643127453,1.412148874051176,1.443765705082876,1.450890021338196,1.452132145506436,1.452646088970216,1.449926657522081)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.232231368938303,0.165576015304839,0.15164172497122,0.146588270851536,0.145642288102476,0.145361179406265,0.145168414000075,0.145068322238437,0.144666338960175,0.142654371793481,0.14032344420302,0.139300358847079,0.138953762798579,0.13883923369705,0.138674962869277,0.138398535257446,0.138290073483885,0.138182169165411,0.137624303851621,0.137333811536157,0.137333811536157,0.137242199271783,0.137242199271783,0.137197121349193,0.137300119220261,0.137369176521983,0.137369176521983,0.137369176521983,0.137369176521983,0.137499912824079,0.137474214781503,0.137634499157479,0.137635886018176,0.137632127107831,0.137732582273879,0.137732582273879,0.137732582273879,0.137879467531581,0.137879467531581,0.137912126527188,0.137906700508856,0.137891281307876,0.137891281307876,0.137891281307876,0.138075841314022,0.138160525472631,0.138229912627284,0.138521342213581,0.138529055275577,0.138576740579683,0.13878385505623,0.138948795340861,0.139437267137885,0.140225404575889,0.140421644853809,0.141253246409805,0.14198501726095,0.1423170854121,0.142427218177638,0.142596921465034,0.142423932263831,0.142447827901443,0.142447827901443,0.142843451665706,0.143097381689931,0.143937923097535,0.145977368152526,0.153640320414971,0.193311610931623,0.258309317462536,0.318013105289337,0.395885030357744,0.511643270478556,0.57610202498954,0.671725100074742,0.747732921171431,0.842484487144806,0.920783779402668,1.015280677724888,1.082483304371895,1.18312741751586,1.277819161915233,1.311187716952808,1.317889868876663,1.335819831144006,1.348303562862168,1.363177172598403)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.097487553878254,-0.03065801923227,-0.016101896315618,-0.011038032911025,-0.00996607272465,-0.009682513827599,-0.009489748421409,-0.00933692814793,-0.008934944869668,-0.006970473378673,-0.004839720313383,-0.003816634957443,-0.003470038908943,-0.003326052281389,-0.003069197005509,-0.002792769393679,-0.002684307620118,-0.00260875623302,-0.00205089091923,-0.001760398603766,-0.002184773270817,-0.002118561046994,-0.00226148660543,-0.002243446840058,-0.002570197189792,-0.003130943565992,-0.003185805710947,-0.003424894909314,-0.003424894909314,-0.00355563121141,-0.003574727432846,-0.003813145173323,-0.003873493978229,-0.003869735067884,-0.004234730922466,-0.004389433662759,-0.005136222913353,-0.005969127723741,-0.006183660919445,-0.006392829704454,-0.006578340706379,-0.006756643121248,-0.006923678479382,-0.006714515610937,-0.007005174711906,-0.00720488148817,-0.007223021536414,-0.007649012515204,-0.007538190277512,-0.007006118624447,-0.006918632638355,-0.006556478060575,-0.005554924656814,-0.004598555894461,-0.002472292666314,0.004432509793692,0.019585637574018,0.03137143440359,0.034118420873996,0.036010071558832,0.035490945818828,0.036095951115422,0.037547975495608,0.040789817454164,0.04667699727942,0.058150871054292,0.149719420800214,0.291448243535138,0.501656130475057,0.581950941818147,0.621624654877392,0.588126998653373,0.522431313222662,0.524812606430697,0.472260286822385,0.438888621098603,0.390358241014777,0.343221027775801,0.291395273216219,0.250348961286378,0.198129013758669,0.134329712135943,0.132577988130068,0.133000152461533,0.116312314362429,0.104342526108049,0.086749484923678)
trans=0.5
age=(0:(154-1))* -1
plot(age,age,type = 'n', ylim = c(0, 4.284368318447079), xlim = c(-161.7,-59.3), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 4.270011036820885), xlim = c(-161.7,-59.3), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-3.790878301609533, 4.342167340888887), xlim = c(-161.7,-59.3), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()