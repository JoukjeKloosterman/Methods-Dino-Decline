# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.19635703741539,0.19635703741539,0.180322483646013,0.038749648920372,0.024949740761015,0.024486127286281,0.029886122204579,0.03066891530423,0.03066891530423,0.03066891530423,0.03066891530423,0.03066891530423,0.027062865849285,0.025460592446863,0.029419365957107,0.025632158588751,0.025460592446863,0.036245656033542,0.093312730550287,0.0313168958941,0.019976734715033,0.011615055942392,0.009442261481154,0.019976734715033,0.020679902225237,0.020860395446528,0.021491959444198,0.02389905337577,0.02389905337577,0.02389905337577,0.024150747674445,0.024596797350916,0.024906949541604,0.024906949541604,0.024906949541604,0.024596797350916,0.02389905337577,0.02389905337577,0.02389905337577,0.021491959444198,0.019976734715033,0.021491959444198,0.019976734715033,0.016804397195098,0.019976734715033)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.574593158030899,0.576557027520544,0.608982762802307,0.456850054725646,0.303732389644808,0.103055678307032,0.097793297537593,0.097793297537593,0.097793297537593,0.097793297537593,0.097793297537593,0.097793297537593,0.097793297537593,0.097793297537593,0.108271809060272,0.108271809060272,0.229305888181694,0.989255379199927,1.060771935882075,1.004185327902246,0.612351840940069,0.380017066108065,0.249533891610563,0.190235421622003,0.181586266822169,0.181586266822169,0.181586266822169,0.183211509797562,0.182565092624989,0.181586266822169,0.181586266822169,0.181586266822169,0.181586266822169,0.181586266822169,0.181586266822169,0.181586266822169,0.181586266822169,0.181586266822169,0.181586266822169,0.181586266822169,0.183211509797562,0.189906193807885,0.192167500541762,0.203953821540043,0.226057457607152)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.249730803082594,0.265406543508158,0.264768296934707,0.257142703090091,0.033559497345791,0.031867548902901,0.0356971367414,0.036333734210363,0.036333734210363,0.036333734210363,0.036333734210363,0.036333734210363,0.036333734210363,0.036333734210363,0.036333734210363,0.036333734210363,0.036333734210363,0.036333734210363,0.036333734210363,0.0356971367414,0.032602879070587,0.031867548902901,0.030960478411619,0.027420481703115,0.020543044381188,0.011175212740457,0.011175212740457,0.011175212740457,0.011175212740457,0.011175212740457,0.011175212740457,0.007521429543872,0.007521429543872,0.007521429543872,0.007521429543872,0.007521429543872,0.007521429543872,0.006862732763422,0.006862732763422,0.006862732763422,0.006224272943371,0.006224272943371,0.006224272943371,0.006018488613524,0.006047321902232)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.743137672348405,0.657801402439331,0.650238553640659,0.64777809361668,0.573741804198021,0.085703506801743,0.085881006803165,0.085881006803165,0.085703506801743,0.085703506801743,0.085703506801743,0.085703506801743,0.085703506801743,0.085703506801743,0.085443914017747,0.085443914017747,0.085443914017747,0.085703506801743,0.085881006803165,0.085881006803165,0.084793020963329,0.087489914529659,0.091684409491073,0.091684409491073,0.091684409491073,0.084793020963329,0.085443914017747,0.085443914017747,0.085881006803165,0.085443914017747,0.085881006803165,0.082528170742988,0.082528170742988,0.082528170742988,0.082528170742988,0.082528170742988,0.082528170742988,0.082361930598748,0.082361930598748,0.082528170742988,0.082272832722108,0.082361930598748,0.082361930598748,0.082272832722108,0.084320981438354)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.423280912482017,-0.342832740654864,-0.364640913405553,-0.553051506103183,-0.583318507908168,-0.044275504770548,-0.039778659192749,-0.039628959777626,-0.036832813163355,-0.036832813163355,-0.036832813163355,-0.039778659192749,-0.039778659192749,-0.039778659192749,-0.043353659806937,-0.044038860987531,-0.062886760807316,-0.028771100818088,0.041360012695593,-0.028322120078787,-0.048022752515911,-0.057012448816953,-0.056168076498404,-0.056168076498404,-0.045046407751268,-0.056168076498404,-0.057012448816953,-0.057012448816953,-0.056168076498404,-0.056168076498404,-0.054611974151625,-0.05097756677044,-0.048022752515911,-0.048022752515911,-0.048022752515911,-0.05097756677044,-0.048022752515911,-0.043036902241198,-0.043036902241198,-0.042002563855246,-0.048022752515911,-0.044270737811754,-0.041928894653068,-0.048022752515911,-0.057105229862176)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.234085844457261,0.166405189612269,0.157595706440712,0.094357292962749,0.056383295850808,0.063840042187272,0.046594393861812,0.046329613995934,0.048544576204306,0.048544576204306,0.048544576204306,0.047139836763658,0.052077231003339,0.052469655972731,0.052469655972731,0.059093427751534,0.167001447617196,0.929325774131688,1.014730686611857,0.9517192901657,0.55928951838782,0.316184667141822,0.201713274193371,0.14140191656893,0.142335307136812,0.131474585193116,0.128967959527698,0.128967959527698,0.128967959527698,0.128967959527698,0.128967959527698,0.131282730129764,0.131282730129764,0.131282730129764,0.131282730129764,0.131282730129764,0.134422858866547,0.142335307136812,0.142335307136812,0.146290394598643,0.146290394598643,0.160197683022956,0.167001447617196,0.17356873772679,0.189494530067233)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.362530785416293,0.361025572683476,0.352859121575999,0.232426347173737,0.092322679362335,0.064454513048525,0.061183256018633,0.061055983271394,0.061055983271394,0.061067294869574,0.061042576571608,0.061523387590032,0.062426064324563,0.062802238580877,0.063547065747952,0.064595353998007,0.082819634308082,0.552138300627805,0.626033124067714,0.500391640851413,0.179797291554314,0.120008303785579,0.107641540916918,0.096927733302997,0.093357451940059,0.093124822618937,0.092950503772731,0.092989918153191,0.092774292994148,0.092919889599266,0.092610904024382,0.092513883224929,0.092409817225477,0.092353569179759,0.092439135482161,0.092734320043415,0.093075793464434,0.093013554087012,0.093056707212631,0.093632137253353,0.095096814093659,0.097768626968001,0.100293043807565,0.105864766331225,0.112754045323242)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.485142918447668,0.455486599394606,0.454056410871983,0.454504715331546,0.331034553996212,0.063463687257069,0.059207423882881,0.058936341504547,0.058897583956293,0.058867422489139,0.058867422489139,0.058980474839757,0.058980474839757,0.058864441286763,0.058806518500197,0.058806518500197,0.058799637705305,0.058750831507461,0.058705703080633,0.05837209531781,0.05800137250446,0.057079764875028,0.056461134151373,0.055982057112095,0.055255426622456,0.05490525234432,0.054661303651014,0.05451965317728,0.054357492700214,0.054228623399798,0.054024563375724,0.054009560387043,0.054034017646072,0.054034017646072,0.053988448039972,0.053959119882998,0.053938509975419,0.054320385892629,0.054275826732428,0.054309630772057,0.05427268411375,0.05431302027214,0.05431302027214,0.054371119557321,0.054622306120422)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.122612133031375,-0.09446102671113,-0.101197289295984,-0.222078368157809,-0.238711874633877,0.000990825791456,0.001975832135752,0.002119641766848,0.002158399315101,0.002199872380435,0.002175154082469,0.002542912750275,0.003445589484806,0.003937797294114,0.004740547247755,0.00578883549781,0.024019996602777,0.493387469120344,0.567327420987081,0.442019545533603,0.121795919049854,0.06292853891055,0.051180406765545,0.040945676190902,0.038102025317603,0.038219570274617,0.038289200121717,0.038470264975911,0.038416800293933,0.038691266199468,0.038586340648657,0.038504322837886,0.038375799579405,0.038319551533687,0.038450687442189,0.038775200160418,0.039137283489015,0.038693168194382,0.038780880480203,0.039322506481296,0.040824129979909,0.04345560669586,0.045980023535425,0.051493646773904,0.05813173920282)
trans=0.5
age=(0:(112-1))* -1
plot(age,age,type = 'n', ylim = c(0, 1.1668491294702827), xlim = c(-117.6,-61.4), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 0.8174514395832455), xlim = c(-117.6,-61.4), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-0.6416503586989848, 1.1162037552730428), xlim = c(-117.6,-61.4), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()