# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.063566992015484,0.063566992015484,0.062614721324815,0.062614721324815,0.062614721324815,0.067974146039606,0.069385693825972,0.067974146039606,0.068349376244257,0.068349376244257,0.068349376244257,0.068349376244257,0.068349376244257,0.067974146039606,0.067974146039606,0.067974146039606,0.066287496047887,0.049910713171155)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.354960552609456,0.349358032334951,0.317419960403778,0.267318242969244,0.172675551106946,0.158077096480337,0.158077096480337,0.156788564580462,0.15687827932477,0.15687827932477,0.15687827932477,0.15687827932477,0.15687827932477,0.156788564580462,0.15687827932477,0.158077096480337,0.159308847649181,0.168465104890583)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.257114767909933,0.262764928720884,0.266358590734786,0.27403585857334,0.208763098409026,0.059257798790206,0.028224538680937,0.027058353456372,0.027058353456372,0.021534817027237,0.027058353456372,0.027058353456372,0.02749570587542,0.021060613811595,0.016221485523442,0.007032566712355,0.005735607733559,0.005735607733559)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.802032111840301,0.767523064907439,0.741419455708948,0.739519017097906,0.734078373021528,0.65061835335848,0.475726721044478,0.153970869148741,0.125920772924022,0.116586202718644,0.120797415031436,0.117020697590471,0.117020697590471,0.108958029634688,0.108958029634688,0.100603029535033,0.097379414031277,0.097778545991182)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.678160619090155,-0.680995453390032,-0.590136337887532,-0.581932218555889,-0.575818998326605,-0.539442737963841,-0.368995943957989,-0.050817704650323,-0.029644960403592,-0.028068950758714,-0.028068950758714,-0.025936507197898,-0.020293571254957,-0.003973795445979,-0.003973795445979,-0.003973795445979,-0.003686612472129,-0.029644960403592)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.006174336638523,-0.060939398284267,-0.040156605203954,-0.079253568729551,-0.028068950758714,0.069227814003191,0.109802932250822,0.117041396848122,0.110828494143167,0.109802932250822,0.109567253689924,0.110828494143167,0.109802932250822,0.119023317041285,0.117423720200359,0.11616478716262,0.11825937526044,0.128559138722071)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.148430577639072,0.14795436998517,0.139392232944765,0.131970430487187,0.120402403302487,0.11403816991548,0.113262338854033,0.113188625298772,0.112978375413316,0.11276311030191,0.112800584022834,0.112800584022834,0.112809219998301,0.112692732693162,0.112522056289448,0.112249045720597,0.113496404784138,0.132157029063949)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.512773269599773,0.504207458613824,0.485479881982357,0.479482519543429,0.461872160978056,0.432138248827276,0.145123567903385,0.074202128145327,0.068283543648421,0.067704369085026,0.067544254892345,0.067280241485062,0.065236188160093,0.062767659498566,0.059578978044335,0.057617249139699,0.057302657040563,0.05691703088559)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.364342691960701,-0.356253088628654,-0.346087649037592,-0.347512089056241,-0.341469757675569,-0.318100078911796,-0.031861229049352,0.038986497153445,0.044694831764895,0.045058741216884,0.045256329130489,0.045520342537772,0.047573031838208,0.049925073194597,0.052943078245113,0.054631796580898,0.056193747743575,0.075239998178358)
trans=0.5
age=(0:(85-1))* -1
plot(age,age,type = 'n', ylim = c(0, 0.39045660787040165), xlim = c(-89.25,-62.75), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 0.8822353230243312), xlim = c(-89.25,-62.75), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-0.7490949987290353, 0.1414150525942781), xlim = c(-89.25,-62.75), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()