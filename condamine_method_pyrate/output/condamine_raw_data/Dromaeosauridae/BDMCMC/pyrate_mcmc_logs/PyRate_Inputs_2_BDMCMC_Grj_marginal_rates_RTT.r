# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.072924970269021,0.072924970269021,0.072924970269021,0.072924970269021,0.073102925462542,0.073102925462542,0.073102925462542,0.073188070705867,0.073188070705867,0.073188070705867,0.073188070705867,0.073188070705867,0.073102925462542,0.073188070705867,0.072924970269021,0.072924970269021,0.073102925462542,0.073102925462542,0.073102925462542,0.073102925462542,0.073102925462542,0.073102925462542,0.073102925462542,0.073102925462542,0.072924970269021,0.072924970269021,0.072924970269021,0.072924970269021,0.072924970269021,0.072924970269021,0.072924970269021,0.073102925462542,0.073606925142276,0.073457227623739,0.073188070705867,0.073188070705867,0.073102925462542,0.073102925462542,0.073102925462542,0.073102925462542,0.073102925462542,0.073102925462542,0.073102925462542,0.073102925462542,0.073102925462542,0.073457227623739,0.073457227623739,0.073457227623739,0.073102925462542,0.072924970269021,0.072924970269021,0.072924970269021,0.072924970269021,0.072924970269021,0.072924970269021,0.072924970269021,0.073457227623739,0.073457227623739,0.073457227623739,0.073457227623739,0.073457227623739,0.070602002904395,0.073457227623739,0.073457227623739,0.073457227623739,0.073457227623739,0.073457227623739,0.073102925462542,0.073102925462542,0.073102925462542,0.073102925462542,0.068994780138392,0.068994780138392,0.068994780138392,0.068641745121134,0.068641745121134,0.068641745121134,0.068641745121134,0.068994780138392,0.072924970269021,0.068994780138392,0.068641745121134,0.068994780138392,0.068641745121134,0.068994780138392,0.068641745121134,0.06734542242343)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.14033105787625,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.138990883852041,0.138990883852041,0.138990883852041,0.138990883852041,0.138990883852041,0.138990883852041,0.138990883852041,0.138990883852041,0.138990883852041,0.138990883852041,0.138651022840334,0.138651022840334,0.138651022840334,0.138651022840334,0.138651022840334,0.138651022840334,0.138651022840334,0.138990883852041,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139666410851607,0.139849991123904,0.139849991123904,0.139849991123904,0.139666410851607,0.139666410851607,0.139666410851607,0.139849991123904,0.14033105787625,0.14033105787625,0.141037279088188,0.141610208141958,0.142489562523107,0.142489562523107,0.142489562523107,0.142489562523107,0.142489562523107,0.139849991123904,0.14301314479321,0.14301314479321,0.14301314479321,0.14301314479321,0.14301314479321,0.14301314479321,0.14301314479321,0.14301314479321,0.14301314479321,0.139666410851607,0.139666410851607,0.139666410851607,0.139849991123904,0.14033105787625,0.14033105787625,0.141037279088188,0.142489562523107,0.148382588069393,0.145739823983236,0.145739823983236,0.146567826018654,0.147104017619735,0.148382588069393,0.148955969056641,0.152168081741841)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.052066653467415,0.051912646557284,0.051912646557284,0.051912646557284,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.053542851659056,0.051912646557284,0.053542851659056,0.051912646557284,0.052066653467415,0.051912646557284,0.051912646557284,0.052066653467415,0.052066653467415,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.051393072940869,0.051393072940869,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.051912646557284,0.052066653467415,0.052066653467415,0.051393072940869,0.051393072940869)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.117119345769772,0.11597392868658,0.11597392868658,0.11597392868658,0.11728096504009,0.11728096504009,0.117119345769772,0.117119345769772,0.116817069771704,0.116817069771704,0.116817069771704,0.116817069771704,0.116817069771704,0.116817069771704,0.116817069771704,0.116817069771704,0.114906217693324,0.114906217693324,0.114906217693324,0.114906217693324,0.114906217693324,0.114906217693324,0.114906217693324,0.114906217693324,0.114906217693324,0.114906217693324,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.117119345769772,0.11728096504009,0.11728096504009,0.11728096504009,0.11597392868658,0.11728096504009,0.11597392868658,0.116325523985738,0.11597392868658,0.11597392868658,0.116325523985738,0.116325523985738,0.116507957476086,0.116911161695519,0.117119345769772,0.117119345769772,0.11728096504009,0.117706017422514,0.118639150383708,0.118639150383708,0.118639150383708,0.118639150383708,0.118639150383708,0.120570069177642,0.120570069177642,0.120570069177642,0.120570069177642,0.120570069177642,0.120570069177642,0.120570069177642,0.120570069177642,0.120858810653868,0.120858810653868,0.120858810653868,0.120858810653868)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.023534362315559,-0.021535880020806,-0.021535880020806,-0.021535880020806,-0.020279282804423,-0.020279282804423,-0.020055951319172,-0.020055951319172,-0.020279282804423,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.019650156126563,-0.020055951319172,-0.020055951319172,-0.019650156126563,-0.019650156126563,-0.019650156126563,-0.019650156126563,-0.019650156126563,-0.019650156126563,-0.019650156126563,-0.019650156126563,-0.020279282804423,-0.020279282804423,-0.019650156126563,-0.019650156126563,-0.019650156126563,-0.019650156126563,-0.019650156126563,-0.019650156126563,-0.019650156126563,-0.019650156126563,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.016610349396762,-0.020279282804423,-0.020633403501116,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.020055951319172,-0.017462694229759,-0.020055951319172,-0.017462694229759,-0.020055951319172,-0.020279282804423,-0.020055951319172,-0.020055951319172,-0.019650156126563,-0.020279282804423,-0.020279282804423,-0.020055951319172,-0.020279282804423,-0.020279282804423,-0.021535880020806,-0.021535880020806,-0.020279282804423,-0.020279282804423,-0.021535880020806,-0.024732832322265,-0.029290703281067,-0.034479221904553,-0.034479221904553,-0.035222447718779,-0.024732832322265,-0.035222447718779,-0.033204299323843,-0.035222447718779)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.070525147585084,0.068593312275394,0.068593312275394,0.068593312275394,0.068593312275394,0.068593312275394,0.068593312275394,0.068465561743354,0.067270802293439,0.067270802293439,0.067270802293439,0.067270802293439,0.067270802293439,0.067270802293439,0.067117214718589,0.067117214718589,0.067270802293439,0.067270802293439,0.067270802293439,0.067270802293439,0.067270802293439,0.067270802293439,0.067270802293439,0.067270802293439,0.066288261447081,0.066288261447081,0.067270802293439,0.067270802293439,0.067270802293439,0.067270802293439,0.067270802293439,0.067270802293439,0.067270802293439,0.067475085902582,0.067270802293439,0.067270802293439,0.067270802293439,0.067475085902582,0.067475085902582,0.067475085902582,0.067475085902582,0.067475085902582,0.067475085902582,0.067475085902582,0.067475085902582,0.067270802293439,0.067270802293439,0.067475085902582,0.067475085902582,0.067475085902582,0.067475085902582,0.067270802293439,0.070749089489675,0.067475085902582,0.067475085902582,0.068465561743354,0.068593312275394,0.068465561743354,0.068465561743354,0.068465561743354,0.070749089489675,0.068465561743354,0.070749089489675,0.068465561743354,0.068593312275394,0.069670214591329,0.069670214591329,0.070749089489675,0.069670214591329,0.069670214591329,0.070525147585084,0.070749089489675,0.070749089489675,0.070525147585084,0.072244682255774,0.076625073673827,0.076625073673827,0.076625073673827,0.076625073673827,0.076625073673827,0.074407806260142,0.075928998059461,0.076625073673827,0.094060829007896,0.085947441550604,0.094060829007896,0.101157459223661)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.106278484916162,0.105838707277203,0.105813406536669,0.105842356277411,0.105664610697887,0.105690919055158,0.105690919055158,0.105610293899213,0.105610293899213,0.105685908912791,0.105685908912791,0.105758503817675,0.105832812433024,0.106545752337157,0.106610413471837,0.106610413471837,0.106341859564193,0.106341859564193,0.106341859564193,0.106341859564193,0.106350233436319,0.106334725876438,0.106359369915699,0.106378947858491,0.106330209913307,0.106277902159107,0.106277902159107,0.106305372573493,0.106305283961479,0.106291659246474,0.106291659246474,0.106235824759892,0.106242371282485,0.106133752603526,0.105998493926599,0.105998493926599,0.105985014780137,0.105934842170187,0.105934842170187,0.105934842170187,0.105934842170187,0.105934842170187,0.105934842170187,0.105965980420815,0.105918971414031,0.105995909824994,0.105995909824994,0.105961424106283,0.105936001294253,0.1059895553978,0.1059895553978,0.106074494280601,0.106207755693354,0.106207755693354,0.106264439109599,0.106458935530605,0.106558303262966,0.106588587558393,0.106588587558393,0.106599187787945,0.106599187787945,0.106786900500394,0.106724428872408,0.106724428872408,0.106724428872408,0.106734836390969,0.106708484793316,0.106729622651856,0.106857213310768,0.106857213310768,0.106857213310768,0.106972215908804,0.106970458690588,0.106970458690588,0.107065504431025,0.107233344687383,0.107233344687383,0.10737097868121,0.107696848534754,0.109315492664187,0.109914063313897,0.110061900194097,0.110396695023485,0.111778623946714,0.113769598046213,0.115152514085017,0.117443308525596)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.091084107320814,0.085030603511091,0.085030603511091,0.085030603511091,0.084666409468514,0.084711267382687,0.084455361608126,0.084467285428621,0.084368325626084,0.084351073049234,0.084330839969152,0.084330839969152,0.084330839969152,0.084330839969152,0.084330839969152,0.084330839969152,0.084276009185073,0.084276009185073,0.084276009185073,0.084276009185073,0.084311221525787,0.084311221525787,0.084311221525787,0.084311221525787,0.084311221525787,0.084311221525787,0.084350338873118,0.084350338873118,0.084350338873118,0.084350338873118,0.084350338873118,0.084350338873118,0.084350338873118,0.084350338873118,0.084372681019493,0.084372681019493,0.084348253306724,0.08432958741618,0.084349529390665,0.084349529390665,0.084357148622876,0.084357148622876,0.084373162013104,0.084373162013104,0.084373162013104,0.084373162013104,0.084357423651578,0.084357423651578,0.084357423651578,0.084357423651578,0.084357423651578,0.084357423651578,0.084392224104558,0.08446434057924,0.08446434057924,0.084436281750762,0.084465933525996,0.084373769819147,0.084283812819149,0.084240811457482,0.084181722388037,0.084191528584178,0.084092730405242,0.083970154917124,0.08378865606294,0.083623173208387,0.083570291521827,0.08358762456203,0.083550514168925,0.083490066253124,0.083376611914768,0.083376611914768,0.083376611914768,0.083306195460334,0.083279131801785,0.083078578056129,0.083038662449382,0.083038662449382,0.083055491424921,0.083070077925786,0.083070077925786,0.08313401912493,0.08313401912493,0.08304652406624,0.08304652406624,0.083384721968722,0.08338653671002)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.015194377595347,0.020808103766112,0.020782803025577,0.02081175276632,0.020998201229373,0.02097965167247,0.021235557447032,0.021143008470592,0.021241968273129,0.021334835863556,0.021355068943639,0.021427663848523,0.021501972463872,0.022214912368006,0.022279573502685,0.022279573502685,0.02206585037912,0.02206585037912,0.02206585037912,0.02206585037912,0.022039011910532,0.022023504350651,0.022048148389912,0.022067726332704,0.02201898838752,0.02196668063332,0.021927563285989,0.021955033700375,0.021954945088361,0.021941320373356,0.021941320373356,0.021885485886774,0.021892032409367,0.021783413730408,0.021625812907106,0.021625812907106,0.021636761473413,0.021605254754007,0.021585312779522,0.021585312779522,0.021577693547311,0.021577693547311,0.021561680157083,0.021592818407712,0.021545809400927,0.02162274781189,0.021638486173416,0.021604000454705,0.021578577642675,0.021632131746223,0.021632131746223,0.021717070629024,0.021815531588796,0.021743415114114,0.021800098530359,0.022022653779843,0.02209236973697,0.022214817739246,0.022304774739244,0.022358376330463,0.022417465399908,0.022595371916216,0.022631698467166,0.022754273955284,0.022935772809468,0.023111663182582,0.023138193271489,0.023141998089826,0.023306699141843,0.023367147057644,0.023480601396001,0.023595603994036,0.023593846775821,0.023664263230254,0.02378637262924,0.024154766631254,0.024194682238002,0.024332316231828,0.024641357109833,0.026245414738401,0.02684398538811,0.026927881069168,0.027262675898555,0.028732099880474,0.030723073979973,0.031767792116295,0.034056771815575)
trans=0.5
age=(0:(154-1))* -1
plot(age,age,type = 'n', ylim = c(0, 0.1673848899160251), xlim = c(-161.7,-59.3), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 0.1329446917192548), xlim = c(-161.7,-59.3), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-0.0387446924906569, 0.11127320514602711), xlim = c(-161.7,-59.3), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()