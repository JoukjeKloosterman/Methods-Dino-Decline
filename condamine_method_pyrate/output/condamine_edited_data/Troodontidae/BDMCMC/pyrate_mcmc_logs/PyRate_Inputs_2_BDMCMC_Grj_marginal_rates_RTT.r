# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.300989319855644,0.287374727563927,0.294477566590678,0.301169051643091,0.300989319855644,0.300989319855644,0.298110787765595,0.300989319855644,0.301804384680959,0.300989319855644,0.300989319855644,0.298110787765595,0.300112530742879,0.300112530742879,0.300112530742879,0.300112530742879,0.300112530742879,0.300112530742879,0.298110787765595,0.298110787765595,0.300112530742879,0.300112530742879,0.300112530742879,0.300112530742879,0.301169051643091,0.301169051643091,0.301169051643091,0.301169051643091,0.300112530742879,0.300112530742879,0.300112530742879,0.298110787765595,0.300112530742879,0.300989319855644,0.300112530742879,0.300112530742879,0.297945349809654,0.297945349809654,0.297945349809654,0.297945349809654,0.297945349809654,0.297945349809654,0.297945349809654,0.297945349809654,0.297945349809654,0.297945349809654,0.297945349809654,0.300112530742879,0.300112530742879,0.300112530742879,0.300112530742879,0.297945349809654,0.297945349809654,0.297945349809654,0.297945349809654,0.294477566590678,0.296827072456884,0.296827072456884,0.296827072456884,0.284412180316262,0.296827072456884,0.284412180316262,0.284412180316262,0.278319997396262,0.278319997396262,0.278319997396262,0.272262964115502,0.272262964115502,0.272262964115502,0.272262964115502,0.272262964115502,0.272262964115502,0.272262964115502,0.287374727563927,0.287374727563927,0.287374727563927,0.287374727563927,0.272262964115502,0.284412180316262,0.284412180316262,0.284412180316262,0.284412180316262,0.281864679757631,0.284412180316262,0.281864679757631,0.284412180316262,0.284412180316262,0.272262964115502,0.272262964115502,0.284412180316262,0.281864679757631,0.281864679757631,0.284412180316262,0.28478425628116,0.284412180316262)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.64103195277744,0.615364747913967,0.615364747913967,0.615364747913967,0.612989718459302,0.612989718459302,0.609603762065395,0.612989718459302,0.615364747913967,0.612989718459302,0.612989718459302,0.609603762065395,0.609603762065395,0.609603762065395,0.609603762065395,0.608610789063934,0.608610789063934,0.609603762065395,0.609603762065395,0.609603762065395,0.612989718459302,0.612989718459302,0.612989718459302,0.612989718459302,0.615364747913967,0.615364747913967,0.615364747913967,0.615364747913967,0.615364747913967,0.615364747913967,0.617042079329068,0.617042079329068,0.622211480720485,0.622211480720485,0.622211480720485,0.624344102547172,0.623226023508044,0.623226023508044,0.62689127677883,0.624344102547172,0.624344102547172,0.62689127677883,0.62689127677883,0.6315765353821,0.6315765353821,0.6315765353821,0.6315765353821,0.631924746817562,0.631924746817562,0.631924746817562,0.631924746817562,0.631924746817562,0.633757275840684,0.6315765353821,0.631924746817562,0.62689127677883,0.631924746817562,0.633757275840684,0.633757275840684,0.623226023508044,0.642948772220085,0.64103195277744,0.64103195277744,0.642948772220085,0.642948772220085,0.656631776109389,0.652456886499526,0.652456886499526,0.656631776109389,0.665594740936827,0.670490324434632,0.670490324434632,0.670490324434632,0.693311094864426,0.693311094864426,0.693311094864426,0.693311094864426,0.670490324434632,0.692340252331034,0.693311094864426,0.693311094864426,0.693311094864426,0.693311094864426,0.693311094864426,0.693311094864426,0.693311094864426,0.691409464180163,0.670490324434632,0.670490324434632,0.693311094864426,0.693311094864426,0.693311094864426,0.693311094864426,0.697118164311879,0.697118164311879)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.292070749474244,0.261439893323933,0.261439893323933,0.265911986568154,0.266531177596707,0.279986313971446,0.279986313971446,0.28781338295997,0.279986313971446,0.28781338295997,0.28781338295997,0.289757345558576,0.289757345558576,0.292070749474244,0.289757345558576,0.289757345558576,0.289757345558576,0.289757345558576,0.289757345558576,0.28781338295997,0.28781338295997,0.28781338295997,0.279986313971446,0.289757345558576,0.28781338295997,0.28781338295997,0.289757345558576,0.289757345558576,0.289757345558576,0.28781338295997,0.28781338295997,0.28781338295997,0.28781338295997,0.28781338295997,0.289757345558576,0.28781338295997,0.289757345558576,0.289757345558576,0.283539289566228,0.279986313971446,0.26141436001737,0.266531177596707,0.266531177596707,0.266531177596707,0.266531177596707,0.279986313971446,0.279986313971446,0.266531177596707,0.266531177596707,0.266531177596707,0.266531177596707,0.292070749474244,0.293648606889613,0.266531177596707,0.266531177596707,0.266746850158054,0.266746850158054,0.266531177596707,0.266531177596707,0.266531177596707,0.266531177596707,0.289757345558576,0.249722450717622,0.248998426335716,0.28781338295997,0.28781338295997,0.28781338295997,0.292070749474244,0.28781338295997,0.248998426335716,0.28781338295997,0.238493658948187,0.235940358929459,0.235940358929459,0.248998426335716,0.248998426335716,0.255865638968508,0.255865638968508,0.266531177596707,0.255865638968508,0.255865638968508,0.266531177596707,0.248998426335716,0.28781338295997,0.28781338295997,0.28781338295997,0.285649059509584,0.28781338295997,0.28781338295997,0.266531177596707,0.250956162370829,0.238493658948187,0.238493658948187,0.229232919424304,0.229232919424304)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.666871494614961,0.624339179414115,0.624339179414115,0.624339179414115,0.621668894202412,0.621668894202412,0.621668894202412,0.624339179414115,0.6188089441814,0.624339179414115,0.6188089441814,0.621668894202412,0.621668894202412,0.621668894202412,0.621668894202412,0.621668894202412,0.621668894202412,0.621668894202412,0.621668894202412,0.621668894202412,0.624339179414115,0.624339179414115,0.619744748427304,0.629989992629846,0.629989992629846,0.629989992629846,0.629989992629846,0.629989992629846,0.629989992629846,0.621668894202412,0.621668894202412,0.621668894202412,0.621668894202412,0.621668894202412,0.629989992629846,0.624339179414115,0.629989992629846,0.629989992629846,0.629989992629846,0.629989992629846,0.613498435934916,0.622589924527032,0.622589924527032,0.621668894202412,0.621668894202412,0.629989992629846,0.629989992629846,0.621668894202412,0.621668894202412,0.622589924527032,0.624339179414115,0.652522962594816,0.652522962594816,0.624339179414115,0.624339179414115,0.622762201407959,0.622762201407959,0.622762201407959,0.624339179414115,0.624339179414115,0.624339179414115,0.652522962594816,0.622762201407959,0.624339179414115,0.669448595115515,0.669448595115515,0.669448595115515,0.681866541845074,0.692569779652774,0.6521806198145,0.694790049046189,0.650012802412748,0.6521806198145,0.6521806198145,0.669448595115515,0.669448595115515,0.681866541845074,0.681866541845074,0.694790049046189,0.681866541845074,0.681866541845074,0.694790049046189,0.669448595115515,0.694790049046189,0.694790049046189,0.694790049046189,0.681866541845074,0.681866541845074,0.681866541845074,0.656852668142985,0.6521806198145,0.650012802412748,0.6521806198145,0.6521806198145,0.6521806198145)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.253792796013349,-0.236572210841802,-0.226019309258083,-0.221317017274188,-0.213861365477522,-0.226019309258083,-0.225033620204407,-0.225033620204407,-0.226019309258083,-0.213861365477522,-0.213861365477522,-0.212794434481549,-0.212794434481549,-0.212794434481549,-0.212794434481549,-0.213861365477522,-0.212794434481549,-0.212794434481549,-0.212794434481549,-0.212794434481549,-0.213861365477522,-0.195872210547952,-0.213861365477522,-0.194887435158882,-0.195872210547952,-0.194887435158882,-0.194887435158882,-0.195872210547952,-0.195872210547952,-0.195872210547952,-0.195872210547952,-0.195872210547952,-0.213861365477522,-0.195872210547952,-0.213861365477522,-0.205521082727392,-0.210169507403753,-0.210169507403753,-0.210169507403753,-0.210169507403753,-0.211731385390271,-0.223403400307486,-0.223403400307486,-0.226019309258083,-0.226019309258083,-0.228152178403202,-0.228152178403202,-0.226019309258083,-0.223403400307486,-0.226019309258083,-0.226019309258083,-0.226019309258083,-0.226019309258083,-0.226019309258083,-0.226019309258083,-0.220007474521699,-0.226019309258083,-0.226019309258083,-0.226019309258083,-0.226019309258083,-0.23503938392701,-0.23503938392701,-0.238483318693397,-0.252374857311358,-0.239840820890573,-0.239840820890573,-0.244366497972864,-0.252374857311358,-0.278280204017664,-0.278280204017664,-0.301168592036863,-0.313995188430921,-0.313995188430921,-0.325237263578124,-0.325237263578124,-0.313995188430921,-0.325237263578124,-0.313995188430921,-0.325237263578124,-0.325237263578124,-0.325237263578124,-0.343313265458484,-0.325237263578124,-0.313995188430921,-0.313995188430921,-0.301168592036863,-0.278280204017664,-0.23503938392701,-0.23503938392701,-0.23503938392701,-0.23503938392701,-0.23503938392701,-0.23503938392701,-0.23503938392701,-0.23503938392701)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.226721109813143,0.226721109813143,0.226721109813143,0.225809967055306,0.225809967055306,0.206198057058679,0.206198057058679,0.206198057058679,0.203309682328131,0.210763043259659,0.208892634056414,0.206198057058679,0.206198057058679,0.206198057058679,0.206198057058679,0.203309682328131,0.206198057058679,0.206198057058679,0.206198057058679,0.206198057058679,0.208892634056414,0.225809967055306,0.206198057058679,0.225809967055306,0.225809967055306,0.225809967055306,0.225809967055306,0.225809967055306,0.230823605322782,0.225809967055306,0.225809967055306,0.225809967055306,0.212420402089863,0.225809967055306,0.214869178338886,0.225809967055306,0.225809967055306,0.225809967055306,0.225809967055306,0.225809967055306,0.225809967055306,0.225809967055306,0.225809967055306,0.225809967055306,0.225809967055306,0.225809967055306,0.225809967055306,0.224347508906039,0.225809967055306,0.223864591677801,0.224347508906039,0.225809967055306,0.224347508906039,0.223864591677801,0.224347508906039,0.225809967055306,0.223864591677801,0.224347508906039,0.224347508906039,0.225809967055306,0.224347508906039,0.250874103704596,0.251298951067919,0.272248778688267,0.299263374955101,0.321269874193049,0.321269874193049,0.332808522965846,0.332808522965846,0.352448308072561,0.332808522965846,0.332808522965846,0.36173230642309,0.36173230642309,0.36173230642309,0.36173230642309,0.36173230642309,0.36173230642309,0.372996235737053,0.36173230642309,0.36173230642309,0.36173230642309,0.36173230642309,0.329289989515133,0.329289989515133,0.332808522965846,0.321269874193049,0.329289989515133,0.321269874193049,0.319526270679562,0.315799390042705,0.319526270679562,0.319526270679562,0.323318885096951,0.323318885096951)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.445038314970722,0.446897623964836,0.448949434406336,0.450581234938302,0.451243157453338,0.451243157453338,0.451503462145246,0.452584941488227,0.453343688321638,0.453937975697796,0.453937975697796,0.453460194147203,0.453610279840105,0.453466565611063,0.453462312705775,0.45361158784632,0.453642993188434,0.454090471770441,0.45376332737965,0.45376332737965,0.454489566286687,0.454562058249466,0.453818544618424,0.453669690130382,0.45378082141683,0.453756952306041,0.453620133528494,0.45380087339864,0.453359526116101,0.453536623861018,0.453881829203752,0.45419219537508,0.455225165486379,0.455662709664052,0.458820498416309,0.460927923512088,0.462277056639983,0.46245400239019,0.466995449132184,0.467021431723821,0.467021431723821,0.467997696343303,0.467997696343303,0.470534101228153,0.470813807727107,0.470813807727107,0.470927923532146,0.464931785433389,0.464484318154382,0.464151545149665,0.464151545149665,0.462351261427067,0.462015087323991,0.45871643074483,0.458441817168411,0.454286036122375,0.454799579037569,0.45520427018868,0.45520427018868,0.4555516602109,0.45975103870027,0.472564091890966,0.472302581035855,0.475794405716089,0.476383770796874,0.478140616454807,0.478638129719984,0.480389210874982,0.481233127983544,0.482272364063859,0.482319303852989,0.483610187275824,0.483610187275824,0.4843635280846,0.4843635280846,0.484251030250489,0.48373185642432,0.481713890829349,0.481548040186459,0.481956645765357,0.481954241768471,0.481903168974368,0.480916760403511,0.477265401225354,0.478340815984799,0.473164220530315,0.469599061154908,0.469350549873876,0.469198997349366,0.470164246209597,0.469126103289961,0.469115866181499,0.468447054472359,0.469348356411614,0.47001782447904)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.465995789140004,0.461297673536752,0.460806964807249,0.459698959350896,0.458736170756725,0.455582406453633,0.452415019145217,0.449604940466263,0.448044679333885,0.446648957450868,0.446091557608462,0.446191932106718,0.446191932106718,0.446392521197666,0.446553664410339,0.44671845058081,0.446644933086733,0.44688158456149,0.44688158456149,0.447977933327833,0.448344135682588,0.448148514020211,0.448210071762691,0.448169473882041,0.44914183502628,0.448677864704189,0.44860322375853,0.448681119855066,0.448681119855066,0.449278403980723,0.44932105984223,0.448511989114568,0.447323899182696,0.447323899182696,0.448745578377564,0.449317824015802,0.450048399354797,0.450048399354797,0.450107151562329,0.45172811259063,0.452619281291535,0.456212675190139,0.456212675190139,0.456039618595034,0.455654088881906,0.455202803407337,0.455478172250963,0.454840526721968,0.455209396064206,0.455900229196236,0.45610571815745,0.456353013156773,0.455870180504737,0.455441009599862,0.455220124623112,0.45181420250905,0.447526160752162,0.446372489476858,0.446077088345595,0.446190746974776,0.446461182542089,0.452533933668131,0.457808036855581,0.46526064055243,0.467537953687292,0.469932527815648,0.470136687926805,0.486974761731458,0.491540271350998,0.491301183060725,0.493448705255656,0.494827943342779,0.496301342470794,0.496133281594429,0.496750435173214,0.496968631281604,0.499106979193775,0.49915136878645,0.50214665356441,0.50258200357172,0.502627149231784,0.503052630248341,0.500343876308711,0.492727763687517,0.49063862652008,0.487218971692966,0.484148285909985,0.464538101513758,0.456441700013324,0.454418953914517,0.452694253313161,0.449782756764764,0.449037119696904,0.448792399965424,0.44929124625808)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.020957474169283,-0.014400049571915,-0.011857530400913,-0.009117724412594,-0.007493013303387,-0.004339249000295,-0.000911556999971,0.002980001021963,0.005299008987754,0.007289018246928,0.007846418089333,0.007268262040485,0.007418347733388,0.007074044413397,0.006908648295436,0.006893137265511,0.0069980601017,0.007208887208951,0.00688174281816,0.005785394051817,0.006145430604099,0.006413544229255,0.005608472855733,0.005500216248341,0.004638986390549,0.005079087601851,0.005016909769964,0.005119753543574,0.004678406261035,0.004258219880295,0.004560769361522,0.005680206260512,0.007901266303683,0.008338810481356,0.010074920038745,0.011610099496286,0.012228657285185,0.012405603035393,0.016888297569855,0.015293319133191,0.014402150432285,0.011785021153164,0.011785021153164,0.014494482633119,0.015159718845201,0.01561100431977,0.015449751281183,0.010091258711421,0.009274922090176,0.008251315953429,0.008045826992215,0.005998248270293,0.006144906819254,0.003275421144968,0.003221692545299,0.002471833613324,0.007273418285406,0.008831780711822,0.009127181843085,0.009360913236124,0.013289856158182,0.020030158222835,0.014494544180274,0.010533765163659,0.008845817109582,0.008208088639159,0.008501441793179,-0.006585550856476,-0.010307143367454,-0.009028818996866,-0.011129401402667,-0.011217756066954,-0.01269115519497,-0.011769753509829,-0.012386907088614,-0.012717601031115,-0.015375122769455,-0.017437477957101,-0.020598613377952,-0.020625357806363,-0.020672907463313,-0.021149461273972,-0.0194271159052,-0.015462362462163,-0.012297810535281,-0.014054751162652,-0.014549224755076,0.004812448360118,0.012757297336042,0.01574529229508,0.0164318499768,0.019333109416735,0.019409934775455,0.020555956446191,0.020726578220959)
trans=0.5
age=(0:(162-1))* -1
plot(age,age,type = 'n', ylim = c(0, 0.766829980743067), xlim = c(-170.1,-58.9), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 0.764269053950808), xlim = c(-170.1,-58.9), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-0.3776445920043324, 0.4102958593107583), xlim = c(-170.1,-58.9), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()