# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.247964257337844,0.242886983613297,0.242886983613297,0.242886983613297,0.247964257337844,0.247964257337844,0.249204238672651,0.247964257337844,0.249204238672651,0.249204238672651,0.247964257337844,0.247964257337844,0.247964257337844,0.25053367324367,0.25053367324367,0.249204238672651,0.25053367324367,0.25053367324367,0.249632992516029,0.249632992516029,0.249204238672651,0.249204238672651,0.249204238672651,0.249204238672651,0.249204238672651,0.247964257337844,0.25053367324367,0.25053367324367,0.25053367324367,0.250836798364099,0.249204238672651,0.247964257337844,0.249204238672651,0.242886983613297,0.242886983613297,0.242886983613297,0.242886983613297,0.253335275173096,0.251419794998609,0.251419794998609,0.249632992516029,0.245273606211454,0.243872911591345,0.242886983613297,0.249632992516029,0.242886983613297,0.242886983613297,0.242886983613297,0.242886983613297,0.242886983613297,0.242886983613297,0.243872911591345,0.230800485653989,0.250836798364099,0.247964257337844,0.247964257337844,0.242886983613297,0.250836798364099,0.250836798364099,0.251419794998609,0.253822348852071,0.247964257337844,0.242886983613297,0.242886983613297,0.247964257337844,0.242886983613297,0.242886983613297,0.238549839329768,0.242886983613297,0.242886983613297,0.238549839329768,0.242886983613297,0.242886983613297,0.238549839329768,0.24083569459774,0.242886983613297,0.230593528463529)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.484815431849743,0.475830175145478,0.470365476055528,0.469503731663692,0.471443848573082,0.471443848573082,0.471443848573082,0.471443848573082,0.471443848573082,0.471443848573082,0.471443848573082,0.471443848573082,0.471443848573082,0.476784047136989,0.476784047136989,0.476039203562238,0.483720404491464,0.483720404491464,0.483720404491464,0.483720404491464,0.484815431849743,0.484815431849743,0.484815431849743,0.487076529054524,0.487076529054524,0.487076529054524,0.491475285554553,0.49092745358706,0.491475285554553,0.49190016070075,0.49190016070075,0.49190016070075,0.495013750840782,0.494508589994387,0.494508589994387,0.494508589994387,0.496245646820364,0.510532643723623,0.510532643723623,0.510532643723623,0.510532643723623,0.510532643723623,0.510532643723623,0.510532643723623,0.523996434696688,0.530327347354026,0.535179328712578,0.535752682647362,0.556105780363216,0.559947014409324,0.559947014409324,0.575731748750723,0.575731748750723,0.633729592313815,0.633729592313815,0.63663291548611,0.63663291548611,0.650771670795973,0.65911024593269,0.664548283598787,0.670870308518272,0.670870308518272,0.668387341014791,0.668387341014791,0.670870308518272,0.668387341014791,0.668387341014791,0.65911024593269,0.65911024593269,0.65911024593269,0.65911024593269,0.65911024593269,0.65911024593269,0.65911024593269,0.664548283598787,0.668387341014791,0.65911024593269)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.256247802101428,0.256247802101428,0.215029214524032,0.243215212006438,0.241700526070883,0.241700526070883,0.241700526070883,0.241700526070883,0.257995469336175,0.255367028459872,0.255367028459872,0.255367028459872,0.255367028459872,0.255367028459872,0.255367028459872,0.255367028459872,0.255367028459872,0.256247802101428,0.255367028459872,0.255367028459872,0.256247802101428,0.256247802101428,0.255367028459872,0.255367028459872,0.255367028459872,0.256247802101428,0.256247802101428,0.257995469336175,0.257995469336175,0.255367028459872,0.255367028459872,0.255823704385946,0.257995469336175,0.257995469336175,0.257995469336175,0.255367028459872,0.251836986907743,0.240412739871284,0.241700526070883,0.236663794116942,0.240412739871284,0.240412739871284,0.236663794116942,0.257995469336175,0.236663794116942,0.260741101474367,0.258582522037112,0.255823704385946,0.260741101474367,0.258111814815116,0.258111814815116,0.258111814815116,0.258111814815116,0.258111814815116,0.255367028459872,0.251836986907743,0.251836986907743,0.258111814815116,0.258111814815116,0.241700526070883,0.241700526070883,0.241700526070883,0.238015990590718,0.241700526070883,0.241700526070883,0.229222889424995,0.238015990590718,0.229222889424995,0.213580493940623,0.200281336996004,0.200281336996004,0.200281336996004,0.238015990590718,0.200281336996004,0.213580493940623,0.211621389942985,0.200281336996004)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.842774194444566,0.842774194444566,0.746328189018259,0.686048605050022,0.556859870267873,0.519534927396134,0.494664663080159,0.48714878511742,0.494664663080159,0.48714878511742,0.482053812054622,0.48518690555705,0.48518690555705,0.48518690555705,0.482053812054622,0.482053812054622,0.479412576690611,0.482053812054622,0.482053812054622,0.479412576690611,0.482053812054622,0.482053812054622,0.482053812054622,0.48506293651408,0.48506293651408,0.48989648302699,0.48989648302699,0.494664663080159,0.494664663080159,0.493219465404772,0.493219465404772,0.493219465404772,0.494664663080159,0.494664663080159,0.494664663080159,0.494664663080159,0.494664663080159,0.48989648302699,0.493219465404772,0.494664663080159,0.502049506638416,0.511291401829942,0.51428213929007,0.537442839844894,0.51428213929007,0.537560300850666,0.537560300850666,0.537560300850666,0.553245634879893,0.553245634879893,0.555425381280068,0.556647413916088,0.556647413916088,0.560390147980099,0.560390147980099,0.560390147980099,0.564765092168744,0.583785617441921,0.589917763202987,0.583785617441921,0.589917763202987,0.593101617160722,0.605504722161055,0.605504722161055,0.605504722161055,0.605504722161055,0.62421976850113,0.605504722161055,0.603550277844063,0.593101617160722,0.602399173312006,0.62421976850113,0.674883957375855,0.647826433460251,0.671570258174037,0.671570258174037,0.674883957375855)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.521952841818006,-0.483761992740297,-0.395585648704696,-0.338395463231512,-0.218202237179912,-0.213582573961006,-0.204131806536501,-0.191225047581234,-0.180049082785648,-0.180049082785648,-0.178413648848772,-0.164186628453562,-0.164186628453562,-0.164186628453562,-0.159365769239228,-0.159365769239228,-0.170382847437588,-0.170382847437588,-0.170382847437588,-0.170382847437588,-0.159365769239228,-0.159365769239228,-0.159365769239228,-0.158401875532574,-0.158401875532574,-0.159365769239228,-0.164186628453562,-0.168939836606584,-0.168939836606584,-0.16560132616317,-0.168939836606584,-0.168939836606584,-0.170382847437588,-0.176627200629537,-0.176627200629537,-0.178413648848772,-0.180415010707965,-0.180415010707965,-0.183517514699883,-0.183517514699883,-0.180415010707965,-0.183517514699883,-0.183517514699883,-0.183517514699883,-0.183517514699883,-0.180415010707965,-0.180415010707965,-0.20803797360464,-0.205606311841726,-0.20803797360464,-0.223543560361324,-0.205606311841726,-0.205606311841726,-0.205606311841726,-0.205606311841726,-0.205606311841726,-0.205606311841726,-0.238759303800975,-0.273760390881538,-0.287362903044316,-0.317156585487466,-0.303800251064528,-0.317156585487466,-0.303800251064528,-0.303800251064528,-0.303800251064528,-0.303800251064528,-0.29140471419727,-0.268776901608608,-0.268776901608608,-0.268776901608608,-0.268776901608608,-0.268776901608608,-0.274822197158354,-0.274822197158354,-0.293069076389855,-0.302638663082389)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.189708131987115,0.189708131987115,0.187396701493986,0.189708131987115,0.189708131987115,0.157078452830075,0.146614142977628,0.150448918700864,0.157078452830075,0.150448918700864,0.148701557957364,0.154679783441454,0.157078452830075,0.154679783441454,0.154679783441454,0.154679783441454,0.154679783441454,0.154679783441454,0.157078452830075,0.157078452830075,0.169831866673987,0.169831866673987,0.169831866673987,0.173891798744657,0.173891798744657,0.175891923408492,0.173891798744657,0.173891798744657,0.173891798744657,0.173891798744657,0.173891798744657,0.173891798744657,0.173891798744657,0.173415958911949,0.173891798744657,0.173891798744657,0.173891798744657,0.182796951200193,0.182796951200193,0.193972518043521,0.201464602453994,0.203812397389564,0.203812397389564,0.222821967718266,0.213951879981675,0.231433966591855,0.239081317064556,0.215488882337065,0.248745107356075,0.25141999797316,0.248745107356075,0.284518520774205,0.284518520774205,0.318073229059506,0.323884056745203,0.34342110267862,0.348779662564397,0.348779662564397,0.348779662564397,0.348779662564397,0.348779662564397,0.370270521416519,0.385068730096612,0.376336697867282,0.348779662564397,0.348779662564397,0.348779662564397,0.348779662564397,0.348779662564397,0.348779662564397,0.348779662564397,0.348779662564397,0.348779662564397,0.348779662564397,0.348779662564397,0.348779662564397,0.348779662564397)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.364864707132903,0.363125523367364,0.361553295346008,0.360882581942806,0.360857696229257,0.361182482078211,0.360495811045381,0.360655643784429,0.360758418887061,0.360742929974206,0.360741103235838,0.360741103235838,0.360803663144257,0.361002603140254,0.361449730707589,0.362855409419858,0.365694847622591,0.366272541819836,0.366583849108331,0.366583849108331,0.367089736954564,0.367089736954564,0.367184788416546,0.367722567809112,0.367814568790573,0.368893903493343,0.369731871796186,0.369778414552465,0.370528153122032,0.371242998125385,0.370836625516011,0.371103705219609,0.371850242125426,0.373198712736907,0.373511190969654,0.374045165355941,0.375140196744649,0.376339007663404,0.376642471179872,0.377129215315622,0.376835385702497,0.376656924094473,0.377310129709054,0.378035491478715,0.37895359948652,0.381476332032059,0.382350066168232,0.383388277623832,0.386575469596154,0.389356507495128,0.39004929580346,0.391893029127352,0.394345637322823,0.398710335264717,0.399778543888044,0.400575414083724,0.401490056429699,0.403693871905133,0.409106634599655,0.417242485694187,0.421101744090894,0.422693991843531,0.422436381740648,0.418546744623544,0.416729030189756,0.415103985636353,0.412762915446095,0.409398719983292,0.405309167106876,0.405012477736404,0.405266098202867,0.404175620180313,0.405077155747863,0.405953261548628,0.405298399058116,0.405720618459783,0.405882458286396)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.42373506755816,0.421548665984516,0.412424905028255,0.404285813249855,0.3862794206395,0.376900087835918,0.372623933254077,0.371509764083166,0.370120844195226,0.368391178480241,0.363696169693518,0.361094039971344,0.360129032921484,0.360129032921484,0.360623544407758,0.360419912999161,0.360847129237933,0.361289553999491,0.361496333682008,0.362306584025419,0.362609876537161,0.362968831948508,0.363144520017982,0.362772144635041,0.362802571153129,0.362275671670982,0.362865805536777,0.363417110641158,0.363941256523838,0.364177554344197,0.364177554344197,0.364419570157721,0.364674701600257,0.365073627275852,0.365502727621543,0.367885431123642,0.36806368025156,0.369557471992108,0.374084362452186,0.374272135099619,0.375112896465194,0.376708821993111,0.374852949300198,0.375188805236156,0.375453747196906,0.375716452484137,0.376241700567722,0.378195523809433,0.381974958202234,0.383079615113585,0.384131295157499,0.385740941576533,0.385633003632908,0.386482534404398,0.387764237893709,0.388979430412935,0.389979161482192,0.390964916397629,0.391329006404092,0.397920825105259,0.398668249355848,0.399047633166062,0.403169586331234,0.402237481115648,0.397808656660732,0.397391466553269,0.398212857041291,0.3958005291067,0.392392415956608,0.391707349842549,0.391316610113169,0.39262449824514,0.393408757232,0.393751179054496,0.392839033518793,0.39363108607625,0.395480299510014)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.058870360425257,-0.058423142617152,-0.050871609682247,-0.043403231307049,-0.025421724410243,-0.015717605757706,-0.012128122208696,-0.010854120298737,-0.009362425308165,-0.007648248506036,-0.00295506645768,-0.000352936735507,0.000674630222773,0.000873570218771,0.000826186299831,0.002435496420697,0.004847718384658,0.004982987820345,0.005087515426323,0.004277265082912,0.004479860417403,0.004120905006056,0.004040268398564,0.00495042317407,0.005011997637444,0.00661823182236,0.006866066259409,0.006361303911307,0.006586896598194,0.007065443781188,0.006659071171815,0.006684135061888,0.007175540525169,0.008125085461055,0.008008463348111,0.0061597342323,0.007076516493089,0.006781535671296,0.002558108727686,0.002857080216003,0.001722489237303,-5.1897898638e-05,0.002457180408856,0.002846686242558,0.003499852289614,0.005759879547922,0.00610836560051,0.005192753814398,0.00460051139392,0.006276892381543,0.00591800064596,0.006152087550819,0.008712633689915,0.012227800860318,0.012014305994336,0.011595983670789,0.011510894947507,0.012728955507503,0.017777628195564,0.019321660588928,0.022433494735047,0.023646358677469,0.019266795409414,0.016309263507896,0.018920373529024,0.017712519083085,0.014550058404804,0.013598190876592,0.012916751150267,0.013305127893855,0.013949488089698,0.011551121935173,0.011668398515863,0.012202082494132,0.012459365539323,0.012089532383533,0.010402158776382)
trans=0.5
age=(0:(144-1))* -1
plot(age,age,type = 'n', ylim = c(0, 0.7379573393700992), xlim = c(-151.2,-59.8), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 0.9270516138890227), xlim = c(-151.2,-59.8), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-0.5741481259998067, 0.42357560310627324), xlim = c(-151.2,-59.8), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()