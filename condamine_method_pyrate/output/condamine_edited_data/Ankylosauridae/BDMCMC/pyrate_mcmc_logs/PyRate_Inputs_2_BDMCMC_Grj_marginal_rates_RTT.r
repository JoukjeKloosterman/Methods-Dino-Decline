# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.122791203850803,0.122791203850803,0.122791203850803,0.123389300215823,0.124864153370295,0.12312029879305,0.122868325421156,0.122868325421156,0.122868325421156,0.122868325421156,0.122868325421156,0.122791203850803,0.122868325421156,0.122868325421156,0.122868325421156,0.122868325421156,0.122791203850803,0.122791203850803,0.122868325421156,0.122791203850803,0.122791203850803,0.122791203850803,0.122791203850803,0.122791203850803,0.122868325421156,0.122868325421156,0.122791203850803,0.122791203850803,0.122791203850803,0.122868325421156,0.122791203850803,0.118465434985441,0.117154771132446,0.117154771132446,0.117154771132446,0.117649689549339,0.110889152034082,0.110889152034082,0.117649689549339,0.117649689549339,0.117649689549339,0.110889152034082,0.117649689549339,0.117649689549339,0.117649689549339,0.117649689549339,0.117649689549339,0.117649689549339,0.119350143668245,0.119350143668245,0.119350143668245,0.119350143668245,0.117649689549339,0.102430695480781,0.08467504475014,0.110889152034082,0.110889152034082,0.094252338783611,0.094252338783611)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.264294179297704,0.26103108301218,0.260342146052216,0.260054282978251,0.260054282978251,0.257144270611888,0.256159813238578,0.256159813238578,0.256159813238578,0.256159813238578,0.256159813238578,0.256159813238578,0.257144270611888,0.257144270611888,0.257144270611888,0.257144270611888,0.256159813238578,0.256159813238578,0.257144270611888,0.256159813238578,0.256159813238578,0.256159813238578,0.256159813238578,0.256159813238578,0.257144270611888,0.257144270611888,0.258478130046601,0.257144270611888,0.26103108301218,0.261565104504157,0.264294179297704,0.26771746466932,0.268964496321262,0.273649828655003,0.283149902948202,0.283149902948202,0.284744918907264,0.290482724810781,0.314148347711186,0.315616542630103,0.322305397038631,0.321571189533569,0.340409894600281,0.345636400446559,0.345636400446559,0.345636400446559,0.345636400446559,0.345636400446559,0.348552022438866,0.349252206395262,0.348552022438866,0.349252206395262,0.352612836283079,0.356366235806236,0.356366235806236,0.407592339722275,0.453399099411248,0.516552579725138,0.638268499112764)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.09825706409438,0.120175730051497,0.113918022859571,0.113918022859571,0.118190035358359,0.121386457681322,0.104651035681011,0.097812980010243,0.097812980010243,0.07494004826251,0.07198129305483,0.07494004826251,0.07494004826251,0.07198129305483,0.072383121971994,0.072383121971994,0.072383121971994,0.07494004826251,0.075163068695021,0.07198129305483,0.07198129305483,0.07198129305483,0.07198129305483,0.07198129305483,0.07198129305483,0.07198129305483,0.07198129305483,0.070131926186297,0.070131926186297,0.07198129305483,0.07198129305483,0.07198129305483,0.081376375107071,0.074766376516972,0.081376375107071,0.072686204721254,0.07198129305483,0.07198129305483,0.074766376516972,0.072383121971994,0.07198129305483,0.07198129305483,0.074766376516972,0.072383121971994,0.070131926186297,0.07198129305483,0.061449109482076,0.070131926186297,0.07198129305483,0.072383121971994,0.07198129305483,0.070131926186297,0.070131926186297,0.07198129305483,0.059913356571078,0.057820148139504,0.070131926186297,0.059913356571078,0.043767111562746)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.759601389522585,0.533286574089554,0.512942967097052,0.512942967097052,0.498097283331323,0.494964580516174,0.456636257335206,0.442671215533807,0.441874898078015,0.357811572505654,0.272003004324076,0.263118168499686,0.261674975118496,0.257897552889348,0.257897552889348,0.257897552889348,0.257897552889348,0.257588575635215,0.257897552889348,0.254043038622683,0.252398888665032,0.252398888665032,0.252398888665032,0.252398888665032,0.251179282715854,0.251179282715854,0.251179282715854,0.251179282715854,0.251179282715854,0.254043038622683,0.254043038622683,0.254043038622683,0.264094745533699,0.257897552889348,0.264094745533699,0.257897552889348,0.257897552889348,0.258551989646504,0.264094745533699,0.263365426551336,0.264094745533699,0.268306723060666,0.272502622895728,0.272502622895728,0.272502622895728,0.277369118009081,0.272502622895728,0.272502622895728,0.272502622895728,0.272502622895728,0.272502622895728,0.272502622895728,0.274439154157175,0.283557810710539,0.272502622895728,0.272502622895728,0.28914848970742,0.2875361261979,0.313884057938775)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.59833461177275,-0.367473847030406,-0.3625214081805,-0.341793005527575,-0.336179981862761,-0.309473919205802,-0.284653768841942,-0.280789896148536,-0.275911664646563,-0.165452795374656,-0.091861257527267,-0.090888779924114,-0.087492565089036,-0.084843649371564,-0.083429821286217,-0.083429821286217,-0.081362353034755,-0.080258722269616,-0.081657088720659,-0.080258722269616,-0.081362353034755,-0.081657088720659,-0.081657088720659,-0.081657088720659,-0.083429821286217,-0.083429821286217,-0.080258722269616,-0.081657088720659,-0.083429821286217,-0.089546605451043,-0.091861257527267,-0.091861257527267,-0.096507589489352,-0.091861257527267,-0.095203737285008,-0.110533236714755,-0.10740162958022,-0.10740162958022,-0.110533236714755,-0.121227076243198,-0.119125887868064,-0.121227076243198,-0.121227076243198,-0.121227076243198,-0.121227076243198,-0.119125887868064,-0.119125887868064,-0.121227076243198,-0.121227076243198,-0.121227076243198,-0.121227076243198,-0.121227076243198,-0.121227076243198,-0.121227076243198,-0.121227076243198,-0.119125887868064,-0.201826296653947,-0.214638854215865,-0.481439834029212)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.155020862812896,0.097992485435311,0.097992485435311,0.109118978033379,0.09967666826308,0.109118978033379,0.09967666826308,0.09967666826308,0.104445465579314,0.156948503893147,0.139649891529761,0.129137512479456,0.129137512479456,0.129137512479456,0.129137512479456,0.129137512479456,0.129137512479456,0.129137512479456,0.129137512479456,0.129137512479456,0.129137512479456,0.129137512479456,0.129137512479456,0.129137512479456,0.129137512479456,0.129137512479456,0.136562465090301,0.136176440614201,0.141363592628441,0.137404728136216,0.137925392238341,0.148699341742243,0.149120812990966,0.159240734910508,0.160178294216073,0.149120812990966,0.16520151128421,0.167501099528438,0.17159688657558,0.167501099528438,0.188859279271567,0.211741549531249,0.223863601765021,0.245072018023993,0.248232073707718,0.254922160424361,0.265751189206306,0.254922160424361,0.245072018023993,0.238217722506961,0.238217722506961,0.245072018023993,0.248232073707718,0.302023934185282,0.341270358947825,0.374514704966788,0.341270358947825,0.497827347295344,0.612425903939483)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.187779532702088,0.187496537324038,0.187765688274463,0.188226065534734,0.188762037755861,0.188699784996827,0.188499972415467,0.188536864536539,0.188669254098372,0.188669254098372,0.188508029347903,0.188331451725636,0.188561737564466,0.188498759398323,0.188498759398323,0.188477009422313,0.188432055929378,0.188432055929378,0.188209564812817,0.188236873032869,0.188134877658106,0.188200839089937,0.188313823252052,0.188295414111232,0.188603031652406,0.188603031652406,0.189610590362475,0.189826612111784,0.191494761753756,0.191863687718278,0.193177459267169,0.194897746000418,0.19624686922447,0.19686712474546,0.197896530106071,0.1982001080202,0.199528268852936,0.199978781885686,0.20088825271484,0.201317795244517,0.202721321869729,0.203369858606277,0.203779596027346,0.204087402153907,0.204224419496805,0.20432177513543,0.204354015226824,0.20500416307107,0.204762697082823,0.204777156173552,0.204669870178319,0.204905399055564,0.206562016840586,0.21034457248798,0.211828882001342,0.215522797419509,0.221903838119723,0.240969195034373,0.260647044892931)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.346248280294928,0.281143291101964,0.27595195708412,0.276207209041256,0.269688185226608,0.262223198984971,0.244491794523273,0.240223237283064,0.233952110088219,0.185328850982222,0.166617680401464,0.163737897146384,0.163131079331137,0.162874333192499,0.162297836134598,0.16218877659826,0.16209259358825,0.161934048632087,0.162020245449071,0.16209678146392,0.162035286890653,0.16208913768874,0.16208913768874,0.16208913768874,0.161859057646872,0.161559783527243,0.16159682677644,0.161925037716329,0.161977568431816,0.162369177797567,0.162301146246844,0.162805743754664,0.163054700564044,0.16334098032753,0.163846139511463,0.16518450944877,0.16581535597045,0.165966159295443,0.166600333348583,0.167934483950317,0.169860461781971,0.179735308418667,0.180327332811775,0.184603095009177,0.189878226269059,0.19177955085869,0.191702705689252,0.183522814136974,0.175577086994425,0.172407504402742,0.171620675583556,0.172203761574742,0.172182325999627,0.17361517880834,0.174235198808441,0.175346896038916,0.176455548273023,0.178504314169856,0.183772934257599)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.15846874759284,-0.093646753777926,-0.088186268809657,-0.087981143506522,-0.080926147470747,-0.073523413988144,-0.055991822107806,-0.051686372746525,-0.045282855989847,0.00334040311615,0.021890348946439,0.024593554579253,0.025430658233328,0.025624426205824,0.026200923263725,0.026288232824053,0.026339462341128,0.026498007297291,0.026189319363746,0.026140091568949,0.026099590767453,0.026111701401197,0.026224685563312,0.026206276422492,0.026743974005534,0.027043248125163,0.028013763586035,0.027901574395455,0.029517193321941,0.029494509920711,0.030876313020324,0.032092002245754,0.033192168660426,0.033526144417929,0.034050390594608,0.03301559857143,0.033712912882486,0.034012622590243,0.034287919366257,0.033383311294201,0.032860860087758,0.02363455018761,0.023452263215571,0.01948430714473,0.014346193227747,0.01254222427674,0.012651309537571,0.021481348934096,0.029185610088398,0.03236965177081,0.033049194594763,0.032701637480822,0.034379690840959,0.03672939367964,0.037593683192902,0.040175901380593,0.0454482898467,0.062464880864518,0.076874110635332)
trans=0.5
age=(0:(127-1))* -1
plot(age,age,type = 'n', ylim = c(0, 0.7020953490240404), xlim = c(-133.35,-61.65), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 0.8355615284748437), xlim = c(-133.35,-61.65), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-0.6581680729500251, 0.6736684943334313), xlim = c(-133.35,-61.65), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()