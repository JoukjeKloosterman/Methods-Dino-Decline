# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.145156979644641,0.265689158188785,0.273868467794,0.283163245893637,0.275032202287325,0.277255853727985,0.273868467794,0.27480997669952,0.283163245893637,0.273868467794,0.291498739189553,0.281103886597859,0.288651456412944,0.273868467794,0.273868467794,0.245221337058638)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.575331067465156,0.57558978524617,0.56434305305535,0.56434305305535,0.561853284982578,0.561853284982578,0.536798308855406,0.53146860142445,0.534477439123311,0.527198691294681,0.544207716723417,0.534477439123311,0.545472323150676,0.533060081310922,0.545472323150676,0.755767607935665)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.33436366577074,0.324081648237301,0.32805181932142,0.336743366235282,0.344494600518621,0.323317394869116,0.323317394869116,0.293397854805247,0.23543700092188,0.169293010883545,0.104795372795098,0.062406447480925,0.077484676744376,0.077484676744376,0.079749416944165,0.076376666486545)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.927102048103798,0.843526306902848,0.835245277575727,0.835245277575727,0.850999810596179,0.849177585364491,0.845874185557582,0.850999810596179,0.825754557879637,0.785943491906598,0.677184325775085,0.473031607977955,0.464957646699182,0.458485393954709,0.458485393954709,0.460751945966565)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.575616149213027,-0.489923221307376,-0.474094593210987,-0.47839068481431,-0.484283101481808,-0.511810326850414,-0.47839068481431,-0.465490721441888,-0.42958890267497,-0.427416418936112,-0.328012780390909,-0.12109165590199,-0.117731702405074,-0.094316719919012,-0.121815103719391,-0.121815103719391)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.120905209462845,0.095625156152195,0.116952241342206,0.095625156152195,0.116952241342206,0.113344094172042,0.116952241342206,0.151637505363604,0.223295097103679,0.257864099836909,0.348379735056598,0.367471331628406,0.358307223046525,0.385659793290156,0.387125872905764,0.565076149507415)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.399976395433308,0.411978766229525,0.415700746663417,0.417000235874243,0.426683531078921,0.425475648640099,0.414723243519031,0.409341571162281,0.40828906319969,0.407805698244134,0.408595260236129,0.409098811111175,0.411903400868706,0.413147810577736,0.418086637129588,0.455371084018743)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.614371806136804,0.602506850538006,0.597462145758264,0.598364760337018,0.603488525892843,0.605654210593988,0.593870850682111,0.567590199661456,0.543147151638287,0.498867940150179,0.365087672507513,0.247130988722535,0.237418279904817,0.234543975792248,0.233119267184193,0.234238978593604)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.214395410703496,-0.190528084308481,-0.181761399094847,-0.181364524462775,-0.176804994813921,-0.18017856195389,-0.179147607163081,-0.158248628499175,-0.134858088438597,-0.091062241906045,0.043507587728616,0.16196782238864,0.174485120963889,0.178603834785487,0.184967369945396,0.22113210542514)
trans=0.5
age=(0:(83-1))* -1
plot(age,age,type = 'n', ylim = c(0, 0.8313443687292316), xlim = c(-87.15,-62.85), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 1.019812252914178), xlim = c(-87.15,-62.85), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-0.6331777641343297, 0.6215837644581566), xlim = c(-87.15,-62.85), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()