# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.047673742405133,0.109061526473946,0.108759728397461,0.149374340343602,0.193148179665552,0.298737018591635,0.29448263713432,0.29448263713432,0.298737018591635,0.29448263713432,0.29448263713432,0.29448263713432,0.298737018591635,0.29448263713432,0.29448263713432,0.298737018591635,0.286416403407353,0.288989882147753,0.288339137927036,0.288339137927036,0.286416403407353,0.286416403407353,0.288339137927036,0.288561524299699,0.288561524299699,0.288339137927036,0.286416403407353,0.281798228452073,0.281370919359693,0.281370919359693,0.282815363435366,0.286416403407353,0.286416403407353,0.286416403407353,0.286416403407353,0.286416403407353,0.282815363435366,0.288339137927036,0.288339137927036,0.288339137927036,0.288339137927036,0.288339137927036,0.288339137927036,0.288339137927036,0.286416403407353,0.286416403407353,0.286416403407353,0.286416403407353,0.28627227550489,0.28627227550489,0.28627227550489,0.284187547013798,0.284187547013798,0.282815363435366,0.282815363435366,0.282815363435366,0.281370919359693,0.281370919359693,0.278218223833081,0.276615420062655,0.276615420062655,0.276615420062655,0.277077977714581,0.276615420062655,0.276615420062655,0.2738053038284,0.272967184048693,0.272967184048693,0.272967184048693,0.270158522090541,0.267510652186873,0.267510652186873,0.261529611885198,0.268437480692233,0.267510652186873,0.267248026101299,0.267248026101299,0.267248026101299,0.267248026101299,0.267248026101299,0.261529611885198,0.267248026101299,0.267248026101299,0.267248026101299,0.267248026101299,0.267248026101299,0.267248026101299,0.267248026101299,0.267248026101299,0.267248026101299,0.261529611885198,0.255799202010961,0.238541026270875,0.230581251218008,0.238088317823562,0.238088317823562)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.37749772241213,0.37749772241213,0.37749772241213,0.397617276090142,0.421617416017681,0.41988751989707,0.413282237314656,0.413282237314656,0.416437199851873,0.411586603701825,0.411586603701825,0.411586603701825,0.416437199851873,0.411586603701825,0.411586603701825,0.416085193828309,0.416085193828309,0.416085193828309,0.411586603701825,0.411586603701825,0.410378144920999,0.410378144920999,0.413282237314656,0.414027021467111,0.414027021467111,0.414027021467111,0.413926867648836,0.414027021467111,0.414027021467111,0.414027021467111,0.414027021467111,0.416437199851873,0.416085193828309,0.416437199851873,0.416437199851873,0.416437199851873,0.414027021467111,0.420455254746681,0.421617416017681,0.419903307954754,0.419903307954754,0.419903307954754,0.420455254746681,0.420455254746681,0.419903307954754,0.419903307954754,0.419903307954754,0.419903307954754,0.419903307954754,0.421617416017681,0.421617416017681,0.420455254746681,0.420455254746681,0.419903307954754,0.420455254746681,0.421617416017681,0.421993600175685,0.421993600175685,0.419903307954754,0.419903307954754,0.420455254746681,0.420455254746681,0.421993600175685,0.421993600175685,0.421993600175685,0.421993600175685,0.421993600175685,0.423511229521356,0.423511229521356,0.421993600175685,0.421993600175685,0.421993600175685,0.423511229521356,0.433491392373311,0.433491392373311,0.433491392373311,0.437687603530178,0.437687603530178,0.455262992544291,0.456485602204641,0.456485602204641,0.466776713742552,0.466776713742552,0.468260283061933,0.469949271301006,0.470845621881869,0.476535275622168,0.481182703822114,0.481498591877909,0.483146219372304,0.483592945836528,0.483592945836528,0.481498591877909,0.483592945836528,0.49961653490619,0.506797899927809)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.328588189937292,0.328588189937292,0.328588189937292,0.33011785128168,0.328588189937292,0.33011785128168,0.33011785128168,0.34426398172897,0.34426398172897,0.102846931400082,0.094494029998143,0.09183818630057,0.09183818630057,0.09046942623096,0.087451652765798,0.093900367619687,0.116407447243465,0.119322748692675,0.119322748692675,0.115814135126097,0.122241514903657,0.117701002925267,0.117701002925267,0.117701002925267,0.117701002925267,0.117701002925267,0.117701002925267,0.115814135126097,0.115814135126097,0.122241514903657,0.119397624708391,0.119322748692675,0.119322748692675,0.12169060646166,0.119322748692675,0.122241514903657,0.119322748692675,0.122241514903657,0.122241514903657,0.122241514903657,0.125108652763142,0.125888693121714,0.139163104107962,0.151498069259779,0.151498069259779,0.161841179466097,0.173470036730643,0.174240690245147,0.156171587022974,0.156171587022974,0.156171587022974,0.15978718453046,0.15978718453046,0.171973249735539,0.176273646051363,0.173470036730643,0.173470036730643,0.173470036730643,0.173470036730643,0.171973249735539,0.171973249735539,0.171973249735539,0.171973249735539,0.171973249735539,0.171973249735539,0.176273646051363,0.174240690245147,0.174240690245147,0.174240690245147,0.173470036730643,0.171973249735539,0.171973249735539,0.173470036730643,0.171973249735539,0.171973249735539,0.173470036730643,0.173470036730643,0.173470036730643,0.17732103150602,0.179044239646298,0.179044239646298,0.179044239646298,0.17732103150602,0.176273646051363,0.176273646051363,0.176273646051363,0.176273646051363,0.176273646051363,0.176273646051363,0.176273646051363,0.176273646051363,0.176273646051363,0.176273646051363,0.176273646051363,0.171973249735539,0.176273646051363)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.54445233364259,0.54013582758563,0.539306608964322,0.539306608964322,0.539306608964322,0.539306608964322,0.563420790978063,0.600929018717189,0.667408020330353,0.59470728596763,0.24306752853547,0.231633812661614,0.231633812661614,0.231633812661614,0.230375646196624,0.252721150623841,0.316130693507396,0.31917799865856,0.31949484968418,0.322711837862298,0.330640018925424,0.322711837862298,0.322711837862298,0.322711837862298,0.322711837862298,0.322711837862298,0.322711837862298,0.322711837862298,0.322711837862298,0.330640018925424,0.330640018925424,0.332114551507219,0.338955403405463,0.351014698963994,0.370881477287479,0.383455908525743,0.404513259650826,0.43231172281373,0.452888956841146,0.471841444537846,0.48610187235775,0.4838481037476,0.48610187235775,0.491438976784902,0.482999818439246,0.482999818439246,0.491438976784902,0.482999818439246,0.458320419925201,0.458320419925201,0.458320419925201,0.459291592619237,0.459291592619237,0.466430973618928,0.466430973618928,0.459291592619237,0.459291592619237,0.459291592619237,0.459291592619237,0.459291592619237,0.459291592619237,0.459291592619237,0.459291592619237,0.459291592619237,0.459291592619237,0.466430973618928,0.466430973618928,0.466430973618928,0.466430973618928,0.466430973618928,0.466430973618928,0.466430973618928,0.466430973618928,0.466430973618928,0.466430973618928,0.471841444537846,0.471841444537846,0.471841444537846,0.480494822336787,0.482999818439246,0.482999818439246,0.482999818439246,0.482999818439246,0.482908784105529,0.482908784105529,0.482999818439246,0.482908784105529,0.482908784105529,0.482999818439246,0.482999818439246,0.482454849978436,0.482454849978436,0.482454849978436,0.482908784105529,0.482999818439246,0.495277668830592)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.406196340033812,-0.344405826268968,-0.343217083487462,-0.30195105795684,-0.25000125185528,-0.217432398058038,-0.222854539074222,-0.239474490062634,-0.32916356821903,-0.26885972020184,0.090655648908362,0.094334918475389,0.095100933495675,0.093906322946106,0.091227420591101,0.064180336287033,0.008785121274506,0.012195975896106,0.012195975896106,0.012195975896106,0.012195975896106,0.011176339387754,0.012195975896106,0.012195975896106,0.012195975896106,0.012195975896106,0.012195975896106,0.006923906139435,0.004693318631763,0.004693318631763,-0.012609377300699,-0.013320300173621,-0.013320300173621,-0.014236928732455,-0.034844685401582,-0.056127020200125,-0.081100290676635,-0.098227054227669,-0.13557268819023,-0.151274505712887,-0.156741762763438,-0.145426688241864,-0.145559199092619,-0.145559199092619,-0.145559199092619,-0.145559199092619,-0.144679240605609,-0.135202908209141,-0.128066322967101,-0.128066322967101,-0.128066322967101,-0.128066322967101,-0.128066322967101,-0.128066322967101,-0.125223038013283,-0.122585253217869,-0.124165009431891,-0.124165009431891,-0.124165009431891,-0.125223038013283,-0.125223038013283,-0.125223038013283,-0.128066322967101,-0.128066322967101,-0.128066322967101,-0.135641870781933,-0.133267294047555,-0.133267294047555,-0.133267294047555,-0.135641870781933,-0.135641870781933,-0.146546580820891,-0.135641870781933,-0.145559199092619,-0.145559199092619,-0.145559199092619,-0.146546580820891,-0.146546580820891,-0.146546580820891,-0.155236426688173,-0.155236426688173,-0.155236426688173,-0.154339868223187,-0.155236426688173,-0.17038884552597,-0.171676769532805,-0.17038884552597,-0.173647963182871,-0.17038884552597,-0.171676769532805,-0.17038884552597,-0.173647963182871,-0.171676769532805,-0.173647963182871,-0.171676769532805,-0.171676769532805)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.017713558170338,0.007172999696001,0.005537674044839,0.028552185603069,0.043958972151056,0.036955329683696,0.041347614545028,0.042649916006322,0.042649916006322,0.262202178341119,0.287861092794418,0.278099079288083,0.278099079288083,0.278099079288083,0.278099079288083,0.264422699224412,0.262202178341119,0.262202178341119,0.254861812459409,0.256615122177469,0.256615122177469,0.255159955989713,0.25716052151991,0.25716052151991,0.25716052151991,0.25811614265393,0.258870107621085,0.262202178341119,0.262202178341119,0.262202178341119,0.245037189951543,0.246620912981964,0.251470522723926,0.26089425773664,0.262822759673339,0.25716052151991,0.251470522723926,0.254861812459409,0.244430353507408,0.231124916718073,0.229312632018658,0.226900981643247,0.218163328718411,0.214768690080444,0.207953260814723,0.191852306135599,0.189059920111722,0.189059920111722,0.191501424788577,0.191501424788577,0.191501424788577,0.191501424788577,0.191501424788577,0.191501424788577,0.189059920111722,0.189059920111722,0.189059920111722,0.189059920111722,0.189059920111722,0.189059920111722,0.189059920111722,0.189059920111722,0.191501424788577,0.191501424788577,0.191501424788577,0.185205866223666,0.189059920111722,0.189059920111722,0.189059920111722,0.188944403236352,0.191501424788577,0.182766456227893,0.189059920111722,0.186040879185099,0.185205866223666,0.186040879185099,0.186040879185099,0.186040879185099,0.191501424788577,0.189059920111722,0.189059920111722,0.191501424788577,0.194320477860373,0.201725015717424,0.189059920111722,0.189059920111722,0.189059920111722,0.189059920111722,0.194320477860373,0.194320477860373,0.194320477860373,0.189059920111722,0.201725015717424,0.215478255059503,0.222175096683649,0.241454712892066)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.243735814526623,0.268553627431257,0.271077969078629,0.308392847529402,0.331672952228722,0.348849931195276,0.348855932555073,0.349000962843232,0.348480317704768,0.348275789919538,0.348268295919702,0.347870703382938,0.347802495875281,0.34769795635034,0.34769795635034,0.348474246476346,0.371963171153044,0.364846607150932,0.348569023667736,0.34661119410337,0.345813287884723,0.34582652568408,0.345395378838793,0.345215737363564,0.345184674481541,0.344536976233646,0.343573254033675,0.341498838382618,0.341068645004256,0.341068645004256,0.341721436596209,0.343540422754343,0.344865425472006,0.345207126018804,0.345207126018804,0.34506785217292,0.345590731127572,0.34569554435093,0.34598465922934,0.346329446978737,0.346566820406131,0.346604438059583,0.346768646225119,0.346786576235378,0.347180929692249,0.347337852086609,0.347332806324487,0.347461166167508,0.34733258242626,0.347728440753488,0.347728440753488,0.347546161263373,0.347546161263373,0.347631812242661,0.347796063274618,0.347987311767757,0.348413269345693,0.348393611803528,0.349352273595152,0.35033530667334,0.350634732908593,0.350634732908593,0.350808575992993,0.351077315557132,0.351100661400893,0.350906703836921,0.351317818641429,0.35130143576383,0.351271080691122,0.351509432178511,0.351841326355971,0.351920524954678,0.352149266006718,0.351714624511722,0.351610551406747,0.351600785385684,0.352151727210382,0.352151727210382,0.353414793340225,0.354746117001911,0.35467389411233,0.354439242035682,0.354439242035682,0.35497457606884,0.355219122717382,0.354880401998828,0.354953212691822,0.35597858157532,0.35624843193376,0.356677933182132,0.356935450759404,0.356793308903879,0.357771826540664,0.360185719314118,0.360532164366818,0.363901716992168)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.428528417672348,0.428828733242458,0.428701785273282,0.429253795790436,0.430362703768465,0.434012381537551,0.442230670754536,0.451525890872844,0.469197258758602,0.382901742992213,0.169039094991346,0.165748268271449,0.165411436955405,0.165180690885178,0.164993573002268,0.171439489400856,0.187169239181146,0.19056819366276,0.192908193406146,0.196058912751419,0.195612874044458,0.194592149235956,0.194985621220352,0.195102454156117,0.195310945246467,0.195392392440707,0.195392392440707,0.195258631793705,0.195302936853892,0.195654196349537,0.197288310078715,0.199571995281526,0.203720012560124,0.209841911868796,0.218207932934082,0.226317856739195,0.234835933991183,0.25010184763899,0.272980403269249,0.291026136948608,0.310064777469254,0.316424661596024,0.318486965744235,0.317658578350528,0.320868720393098,0.324655329627193,0.325544939252734,0.325110594679016,0.322543854347525,0.322429081816498,0.322583368093804,0.323734079714734,0.323909162585848,0.324284616666139,0.32410331269347,0.323678591158875,0.323656921934303,0.323625227756766,0.323625227756766,0.323934634659585,0.324026081993858,0.324148014942418,0.3246741416109,0.324788262997108,0.324788262997108,0.325205375602046,0.325835857271412,0.325947665976593,0.325499762742406,0.325891630401484,0.325587378829767,0.327122409287427,0.327031009531982,0.328317755937887,0.328500783951257,0.329244017525717,0.329519375875331,0.329805189142964,0.331196533157733,0.331802283995864,0.332049098675532,0.332049098675532,0.33284526271259,0.333566700295707,0.333539298025168,0.33392217037473,0.333204567488187,0.332895936252192,0.333470749414027,0.333470749414027,0.333028442627755,0.333128981280438,0.333128981280438,0.332611966983515,0.332119661190139,0.331736781924718)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.184792603145725,-0.160275105811201,-0.157623816194653,-0.120860948261034,-0.098689751539743,-0.085162450342276,-0.093374738199464,-0.102524928029612,-0.120716941053834,-0.034625953072675,0.179229200928356,0.18212243511149,0.182391058919877,0.182517265465162,0.182704383348072,0.17703475707549,0.184793931971898,0.174278413488172,0.15566083026159,0.150552281351951,0.150200413840265,0.151234376448124,0.150409757618441,0.150113283207447,0.149873729235075,0.149144583792938,0.148180861592968,0.146240206588913,0.145765708150364,0.145414448654719,0.144433126517494,0.143968427472817,0.141145412911881,0.135365214150008,0.126999193084723,0.118749995433725,0.11075479713639,0.095593696711941,0.073004255960091,0.055303310030129,0.036502042936877,0.030179776463559,0.028281680480884,0.02912799788485,0.026312209299152,0.022682522459416,0.021787867071752,0.022350571488492,0.024788728078735,0.02529935893699,0.025145072659684,0.02381208154864,0.023636998677525,0.023347195576522,0.023692750581147,0.024308720608882,0.02475634741139,0.024768384046762,0.025727045838386,0.026400672013755,0.026608650914735,0.026486717966175,0.026134434382092,0.026289052560024,0.026312398403785,0.025701328234875,0.025481961370017,0.025353769787237,0.025771317948716,0.025617801777027,0.026253947526205,0.024798115667251,0.025118256474736,0.023396868573834,0.02310976745549,0.022356767859967,0.022632351335051,0.022346538067419,0.022218260182492,0.022943833006047,0.022624795436799,0.02239014336015,0.021593979323092,0.021407875773133,0.021679824692214,0.020958231624098,0.021748645203635,0.023082645323128,0.022777682519733,0.023207183768105,0.02390700813165,0.023664327623441,0.024642845260226,0.027573752330603,0.028412503176679,0.032164935067451)
trans=0.5
age=(0:(163-1))* -1
plot(age,age,type = 'n', ylim = c(0, 0.55747768992059), xlim = c(-171.15,-58.85), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 0.7341488223633883), xlim = c(-171.15,-58.85), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-0.44681597403719325, 0.3166472020738598), xlim = c(-171.15,-58.85), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()