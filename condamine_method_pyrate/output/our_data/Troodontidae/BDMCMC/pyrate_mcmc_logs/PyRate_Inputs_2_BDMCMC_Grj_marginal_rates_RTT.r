# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.05739229152769,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056918772601388,0.056861615690263,0.056861615690263,0.056861615690263,0.056918772601388,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.056861615690263,0.058265879833235,0.058265879833235,0.05739229152769,0.05739229152769,0.057729872079116,0.057729872079116,0.05739229152769,0.056861615690263,0.056148132899331,0.053340891305669,0.051506555118466,0.052077426922128,0.051729580655022,0.051506555118466,0.049892434959683,0.047867753380013,0.047819446870827,0.043803578074955,0.008430789405608,0.043803578074955,0.081637321532815,0.321678739703172,0.321678739703172,0.321678739703172,0.297315870567887,0.287021158988119,0.271032085638595,0.247814552629246)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.130361346627812,0.129148417188304,0.129065746319584,0.129065746319584,0.129065746319584,0.128837844983138,0.128837844983138,0.128837844983138,0.12855634210704,0.12855634210704,0.128218461111493,0.128218461111493,0.128218461111493,0.128218461111493,0.128218461111493,0.128218461111493,0.128218461111493,0.128218461111493,0.128218461111493,0.12855634210704,0.12855634210704,0.12855634210704,0.12855634210704,0.128837844983138,0.129065746319584,0.129065746319584,0.129065746319584,0.129065746319584,0.129065746319584,0.129065746319584,0.129065746319584,0.129148417188304,0.129148417188304,0.129148417188304,0.129148417188304,0.129148417188304,0.129148417188304,0.129148417188304,0.129148417188304,0.131224503054951,0.131224503054951,0.130493203099823,0.130493203099823,0.131224503054951,0.131224503054951,0.131224503054951,0.131224503054951,0.131224503054951,0.131224503054951,0.130361346627812,0.131224503054951,0.131224503054951,0.131224503054951,0.131224503054951,0.131224503054951,0.135225659241717,0.143784589274778,1.119666329730748,2.667983493340894,3.344832138677125,3.44157776243912,3.44157776243912,3.44157776243912,3.44157776243912,3.44157776243912,3.44157776243912,3.44157776243912)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.025248546082185,0.038491388221064,0.040316821924761,0.0407976261003,0.040004104903277,0.042062830547744,0.042062830547744,0.042400130836073,0.042400130836073,0.042400130836073,0.042400130836073,0.042400130836073,0.042400130836073,0.042400130836073,0.042400130836073,0.042400130836073,0.042400130836073,0.042400130836073,0.042400130836073,0.042062830547744,0.042400130836073,0.042400130836073,0.042400130836073,0.042400130836073,0.042400130836073,0.042400130836073,0.042062830547744,0.042062830547744,0.0407976261003,0.0407976261003,0.040316821924761,0.038491388221064,0.037687768175009,0.039024293064558,0.036921497044298,0.042062830547744,0.038491388221064,0.0352366086759,0.0352366086759,0.037687768175009,0.037687768175009,0.038491388221064,0.0352366086759,0.037742094168046,0.037742094168046,0.037742094168046,0.037742094168046,0.042062830547744,0.037742094168046,0.047106963769415,0.047106963769415,0.047921742428824,0.043133461918347,0.048546364490012,0.048546364490012,0.047106963769415,0.048546364490012,0.047106963769415,0.043133461918347,0.047106963769415,0.043133461918347,0.02871155634024,0.043133461918347,0.043133461918347,0.02871155634024,0.043133461918347,0.043133461918347)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.53419038101204,0.120968043868148,0.118195992367284,0.118195992367284,0.116842682403238,0.118195992367284,0.118195992367284,0.118195992367284,0.118195992367284,0.118195992367284,0.118195992367284,0.118195992367284,0.116842682403238,0.116842682403238,0.116842682403238,0.116842682403238,0.116842682403238,0.116842682403238,0.116842682403238,0.116842682403238,0.117992569165139,0.117992569165139,0.117992569165139,0.117992569165139,0.117992569165139,0.117992569165139,0.118195992367284,0.118195992367284,0.118195992367284,0.118195992367284,0.118195992367284,0.118195992367284,0.117992569165139,0.120968043868148,0.120968043868148,0.129373989347916,0.12978911634537,0.132822676326151,0.141381255785714,0.16844768673081,0.18468237959794,0.200095086263123,0.206955989154305,0.211825479388014,0.218294367464829,0.232572552649249,0.243531386683529,0.257134275614081,0.269176735047114,0.290600095754816,0.29924491487858,0.311347167071448,0.315215738351136,0.324311904486669,0.32506784152272,0.32506784152272,0.328097039484177,0.330491666287248,0.332752598072566,0.364621290108474,0.543895956529798,0.997486323055766,1.54857809178904,1.826706646680299,1.973372695205732,2.296640381716174,2.499311220644733)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.458352151135159,-0.044234838108261,-0.044234838108261,-0.044234838108261,-0.044234838108261,-0.044234838108261,-0.044234838108261,-0.044234838108261,-0.044234838108261,-0.044234838108261,-0.044234838108261,-0.044234838108261,-0.042255515869746,-0.042255515869746,-0.042255515869746,-0.041674710233282,-0.041674710233282,-0.041674710233282,-0.041674710233282,-0.042255515869746,-0.041674710233282,-0.041674710233282,-0.041674710233282,-0.041674710233282,-0.041674710233282,-0.041674710233282,-0.044234838108261,-0.044234838108261,-0.044234838108261,-0.044234838108261,-0.044234838108261,-0.044234838108261,-0.044057124070183,-0.044234838108261,-0.044234838108261,-0.043933830515359,-0.052532159328067,-0.051421497833952,-0.05346998594937,-0.07929457224565,-0.090645965131833,-0.114111213936773,-0.12041305551003,-0.138989046655894,-0.139506207031277,-0.167703211925411,-0.16906300362246,-0.16906300362246,-0.208124457265832,-0.215334218931301,-0.221882487824467,-0.221882487824467,-0.240273790675669,-0.240273790675669,-0.24488688615429,-0.275797066188341,-0.308032818434469,-0.302949968315994,-0.226794319400022,-0.05906719145628,-0.054821348247789,-0.461683873812184,-0.860980755986071,-0.942310431271263,-0.986185594651448,-1.540648554489859,-1.691274304163518)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.086561582338769,0.062918548900604,0.0549701668496,0.055741021137315,0.055741021137315,0.055741021137315,0.055741021137315,0.0549701668496,0.0549701668496,0.054681504381419,0.054681504381419,0.054681504381419,0.055741021137315,0.055741021137315,0.0549701668496,0.0549701668496,0.0549701668496,0.0549701668496,0.0549701668496,0.0549701668496,0.056239615389923,0.056239615389923,0.056239615389923,0.056239615389923,0.056239615389923,0.056239615389923,0.0549701668496,0.055437362177297,0.055741021137315,0.055741021137315,0.055741021137315,0.058317287841198,0.058906934993632,0.059634816239988,0.062048976939496,0.065054273181906,0.062918548900604,0.072294519381213,0.081486970997643,0.079906065682306,0.079906065682306,0.076294319826877,0.085585203866749,0.072294519381213,0.079906065682306,0.058317287841198,0.065054273181906,0.079906065682306,0.053561777686166,0.056805287158305,0.054053917792011,0.068287604222653,0.062048976939496,0.062048976939496,0.071029880085318,0.056249649794547,0.062048976939496,1.088276887869757,2.516321092685058,3.318291017852432,3.60918332071673,3.684477519841614,3.80609377936319,3.80609377936319,4.069005147582076,3.80609377936319,3.70967402994777)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.088232378929204,0.088153583279956,0.088249636278283,0.088248145874079,0.088369764463053,0.088407138958532,0.088439765635846,0.088467416434885,0.08859049317757,0.088614203048827,0.088705987360736,0.088906448119093,0.088983813001435,0.089040527683497,0.089063538298434,0.089141437987367,0.089232615084114,0.089255674321257,0.089255674321257,0.089240934905776,0.089240934905776,0.089240934905776,0.089286032532327,0.08933915133258,0.089281888720376,0.089281888720376,0.089300530825587,0.089257454097587,0.089257454097587,0.089257454097587,0.089257454097587,0.089351644527103,0.089351644527103,0.089351644527103,0.089351644527103,0.089427726269092,0.089427726269092,0.089467238143272,0.089467238143272,0.089791340210376,0.089830106443629,0.090123982906282,0.090123982906282,0.090420652795007,0.090420652795007,0.090438831248318,0.090888737169691,0.09083835353862,0.090734457644999,0.090882452103513,0.091417504021652,0.091411912296864,0.091497673877714,0.092319885520847,0.093378994625533,0.096318549539872,0.104482011023144,0.243305669708536,1.16329760766721,1.545483286338631,1.582971240014282,1.582340226946002,1.581149121325333,1.58110097737083,1.58585786470399,1.58754036082992,1.581367886893096)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.127285626576322,0.084051343294127,0.080056368561793,0.079887574123383,0.079832613637383,0.079774599537834,0.079774599537834,0.079648822436237,0.079648822436237,0.079561962449633,0.079561962449633,0.079561962449633,0.079251687421575,0.079193373133279,0.079018831740645,0.079018831740645,0.079007565171396,0.078848055028022,0.078848055028022,0.078803105831994,0.078741519686639,0.078741519686639,0.078692780967367,0.078692780967367,0.078669403652469,0.078648324704748,0.078907079399694,0.078858333575473,0.079064272160751,0.079064272160751,0.079344775189121,0.079885949659559,0.079955565248786,0.080275738978012,0.080968875615812,0.081773637273043,0.083016513158582,0.08378632237108,0.085419461459851,0.088937605778804,0.090789809419591,0.095122013096472,0.097608468477008,0.098784410746203,0.099844255630062,0.102057200206907,0.104070285058567,0.108014332351007,0.112148668187621,0.118149503918222,0.1219895605423,0.127321342187123,0.133883015282991,0.135021835570415,0.135849490396611,0.136427785800386,0.136656029671035,0.137842170651595,0.139677217687517,0.156076664849317,0.222896072215362,0.260955955435397,0.321539029145196,0.366250770738613,0.419049495938748,0.498383389431732,0.538504819948932)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.039053247647118,0.00410223998583,0.00819326771649,0.008360571750696,0.008537150825669,0.008632539420697,0.008665166098012,0.008818593998648,0.008941670741333,0.009052240599194,0.009144024911103,0.009344485669461,0.009732125579861,0.009847154550219,0.01004470655779,0.010122606246722,0.010225049912718,0.010407619293236,0.010407619293236,0.010437829073782,0.010499415219137,0.010499415219137,0.01059325156496,0.010646370365213,0.010612485067907,0.010633564015628,0.010393451425893,0.010399120522114,0.010193181936836,0.010193181936836,0.009912678908466,0.009465694867544,0.009396079278318,0.009075905549091,0.008382768911291,0.00765408899605,0.00641121311051,0.005680915772193,0.004047776683422,0.000853734431571,-0.000959702975962,-0.00499803019019,-0.007484485570726,-0.008363757951196,-0.009423602835055,-0.011618368958589,-0.013181547888876,-0.017175978812387,-0.021414210542623,-0.02726705181471,-0.030572056520648,-0.035909429890259,-0.042385341405277,-0.042701950049569,-0.042470495771078,-0.040109236260514,-0.032174018647891,0.105463499056941,1.023620389979693,1.389406621489314,1.360075167798921,1.321384271510606,1.259610092180137,1.214850206632217,1.166808368765243,1.089156971398189,1.042863066944164)
trans=0.5
age=(0:(134-1))* -1
plot(age,age,type = 'n', ylim = c(0, 3.7857355386830323), xlim = c(-140.7,-60.3), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 2.7492423427092065), xlim = c(-140.7,-60.3), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-1.86040173457987, 4.475905662340284), xlim = c(-140.7,-60.3), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()