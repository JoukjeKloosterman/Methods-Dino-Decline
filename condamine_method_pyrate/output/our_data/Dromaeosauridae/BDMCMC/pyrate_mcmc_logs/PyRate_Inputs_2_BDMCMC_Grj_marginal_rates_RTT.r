# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.056578860505432,0.057617171122603,0.054825227830656,0.055941520887749,0.057036412906924,0.057036412906924,0.056578860505432,0.057383454393127,0.057036412906924,0.057036412906924,0.057036412906924,0.057036412906924,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057140090295035,0.057036412906924,0.057036412906924,0.057036412906924,0.057036412906924,0.057383454393127,0.057383454393127,0.057383454393127,0.056578860505432,0.056578860505432,0.056578860505432,0.056578860505432,0.056578860505432,0.056578860505432,0.056578860505432,0.056578860505432,0.056578860505432,0.056578860505432,0.057036412906924,0.057036412906924,0.056578860505432,0.056578860505432,0.057036412906924,0.056578860505432,0.056578860505432,0.057036412906924,0.057818163127534,0.057383454393127,0.057383454393127,0.057383454393127,0.057383454393127,0.057383454393127,0.057383454393127,0.057383454393127,0.057383454393127,0.057383454393127,0.057036412906924,0.057140090295035,0.057140090295035,0.057036412906924,0.056578860505432,0.055941520887749,0.056578860505432,0.054825227830656,0.053669023495084,0.049233148706158,0.049233148706158,0.050943351559421,0.053669023495084,0.040995540419501,0.055941520887749)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.096871667926182,0.097020955077035,0.093965921832058,0.093965921832058,0.093965921832058,0.093707075993091,0.093030488277766,0.093707075993091,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093707075993091,0.093707075993091,0.093707075993091,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093030488277766,0.093707075993091,0.093707075993091,0.093030488277766,0.093030488277766,0.093707075993091,0.093707075993091,0.093965921832058,0.095884862230564,0.097020955077035,0.096871667926182,0.096871667926182,0.096871667926182,0.097020955077035,0.097020955077035,0.097020955077035,0.097020955077035,0.097020955077035,0.097020955077035,0.096871667926182,0.096871667926182,0.096871667926182,0.096871667926182,0.096871667926182,0.096871667926182,0.097690094834985,0.098936921683921,0.101677888344397,0.123787098872057,0.134690106064493,0.158941299651125,0.221104947885898,0.394937287583334,1.000244496930896)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.048245746522244,0.048245746522244,0.04539368346382,0.036282118007679,0.036282118007679,0.044183519539969,0.044183519539969,0.044494446422279,0.04504125171946,0.04504125171946,0.045204416999181,0.045204416999181,0.045204416999181,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045288063871139,0.045204416999181,0.045204416999181,0.045204416999181,0.045204416999181,0.045204416999181,0.045204416999181,0.045204416999181,0.045204416999181,0.045288063871139,0.045288063871139,0.045288063871139,0.045204416999181,0.045204416999181,0.04504125171946,0.04504125171946,0.04504125171946,0.04504125171946,0.04504125171946,0.04504125171946,0.045204416999181,0.045204416999181,0.045204416999181,0.045204416999181,0.045204416999181,0.045204416999181,0.045204416999181,0.045204416999181,0.04504125171946,0.04504125171946,0.04504125171946,0.044183519539969,0.044183519539969,0.044183519539969,0.044183519539969,0.044183519539969,0.044183519539969,0.044183519539969,0.043787811324026,0.044183519539969,0.043787811324026,0.043787811324026)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,1.35982823123008,1.347502599226539,1.258493321475563,1.057028513897936,0.32707664590414,0.080209537146617,0.076555559297304,0.076345501535912,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.07706042559907,0.07706042559907,0.07706042559907,0.07706042559907,0.07706042559907,0.077177109836679,0.077177109836679,0.077177109836679,0.077177109836679,0.077177109836679,0.077177109836679,0.076555559297304,0.076555559297304,0.076555559297304,0.076555559297304,0.076926854353064,0.07706042559907,0.077177109836679,0.077177109836679,0.078042862534707,0.078176202868438,0.078176202868438)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-1.298003730155002,-1.278266922471156,-1.177005601834708,-0.982522668015919,-0.261287090734291,-0.015268539863262,-0.013268044755009,-0.011730452207564,-0.011598197557725,-0.011598197557725,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010722000367741,-0.010803174873801,-0.010803174873801,-0.011945002706649,-0.010803174873801,-0.011945002706649,-0.013059320512023,-0.01398348791607,-0.01398348791607,-0.01398348791607,-0.01398348791607,-0.01398348791607,-0.01398348791607,-0.01398348791607,-0.01398348791607,-0.01398348791607,-0.01398348791607,-0.010803174873801,-0.010803174873801,-0.010803174873801,-0.011730452207564,-0.012519409266369,-0.013059320512023,-0.01398348791607,-0.015472025974251,-0.026091269226534,-0.018802459337481,-0.018802459337481,-0.026091269226534,-0.026091269226534,-0.020245477254042)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.026718667177529,0.037529143356757,0.042043040125593,0.052968742423636,0.055208324370056,0.043954599829243,0.038446572635158,0.038033728139776,0.03782451880992,0.03782451880992,0.038446572635158,0.038446572635158,0.038033728139776,0.03782451880992,0.03782451880992,0.03782451880992,0.03782451880992,0.03782451880992,0.03782451880992,0.03782451880992,0.03782451880992,0.03782451880992,0.03782451880992,0.03782451880992,0.03782451880992,0.03782451880992,0.037968259011948,0.037968259011948,0.037968259011948,0.037968259011948,0.037968259011948,0.037968259011948,0.037968259011948,0.038033728139776,0.038033728139776,0.038033728139776,0.038033728139776,0.038033728139776,0.038033728139776,0.038033728139776,0.038446572635158,0.038446572635158,0.038446572635158,0.038446572635158,0.038446572635158,0.038446572635158,0.038446572635158,0.038446572635158,0.038446572635158,0.038446572635158,0.038446572635158,0.038033728139776,0.038033728139776,0.038033728139776,0.038033728139776,0.038033728139776,0.039283206205307,0.039283206205307,0.039283206205307,0.039080718796743,0.039217803201627,0.039283206205307,0.040339981307046,0.040339981307046,0.040339981307046,0.040339981307046,0.040339981307046,0.040339981307046,0.040524918539323,0.044491261204031,0.044491261204031,0.044491261204031,0.043954599829243,0.043954599829243,0.043954599829243,0.046829794745436,0.052301872244268,0.069184171686932,0.087893924720849,0.109403675129378,0.155348264793136,0.359220918859009,0.939446256390466)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.074478364969505,0.074129823603642,0.074168497578371,0.074364880270906,0.074463071756928,0.074518370684237,0.07457845762412,0.074638894748735,0.074679484723359,0.074679484723359,0.0746444406593,0.0746444406593,0.074694107854837,0.074694107854837,0.074694107854837,0.074711454372002,0.074711454372002,0.074702876772072,0.074704492424173,0.074709155190108,0.074709155190108,0.074709155190108,0.074709155190108,0.074709155190108,0.074709155190108,0.074693103346057,0.074693103346057,0.074676645230274,0.074676645230274,0.074657702867238,0.074657702867238,0.074657702867238,0.074657702867238,0.074695280670708,0.074677253714833,0.074677253714833,0.074677253714833,0.074657110660521,0.074657110660521,0.074657110660521,0.074687667409769,0.074687667409769,0.074687667409769,0.07466629740439,0.07466629740439,0.07466629740439,0.07466629740439,0.074654277141791,0.074654277141791,0.074654277141791,0.074694292578749,0.074694292578749,0.074845884291989,0.074845884291989,0.074852337735533,0.07502399958295,0.075082920219875,0.075336049746888,0.075503810776273,0.07564931468311,0.075659516029949,0.075659516029949,0.075744762082098,0.075744762082098,0.075744762082098,0.075744762082098,0.075744762082098,0.075744762082098,0.075700517763066,0.075692401215065,0.075692401215065,0.075726127324945,0.07595960243414,0.076134939707319,0.076229694881076,0.077302135019991,0.078620554730908,0.081163903427551,0.082867714622558,0.08484035398208,0.089502764726376,0.120096827733308,0.280462445650428)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.683994712294158,0.661004587806625,0.593182440069696,0.39024958516408,0.08523409067968,0.066017242621581,0.061403479229827,0.060728855530781,0.06058725306441,0.060606425144349,0.060460141009482,0.060460141009482,0.060460141009482,0.060455556141483,0.060449470252441,0.060451772680006,0.060451772680006,0.060451772680006,0.060435913772298,0.060435913772298,0.060435913772298,0.06041998676978,0.060436893179707,0.060436893179707,0.060436893179707,0.060436893179707,0.060432088223873,0.060432088223873,0.060432088223873,0.060432088223873,0.060432088223873,0.060434494404704,0.060434494404704,0.060434494404704,0.060434494404704,0.060434494404704,0.060434494404704,0.060420657763222,0.060421136947239,0.060421136947239,0.060421136947239,0.060421136947239,0.06046708452618,0.06046708452618,0.060471067401956,0.060465228642877,0.060467783232979,0.060467783232979,0.060467783232979,0.060467783232979,0.060497783765904,0.060573255023904,0.060573255023904,0.060598442600424,0.060611446287465,0.06067565075246,0.06067565075246,0.06067565075246,0.06067565075246,0.060653162685116,0.060653162685116,0.060623463316446,0.060623463316446,0.060623463316446,0.060623463316446,0.060623463316446,0.06059747627269,0.06059747627269,0.06059747627269,0.060631882923464,0.060631882923464,0.060631882923464,0.06059643692574,0.060617944236597,0.060624457501088,0.060614455083902,0.060689192643473,0.06066793102651,0.060628652116181,0.060564414552052,0.060437914881848,0.060206092367616,0.060193895765875)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.609516347324653,-0.586874764202983,-0.519013942491324,-0.315884704893174,-0.010771018922753,0.008501128062656,0.013174978394293,0.013910039217954,0.01409223165895,0.014073059579011,0.014184299649818,0.014184299649818,0.014233966845355,0.014238551713354,0.014244637602396,0.014259681691996,0.014259681691996,0.014251104092065,0.014268578651875,0.01427324141781,0.01427324141781,0.014289168420327,0.014272262010401,0.014272262010401,0.014272262010401,0.01425621016635,0.014261015122184,0.014244557006401,0.014244557006401,0.014225614643365,0.014225614643365,0.014223208462534,0.014223208462534,0.014260786266004,0.014242759310129,0.014242759310129,0.014242759310129,0.0142364528973,0.014235973713282,0.014235973713282,0.01426653046253,0.01426653046253,0.014220582883589,0.01419921287821,0.014195230002434,0.014201068761513,0.01419851417141,0.014186493908812,0.014186493908812,0.014186493908812,0.014196508812845,0.014121037554845,0.014272629268084,0.014247441691565,0.014240891448068,0.01434834883049,0.014407269467415,0.014660398994428,0.014828160023812,0.014996151997994,0.015006353344832,0.015036052713503,0.015121298765652,0.015121298765652,0.015121298765652,0.015121298765652,0.015147285809408,0.015147285809408,0.015103041490376,0.015060518291601,0.015060518291601,0.015094244401481,0.015363165508401,0.015516995470722,0.015605237379988,0.016687679936088,0.017931362087435,0.020495972401041,0.022239062506377,0.024275939430028,0.029064849844528,0.059890735365692,0.220268549884553)
trans=0.5
age=(0:(146-1))* -1
plot(age,age,type = 'n', ylim = c(0, 1.1002689466239857), xlim = c(-153.3,-55.7), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 1.495811054353088), xlim = c(-153.3,-55.7), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-1.4278041031705024, 1.0333908820295126), xlim = c(-153.3,-55.7), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()