# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.000199981960717,0.000199981960717,0.000199981960717,0.003522141831923,0.081833004870268,0.083103839294841,0.083103839294841,0.083103839294841,0.083103839294841,0.084516557285983,0.083857785141763,0.083857785141763,0.083857785141763,0.083857785141763,0.083857785141763,0.083103839294841,0.083103839294841,0.081119980073705,0.087410921413237,0.231607886541197,0.231607886541197,0.063977598071213,0.054234884487331,0.049645118608131,0.049253119899501,0.050719974815127,0.050842957419327,0.050719974815127,0.050719974815127,0.051192954670771,0.050842957419327,0.05142037435884,0.05142037435884,0.05142037435884,0.05142037435884,0.051192954670771,0.050842957419327,0.050842957419327,0.050842957419327,0.05112272026214,0.05112272026214,0.05112272026214,0.05112272026214,0.05112272026214,0.05112272026214,0.05112272026214,0.05112272026214,0.05112272026214,0.050842957419327,0.049989710459274,0.049645118608131,0.049210296063699,0.049210296063699,0.049239440197524,0.041408456558099,0.041310628211489,0.049210296063699,0.051192954670771,0.064551887600107,0.064551887600107,0.06877810097195,0.074923201906909,0.077379507984137,0.077379507984137,0.077379507984137,0.077379507984137,0.077379507984137,0.077379507984137,0.077379507984137,0.077379507984137,0.077379507984137,0.077379507984137,0.077379507984137,0.080259017118505,0.080259017118505,0.080259017118505,0.080259017118505,0.080259017118505,0.083335505425552,0.078496239673375,0.078496239673375,0.077379507984137)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.028476757019122,0.028692587010468,0.036837457968787,0.115847408938395,0.137674848782366,0.124369703956369,0.123345874552931,0.123345874552931,0.122071461150417,0.122071461150417,0.120468690827024,0.120682396813025,0.120682396813025,0.120682396813025,0.120682396813025,0.120468690827024,0.120468690827024,0.122024111247896,0.39939532702345,0.578143784362484,0.57871307673158,0.461856128376896,0.394164654553593,0.289103721383868,0.120455080870827,0.116749247637011,0.11405217388578,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112797474536954,0.112738114020533,0.112797474536954,0.112738114020533,0.113963264774439,0.116299223013041,0.116749247637011,0.163274341475592,0.193561421732837,0.207610970688814,0.21776365570695,0.21690756645819,0.221439647592386,0.228981661814783,0.231140929720993,0.228981661814783,0.228981661814783,0.228981661814783,0.228981661814783,0.230583827859364,0.231140929720993,0.231140929720993,0.230583827859364,0.230583827859364,0.2319980041309,0.235281503206746,0.235281503206746,0.236947358909994,0.236947358909994,0.236947358909994,0.244137259437469,0.241301494923188,0.251137982430958,0.264489728486947)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.189463285111513,0.157909927094605,0.120425962410471,0.141113695332549,0.141113695332549,0.139859870585218,0.139562136406475,0.145780456581439,0.145803276529871,0.171699359814658,0.055976314011813,0.057616541374201,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057905002491161,0.057638934911111,0.057616541374201,0.057616541374201,0.057287274042892,0.057287274042892,0.057287274042892,0.057287274042892,0.057287274042892,0.057287274042892,0.05893432246139,0.058431540244803,0.058431540244803,0.058431540244803,0.058431540244803,0.058179888070753,0.058179888070753,0.058179888070753,0.058179888070753,0.058431540244803,0.058179888070753,0.058179888070753,0.058019302770115,0.058019302770115,0.057616541374201,0.057616541374201,0.057377287959356,0.056979003846619,0.056979003846619,0.056341181719336)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.488776289991795,0.425404221344065,0.293002755936577,0.278725585389432,0.278725585389432,0.276322852198345,0.276322852198345,0.284966447470426,0.367772292708457,0.445113027579939,0.219538486969826,0.080791494964011,0.080633921080516,0.080633921080516,0.080633921080516,0.080633921080516,0.080633921080516,0.080633921080516,0.080633921080516,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080791494964011,0.080633921080516,0.080633921080516,0.080791494964011,0.080633921080516,0.080633921080516,0.080633921080516,0.080633921080516,0.080633921080516,0.080633921080516,0.082435018201462,0.0820667369228,0.0820667369228,0.0820667369228,0.0820667369228,0.0820667369228,0.0820667369228,0.082335641540003,0.082335641540003,0.082814695820956,0.082741657131724,0.082814695820956,0.082814695820956,0.082814695820956,0.082741657131724,0.082814695820956,0.082814695820956,0.082666012707452,0.082814695820956,0.082741657131724)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.465223812169961,-0.423046010793124,-0.282436559447863,-0.264109644757748,-0.181008475201675,-0.181008475201675,-0.181008475201675,-0.18646124525565,-0.279231760547594,-0.35417446795557,-0.122930324808813,0.010586105821322,0.009502602775317,0.009502602775317,0.009502602775317,0.008928090935944,0.008928090935944,0.008739445103086,0.008739445103086,0.1612261899452,0.168381094437713,-0.009473307802234,-0.019397899414094,-0.027319899752123,-0.02440878164715,-0.023394076046321,-0.017464205947994,-0.016255257500266,-0.016255257500266,-0.016532458819729,-0.016532458819729,-0.020744744526145,-0.020926004593013,-0.019474217278302,-0.019474217278302,-0.020926004593013,-0.020926004593013,-0.016532458819729,-0.016532458819729,-0.016951463167045,-0.016951463167045,-0.016951463167045,-0.016951463167045,-0.016951463167045,-0.016951463167045,-0.016951463167045,-0.016951463167045,-0.016951463167045,-0.017464205947994,-0.019474217278302,-0.018381008131605,-0.018976985281279,-0.019474217278302,-0.021998936503021,-0.027319899752123,-0.029328344538783,-0.02440878164715,-0.013544925020067,-0.01004476508918,-0.004903433380979,-0.003578096501283,0.003726457793617,0.004584074408342,0.007822217914672,0.007822217914672,0.007822217914672,0.007822217914672,0.007455920857165,0.007455920857165,0.005172732432931,0.005398708165232,0.005172732432931,0.004810832951515,0.004810832951515,0.004017379224348,0.005172732432931,0.005172732432931,0.004810832951515,0.004810832951515,0.004810832951515,0.004017379224348,0.004810832951515)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.16968136273735,-0.147822411521249,-0.090874027826027,-0.068123345743692,-0.03414222532718,-0.033129458948644,-0.033129458948644,-0.034062587239782,-0.02927133836528,-0.064488113484578,0.057351487135385,0.057781405003215,0.055967299398059,0.055967299398059,0.055967299398059,0.055617527619667,0.055617527619667,0.058631853887533,0.325473866728804,0.509259865666137,0.518358609498246,0.388417483452669,0.325086579976312,0.217038526147929,0.054457000257346,0.04964546026113,0.04964546026113,0.04964546026113,0.04964546026113,0.04964546026113,0.04964546026113,0.044860891860464,0.044062409492366,0.044860891860464,0.044860891860464,0.044062409492366,0.044335931973606,0.04964546026113,0.04964546026113,0.049480434467788,0.049480434467788,0.049480434467788,0.049480434467788,0.049480434467788,0.049480434467788,0.049480434467788,0.049480434467788,0.04964546026113,0.049480434467788,0.047849672182879,0.04964546026113,0.049408176777063,0.04964546026113,0.04964546026113,0.04964546026113,0.090455551405949,0.121225839518855,0.140859110784197,0.146499622438975,0.149668833562186,0.151433261258038,0.157616891497622,0.160363992523573,0.163544584851501,0.163544584851501,0.163544584851501,0.163544584851501,0.163627361146663,0.164401452964985,0.163627361146663,0.163627361146663,0.163627361146663,0.164401452964985,0.166097568994422,0.166097568994422,0.16942776155692,0.16942776155692,0.16942776155692,0.173327912866039,0.176925240440779,0.188268602230809,0.207609493730964)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.01134469626908,0.01145370956847,0.014719496621954,0.065679179523083,0.100953614107973,0.104892512759179,0.104795148172592,0.104904088067388,0.104798858207451,0.104059651580899,0.101711641112205,0.10166672473411,0.101633792115754,0.101633792115754,0.101633792115754,0.101670389658203,0.101670389658203,0.103748443613266,0.231993410253779,0.376779023204745,0.377667285599563,0.303274347037186,0.1984620142805,0.10054038766673,0.086568416312924,0.084549286009311,0.081915170574453,0.081068209026953,0.081068209026953,0.080951776956037,0.080756600323563,0.080303775723274,0.080061975930781,0.079821899545188,0.079709626901831,0.07956958896613,0.079359352483037,0.079237440497222,0.079237440497222,0.079167394814291,0.079184536763784,0.079185269798343,0.079142476867882,0.079142476867882,0.079142476867882,0.079142476867882,0.079111283687569,0.079079388005141,0.079036524232953,0.078928021644574,0.07891571415157,0.07905119887092,0.079528867834375,0.08014312001524,0.081464051533637,0.087661604700726,0.103005361840296,0.124909966581026,0.13745324851523,0.140941890693335,0.14704931448878,0.152246597780325,0.156491075334488,0.157002292304453,0.156971802439463,0.157185714224543,0.157300909305412,0.157390904850717,0.157627587872016,0.157878201921888,0.158569980461738,0.159074094800237,0.159471309075185,0.159782720436251,0.160162321129114,0.161174066566311,0.161150972172353,0.1610912415387,0.162509824511068,0.163038028859279,0.168996361283044,0.178881630544718)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.271642848831893,0.25334862886868,0.232723788015828,0.223472034534047,0.223267153398947,0.223053849391364,0.223269881127141,0.225886315113446,0.244198764553188,0.254500564023262,0.084803981098973,0.069753196734094,0.069240251290968,0.069240251290968,0.069234111868594,0.069234111868594,0.069234111868594,0.069234111868594,0.069234111868594,0.069249581743197,0.069249581743197,0.069249581743197,0.069235018198332,0.069235018198332,0.069235018198332,0.069235018198332,0.069214212915345,0.069214212915345,0.069214212915345,0.069214212915345,0.069214212915345,0.0692173070028,0.0692173070028,0.0692173070028,0.0692173070028,0.069220418031857,0.069220418031857,0.069224657906081,0.069224657906081,0.069213465337821,0.069213465337821,0.069213465337821,0.069213465337821,0.06920063416752,0.06920063416752,0.06920063416752,0.06920063416752,0.069228778446551,0.069231418657467,0.069231418657467,0.069231418657467,0.069231418657467,0.069231418657467,0.069268873867916,0.069301502769451,0.069372223702903,0.069410119724519,0.069410119724519,0.069410119724519,0.069410119724519,0.069410119724519,0.069410119724519,0.069387551910668,0.069408564055524,0.069408564055524,0.069408564055524,0.069414763211799,0.06954955832409,0.06954955832409,0.069777138593215,0.069777138593215,0.069870231164358,0.070169862263494,0.070201634912158,0.070282360751199,0.070282360751199,0.070309157530671,0.070449912524348,0.07040151776762,0.070298655739961,0.070256250028988,0.070158530679373)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.260298152562812,-0.24189491930021,-0.218004291393874,-0.157792855010964,-0.122313539290974,-0.118161336632185,-0.118474732954549,-0.120982227046057,-0.139399906345736,-0.150440912442363,0.016907660013231,0.031913528000016,0.032393540824786,0.032393540824786,0.032399680247161,0.032436277789609,0.032436277789609,0.034514331744672,0.162759298385185,0.307529441461548,0.308417703856366,0.234024765293988,0.129226996082168,0.031305369468398,0.017333398114592,0.015314267810979,0.012700957659108,0.011853996111608,0.011853996111608,0.011737564040692,0.011542387408218,0.011086468720474,0.010844668927981,0.010604592542389,0.010492319899031,0.010349170934273,0.01013893445118,0.01001278259114,0.01001278259114,0.00995392947647,0.009971071425963,0.009971804460522,0.009929011530061,0.009941842700361,0.009941842700361,0.009941842700361,0.009910649520049,0.00985060955859,0.009805105575486,0.009696602987107,0.009684295494103,0.009819780213453,0.010297449176908,0.010874246147324,0.012162548764186,0.018289380997823,0.033595242115776,0.055499846856507,0.06804312879071,0.071531770968816,0.077639194764261,0.082836478055806,0.087103523423821,0.087593728248929,0.087563238383939,0.087777150169019,0.087886146093613,0.087841346526626,0.088078029547926,0.088101063328674,0.088792841868523,0.089203863635879,0.089301446811691,0.089581085524093,0.089879960377915,0.090891705815113,0.090841814641682,0.090641329014352,0.092108306743448,0.092739373119318,0.098740111254056,0.108723099865345)
trans=0.5
age=(0:(146-1))* -1
plot(age,age,type = 'n', ylim = c(0, 0.6365843844047381), xlim = c(-153.3,-56.7), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 0.5376539189909746), xlim = c(-153.3,-56.7), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-0.5117461933869571, 0.5701944704480706), xlim = c(-153.3,-56.7), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()