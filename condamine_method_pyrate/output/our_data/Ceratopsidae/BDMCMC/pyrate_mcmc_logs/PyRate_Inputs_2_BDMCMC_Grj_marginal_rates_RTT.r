# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.083249355750056,0.082876198839224,0.082876198839224,0.082876198839224,0.083249355750056,0.083689303169046,0.083689303169046,0.083689303169046,0.083689303169046,0.082876198839224,0.082876198839224,0.084597873666966,0.067536187341402,0.083249355750056,0.085907234438676,0.085640199857868,0.089403911253452,0.104611167838482,0.124841149427069,0.124294126488957,0.124294126488957,0.120741492838233,0.105938067851669,0.093375374323787,0.105938067851669,0.085445168484035)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.173648716767674,0.172334100937195,0.172334100937195,0.172334100937195,0.172334100937195,0.172334100937195,0.172062495929704,0.172062495929704,0.172062495929704,0.172334100937195,0.172334100937195,0.175726860934405,0.175726860934405,0.328856212291187,0.355863323668733,0.391367758887102,0.67598601164997,0.990388900475108,0.990388900475108,0.898819061464707,0.837389587911272,0.837389587911272,0.820646423313863,0.820646423313863,0.820646423313863,0.820646423313863)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.073646025061076,0.083379420006567,0.077399918250212,0.077399918250212,0.088039719125516,0.10168721454124,0.064304078550259,0.068257220664395,0.061332544615171,0.056629084001292,0.060626737402277,0.059166473492568,0.061332544615171,0.061332544615171,0.060626737402277,0.056629084001292,0.051310773957577,0.039196170674482,0.033378301125653,0.027745969203995,0.027745969203995,0.027745969203995,0.016496613339878,0.011750386787288,0.010087388354468,0.008029641674498)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,1.164894592802857,0.312113747527726,0.310111246016483,0.310111246016483,0.327359609934789,0.653085286772447,0.549434369250792,0.324617603964449,0.254198867340774,0.202466292702067,0.185956617569818,0.183826074674655,0.18272927387477,0.182157926719226,0.1816275969812,0.179692860568163,0.179692860568163,0.18272927387477,0.18272927387477,0.182157926719226,0.18272927387477,0.18272927387477,0.173878475269448,0.17302544422457,0.173878475269448,0.179692860568163)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-1.030316065560454,-0.188677455928968,-0.192293582610549,-0.192293582610549,-0.211136158782542,-0.538753714854506,-0.413256438456897,-0.214228341582962,-0.131302875344923,-0.100255964483678,-0.076802228975847,-0.071560739299883,-0.071560739299883,-0.071421694143533,-0.071560739299883,-0.071560739299883,-0.053296342198459,-0.016131237246236,0.0148157094832,0.013867488948522,0.0120968374553,0.0148157094832,0.015015905539781,-0.010818083770511,-0.010818083770511,-0.042160059432223)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.07620877512329,0.056946267968877,0.056590300003358,0.056946267968877,0.047156177376097,0.057638904362605,0.064714291945702,0.065923213029722,0.082040593507383,0.075545799831757,0.082040593507383,0.086618743674548,0.098864362963946,0.232717062876404,0.255202542043618,0.282875435676948,0.570999036175028,0.915968545950941,0.889943785459134,0.812251761625827,0.733784040600816,0.733784040600816,0.733784040600816,0.733784040600816,0.733784040600816,0.777944109836823)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.126600636366665,0.125856567620281,0.125906007128091,0.125908009324268,0.125850957760363,0.125860719109498,0.125759678213759,0.125788847703136,0.125792896217903,0.125706853650652,0.125752187989029,0.126839185927777,0.130828714598726,0.16047521900554,0.170306649031146,0.184337221930078,0.313766964878527,0.484910683480453,0.50570793035255,0.480361531403206,0.460400240777128,0.453765995566908,0.452403251081958,0.454356821658858,0.457181193432188,0.465029275803632)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.288550593958948,0.19558409689725,0.195054916415806,0.19521477889165,0.197549474597728,0.256105781578822,0.238568322500711,0.186422934515228,0.140767905217809,0.123995955273285,0.119023094277364,0.117676053215271,0.116551231513457,0.115440382567066,0.112712090876075,0.111697793913897,0.110169771606399,0.106434935832505,0.105558671928243,0.105679084386485,0.105864903754834,0.106000185344009,0.106483109112491,0.107789806310022,0.109150998715116,0.116420154064979)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.161949957592283,-0.069727529276968,-0.069148909287715,-0.069306769567382,-0.071698516837365,-0.130245062469324,-0.112808644286952,-0.060634086812092,-0.014975008999905,0.001710898377367,0.006729093711664,0.009163132712505,0.014277483085269,0.045034836438474,0.057594558155071,0.072639428016181,0.203597193272128,0.378475747647948,0.400149258424308,0.374682447016722,0.354535337022293,0.347765810222899,0.345920141969467,0.346567015348836,0.348030194717072,0.348609121738654)
trans=0.5
age=(0:(93-1))* -1
plot(age,age,type = 'n', ylim = c(0, 1.0894277905226188), xlim = c(-97.65,-62.35), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 1.2813840520831428), xlim = c(-97.65,-62.35), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-1.1333476721164994, 1.0075654005460353), xlim = c(-97.65,-62.35), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()