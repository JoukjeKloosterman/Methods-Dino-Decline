# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.069226596516758,0.06707929763945,0.069226596516758,0.069226596516758,0.069492066538123,0.070020206857199,0.07020042538677,0.07020042538677,0.070941341335113,0.070941341335113,0.070941341335113,0.072442856486034,0.072442856486034,0.072307725936148,0.072307725936148,0.072307725936148,0.072307725936148,0.072307725936148,0.072307725936148,0.072307725936148,0.072307725936148,0.072442856486034,0.072307725936148,0.072442856486034,0.069226596516758,0.072442856486034,0.072442856486034,0.072442856486034,0.072442856486034,0.072442856486034,0.072442856486034,0.072442856486034,0.072442856486034,0.072442856486034,0.072442856486034,0.072442856486034,0.072442856486034,0.072442856486034,0.072442856486034,0.072442856486034,0.072442856486034,0.072442856486034,0.072442856486034,0.072442856486034,0.069492066538123,0.069492066538123,0.069492066538123,0.069492066538123,0.069226596516758,0.069226596516758,0.069226596516758,0.072442856486034,0.072442856486034,0.069919285170621,0.069919285170621,0.069492066538123,0.069492066538123,0.069492066538123,0.068955336017207,0.068955336017207,0.068955336017207,0.06692505045934,0.069919285170621,0.069492066538123,0.068955336017207,0.068955336017207,0.06692505045934,0.06692505045934,0.062761188251749,0.059610315684317,0.053870871075528,0.047195201464855,0.058531221643688,0.047195201464855)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.143202591451215,0.139670483370455,0.140295501464267,0.139404538656977,0.139404538656977,0.139404538656977,0.139404538656977,0.139404538656977,0.139670483370455,0.139670483370455,0.139670483370455,0.140629465250358,0.140629465250358,0.139670483370455,0.139670483370455,0.139670483370455,0.139404538656977,0.139670483370455,0.140295501464267,0.140295501464267,0.140295501464267,0.140629465250358,0.140629465250358,0.140629465250358,0.137173313995687,0.140295501464267,0.140295501464267,0.139670483370455,0.139670483370455,0.139670483370455,0.139670483370455,0.139670483370455,0.139670483370455,0.139670483370455,0.139670483370455,0.139670483370455,0.139404538656977,0.139404538656977,0.139670483370455,0.139670483370455,0.139670483370455,0.139670483370455,0.139670483370455,0.139670483370455,0.137173313995687,0.137173313995687,0.137173313995687,0.137173313995687,0.137173313995687,0.137173313995687,0.137173313995687,0.140629465250358,0.140629465250358,0.139404538656977,0.139404538656977,0.139404538656977,0.140629465250358,0.142356670627808,0.142356670627808,0.143202591451215,0.143202591451215,0.143202591451215,0.147241585391767,0.147241585391767,0.147241585391767,0.147241585391767,0.147981608800338,0.14949008734166,0.147981608800338,0.14949008734166,0.14949008734166,0.14949008734166,0.172864559924548,0.184165884902052)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.062212295310782,0.062212295310782,0.062212295310782,0.062758973389659,0.062212295310782,0.067303846352029,0.067303846352029,0.067303846352029,0.062112588866563,0.053985227192936,0.041729679834501,0.037325339014272,0.036479769117827,0.028392539808097,0.029904943221617,0.028392539808097,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.030485220566291,0.029904943221617,0.029904943221617,0.030700316770207,0.031208469667069,0.032276786862253,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.031208469667069,0.031208469667069,0.031208469667069,0.029904943221617,0.031208469667069,0.031208469667069,0.031208469667069,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.031208469667069,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.029904943221617,0.031747395502294,0.031208469667069,0.030700316770207)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.453403644723463,0.387391720487457,0.379253120974785,0.379253120974785,0.378143040783607,0.379253120974785,0.375437151497328,0.375437151497328,0.367944355630844,0.357116460559111,0.327858097258015,0.301206788602719,0.275333252442668,0.213812703770693,0.171293267733931,0.147623281977277,0.141681047600673,0.127411338719862,0.117690088356367,0.112203506627799,0.110339256093527,0.108811106893249,0.107432128810908,0.105515621110694,0.10412081511729,0.103445467029409,0.103445467029409,0.103445467029409,0.100284523418812,0.100090009748306,0.100090009748306,0.100090009748306,0.099486313805612,0.09963504474956,0.099486313805612,0.100284523418812,0.100284523418812,0.100284523418812,0.099164887959046,0.100284523418812,0.100284523418812,0.100284523418812,0.098223068970773,0.098223068970773,0.098148975647684,0.098148975647684,0.098148975647684,0.098148975647684,0.098148975647684,0.098148975647684,0.098148975647684,0.098148975647684,0.098148975647684,0.098148975647684,0.098148975647684,0.098223068970773,0.100284523418812,0.099164887959046,0.099164887959046,0.099164887959046,0.099164887959046,0.099164887959046,0.099486313805612,0.099486313805612,0.099486313805612,0.099486313805612,0.099486313805612,0.099486313805612,0.100090009748306,0.100090009748306,0.100284523418812,0.103445467029409,0.103352379497382,0.103445467029409)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.365000016032923,-0.301133658411476,-0.289896351655414,-0.286814178800458,-0.283262373460622,-0.28258242251225,-0.281091052256226,-0.280892133118127,-0.277095331389113,-0.257770926768124,-0.225905357648654,-0.211448506790614,-0.178053705874336,-0.123093570358574,-0.081356574086435,-0.062862323075851,-0.048221006517868,-0.030852561900382,-0.02895877116116,-0.024455334996596,-0.025858267187841,-0.024455334996596,-0.018704917201055,-0.018704917201055,-0.017136064822065,-0.015848228706857,-0.016126012592565,-0.015848228706857,-0.017136064822065,-0.017136064822065,-0.017136064822065,-0.012684927932648,-0.010990798405787,-0.010546563647377,-0.010546563647377,-0.010990798405787,-0.010546563647377,-0.010546563647377,-0.010990798405787,-0.010990798405787,-0.010990798405787,-0.010990798405787,-0.010990798405787,-0.010546563647377,-0.010546563647377,-0.010546563647377,-0.010546563647377,-0.010546563647377,-0.010546563647377,-0.010546563647377,-0.010546563647377,-0.010990798405787,-0.011337938201175,-0.012980686894008,-0.012980686894008,-0.012164396660204,-0.012684927932648,-0.012980686894008,-0.012980686894008,-0.016126012592565,-0.016126012592565,-0.018704917201055,-0.018704917201055,-0.024455334996596,-0.024455334996596,-0.024455334996596,-0.024163498649914,-0.02539024898636,-0.02895877116116,-0.02895877116116,-0.02895877116116,-0.02895877116116,-0.035532416610034,-0.096176292024365)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.055603154151314,0.045071607889022,0.045071607889022,0.045071607889022,0.045071607889022,0.045071607889022,0.045071607889022,0.045071607889022,0.045104952105342,0.059601918606309,0.076380046780372,0.078850340180239,0.092561419940709,0.095551573379049,0.098707147653171,0.092561419940709,0.095551573379049,0.10018367901088,0.090970492852115,0.090970492852115,0.087466418469622,0.087466418469622,0.090605692199935,0.088380035922446,0.088380035922446,0.087466418469622,0.087466418469622,0.086377664898249,0.08409243382718,0.08409243382718,0.08409243382718,0.087466418469622,0.088380035922446,0.087466418469622,0.087466418469622,0.086704552837421,0.086704552837421,0.086704552837421,0.086704552837421,0.086704552837421,0.086704552837421,0.086704552837421,0.086704552837421,0.087437783460105,0.087437783460105,0.087437783460105,0.087437783460105,0.087437783460105,0.087466418469622,0.087466418469622,0.087466418469622,0.087466418469622,0.087466418469622,0.087466418469622,0.088380035922446,0.090970492852115,0.092647685284216,0.093876478256436,0.094526582232038,0.092647685284216,0.092647685284216,0.092647685284216,0.094526582232038,0.090605692199935,0.090970492852115,0.090970492852115,0.092647685284216,0.092647685284216,0.092647685284216,0.099374016854826,0.110421306398434,0.112016966555886,0.123961889548623,0.123961889548623)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.10526515657291,0.104830279669742,0.104438857075564,0.104458246960791,0.104424180158165,0.104524870268782,0.10448384671175,0.10448384671175,0.104407819351588,0.104365630865309,0.104253851973921,0.104041304618214,0.103903333332254,0.103624310805374,0.103624310805374,0.103624310805374,0.103562720867841,0.103485999407335,0.10343997200375,0.103433628840601,0.103433628840601,0.1033600103877,0.103290886087387,0.10311890094089,0.103060120455684,0.103066818296023,0.103068347972314,0.10282222160229,0.102772091039557,0.102772091039557,0.102772091039557,0.102772091039557,0.102772091039557,0.102793742019109,0.102765354684804,0.102765354684804,0.102724001738006,0.10265703358459,0.102594645892539,0.102546886544284,0.102546886544284,0.102546886544284,0.102542924353853,0.102542924353853,0.102733031163863,0.102697035496823,0.102676148949562,0.102676148949562,0.102762150373999,0.102762150373999,0.102762150373999,0.103050518881749,0.103114328714157,0.103641828801274,0.103843940538344,0.103938645750475,0.104406868739079,0.104724569530553,0.104973738038802,0.105560803878586,0.105620543688183,0.106050653086111,0.106452622197868,0.106811932145228,0.10702959003295,0.106927585805136,0.107124545452339,0.107539849002248,0.108090481892574,0.109919907016792,0.110858697753178,0.110944807082334,0.112031995979673,0.118719122105143)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.259731110359753,0.239927771621661,0.236870145526617,0.236511550406705,0.23653544290955,0.235904821315067,0.232854317442167,0.228549004986801,0.216142871339894,0.205097471793115,0.181409000554286,0.14696749375085,0.117219040858278,0.088842366726819,0.078374676176859,0.074765096141239,0.073420206679144,0.071263680899793,0.070064454800265,0.068969017630516,0.068700073899919,0.068297417763742,0.067828559706875,0.067447604817259,0.067229723570486,0.066684720562707,0.066415723120661,0.066034477230595,0.065872198620714,0.065828152353661,0.065698681701234,0.065527651904247,0.065306036844058,0.065059530377876,0.065006202120915,0.064890131701309,0.064890131701309,0.064890131701309,0.064841267370007,0.064758749376348,0.064758749376348,0.064752892207263,0.064698790490491,0.064689792204785,0.064622985841889,0.064622985841889,0.064596355196998,0.064576979808665,0.064548878169949,0.06457071047823,0.06457071047823,0.06457071047823,0.06457071047823,0.06457071047823,0.064595889768115,0.06467365338753,0.064631323333256,0.064725426288004,0.064725426288004,0.064725426288004,0.064725426288004,0.064751823318353,0.064835222238959,0.064860515757481,0.064880783700565,0.064880783700565,0.064880783700565,0.064880783700565,0.065075399718709,0.065075399718709,0.065329095150844,0.065705159863807,0.065820268530892,0.066230852841199)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.154465953786842,-0.135097491951919,-0.132431288451053,-0.132053303445914,-0.132111262751385,-0.131379951046285,-0.128370470730418,-0.124065158275052,-0.111735051988306,-0.100731840927806,-0.077155148580365,-0.042926189132636,-0.013315707526024,0.014781944078554,0.025249634628514,0.028859214664135,0.030142514188698,0.032222318507541,0.033375517203485,0.034464611210085,0.034733554940682,0.035062592623958,0.035462326380513,0.035671296123632,0.035830396885199,0.036382097733315,0.036652624851653,0.036787744371695,0.036899892418843,0.036943938685896,0.037073409338323,0.03724443913531,0.037466054195498,0.037734211641233,0.037759152563889,0.037875222983495,0.037833870036697,0.03776690188328,0.037753378522532,0.037788137167936,0.037788137167936,0.037793994337022,0.037844133863362,0.037853132149069,0.038110045321974,0.038074049654934,0.038079793752564,0.038099169140897,0.038213272204049,0.038191439895769,0.038191439895769,0.038479808403519,0.038543618235927,0.039071118323045,0.039248050770229,0.039264992362945,0.039775545405823,0.039999143242549,0.040248311750798,0.040835377590581,0.040895117400179,0.041298829767758,0.041617399958909,0.041951416387748,0.042148806332385,0.042046802104571,0.042243761751774,0.042659065301683,0.043015082173865,0.044844507298084,0.045529602602334,0.045239647218527,0.046211727448781,0.052488269263944)
trans=0.5
age=(0:(141-1))* -1
plot(age,age,type = 'n', ylim = c(0, 0.2025824733922572), xlim = c(-148.05,-59.95), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 0.49874400919580936), xlim = c(-148.05,-59.95), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-0.4015000176362153, 0.1363580785034853), xlim = c(-148.05,-59.95), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()