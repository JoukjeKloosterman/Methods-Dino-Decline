# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.082039064539861,0.085586836176761,0.086778924084721,0.085586836176761,0.081347774418974,0.081347774418974,0.088530056665142,0.08425246508228,0.08425246508228,0.084987083438854,0.084987083438854,0.084987083438854,0.08425246508228,0.085992200867328,0.082427249416905,0.072064504341168,0.26021422250862,0.129608212697466,0.03937163696598,0.042390428002723,0.048017883961544,0.04227542479029,0.04227542479029,0.035179938923018,0.0200782651958,0.017082802226607,0.010363995140714,0.009369442526343,0.008306991599952,0.00540366333783,0.00540366333783,0.00578953878502,0.009768430348859,0.006301143977365,0.008306991599952,0.009768430348859,0.009231636057223,0.00540366333783,0.006301143977365,0.006301143977365,0.00578953878502,0.00578953878502,0.00578953878502,0.00578953878502,0.00540366333783,0.00540366333783,0.00540366333783,0.00540366333783,0.00540366333783,0.00540366333783,0.00578953878502,0.006301143977365,0.006301143977365,0.006301143977365,0.006301143977365,0.006301143977365,0.00578953878502,0.006301143977365,0.006301143977365,0.006301143977365,0.006301143977365,0.006301143977365,0.00578953878502,0.00578953878502,0.00540366333783,0.00540366333783,0.008656851202369,0.008656851202369,0.009231636057223,0.009231636057223,0.009231636057223,0.008306991599952,0.00540366333783,0.00578953878502)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.226725654470592,0.205533995679691,0.195298519953591,0.192148920696129,0.185363914750066,0.17992717723685,0.173373046185699,0.16441161657439,0.16441161657439,0.16441161657439,0.16441161657439,0.16441161657439,0.16441161657439,0.167225568645991,0.167225568645991,0.421404754085702,1.372120602071074,1.336444607301346,0.784967739038241,0.65234200085971,0.633432581391394,0.623032073058296,0.623032073058296,0.604859967126779,0.579741713269552,0.564697351719965,0.523012153464145,0.475051790885673,0.444668459928165,0.368236663921499,0.245532262039582,0.183927577046461,0.16512719508366,0.150826831020932,0.148863799996984,0.146894739074434,0.14599489696771,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.141689999840762,0.14599489696771,0.14599489696771,0.146894739074434,0.147386091459985,0.147794764683315,0.147794764683315,0.147386091459985,0.154274102728066)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.154892104890213,0.197265293785725,0.201303207313572,0.201170999985039,0.201170999985039,0.199893672611115,0.061155363010947,0.055368864447407,0.047408007459981,0.050695969125788,0.054977956029494,0.054334305422472,0.054334305422472,0.054334305422472,0.054334305422472,0.054334305422472,0.054334305422472,0.054334305422472,0.054500255388854,0.054334305422472,0.054334305422472,0.050695969125788,0.047408007459981,0.047408007459981,0.042225084641347,0.042225084641347,0.042225084641347,0.042225084641347,0.037147466543767,0.034748767241433,0.034596498909984,0.030830152878405,0.027382953226325,0.012713033890078,0.011070354573438,0.011890495206162,0.006602905854429,0.006602905854429,0.002220873819325,0.002220873819325,0.002220873819325,0.001996920084319,0.002244749870304,0.002244749870304,0.002220873819325,0.001996920084319,0.001996920084319,0.001996920084319,0.001996920084319,0.001996920084319,0.001996920084319,0.002117379992871,0.002117379992871,0.001996920084319,0.001996920084319,0.001996920084319,0.001996920084319,0.001996920084319,0.001996920084319,0.001996920084319,0.001996920084319,0.001996920084319,0.002117379992871,0.002117379992871,0.001996920084319,0.001996920084319,0.002117379992871,0.001996920084319,0.001996920084319,0.001996920084319,0.001996920084319,0.001996920084319,0.001996920084319,0.001996920084319)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,1.484639586254466,0.444086147611889,0.444086147611889,0.444086147611889,0.444086147611889,0.445050721097099,0.379321942026955,0.337895902457202,0.169586096401074,0.126040820945702,0.122342583136706,0.120889628320953,0.120889628320953,0.120889628320953,0.120889628320953,0.120889628320953,0.120889628320953,0.120889628320953,0.122342583136706,0.123515714943609,0.126040820945702,0.124960247300931,0.123515714943609,0.124960247300931,0.126040820945702,0.125670640221802,0.126040820945702,0.128032492671939,0.126040820945702,0.124960247300931,0.124960247300931,0.126040820945702,0.124960247300931,0.112963125333236,0.11381432364835,0.116578502833565,0.112963125333236,0.112963125333236,0.108508406254693,0.107322671508502,0.107221206328711,0.1064544870779,0.1064544870779,0.1064544870779,0.106260535253983,0.105768957369506,0.105768957369506,0.105721471624814,0.10542277201018,0.10542277201018,0.105065749888954,0.105065749888954,0.105065749888954,0.105065749888954,0.105065749888954,0.105065749888954,0.105065749888954,0.105065749888954,0.105065749888954,0.105065749888954,0.105065749888954,0.105065749888954,0.105065749888954,0.105065749888954,0.105065749888954,0.105065749888954,0.105440133181939,0.105440133181939,0.105440133181939,0.105721471624814,0.105721471624814,0.105721471624814,0.106260535253983,0.106260535253983)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-1.351362417051274,-0.31074548558945,-0.297296903816984,-0.297296903816984,-0.296064819572626,-0.298724163194944,-0.26663092401173,-0.225779173036352,-0.048688097383014,-0.021123021478958,-0.016689962926393,-0.013734009970633,-0.013550711514825,-0.013550711514825,-0.016667626133086,-0.029066660791023,0.168303791749661,0.031833069750452,-0.047392102013969,-0.0460438200265,-0.045587980652286,-0.042979817490943,-0.062292316879163,-0.061099502038014,-0.070199014112764,-0.072764688730455,-0.091726224464683,-0.102634509553187,-0.102634509553187,-0.095896541107119,-0.102634509553187,-0.102634509553187,-0.099758729243185,-0.088620655229154,-0.090319400691494,-0.091726224464683,-0.083367787692095,-0.081919360704925,-0.081919360704925,-0.081919360704925,-0.081919360704925,-0.081919360704925,-0.081919360704925,-0.081919360704925,-0.078803245633233,-0.081919360704925,-0.078803245633233,-0.078803245633233,-0.081919360704925,-0.081919360704925,-0.081618696521373,-0.081295276526382,-0.078803245633233,-0.081618696521373,-0.081618696521373,-0.081618696521373,-0.081919360704925,-0.082943791090304,-0.082943791090304,-0.082943791090304,-0.082943791090304,-0.082943791090304,-0.081919360704925,-0.081919360704925,-0.083367787692095,-0.083367787692095,-0.077302070957306,-0.077302070957306,-0.081919360704925,-0.088446395246508,-0.078272451582749,-0.078803245633233,-0.085395686450797,-0.088446395246508)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.087562671189782,-0.035549408792712,-0.035229089380357,-0.035229089380357,-0.035229089380357,-0.035229089380357,0.085142121155667,0.093392222960735,0.105090697664807,0.093392222960735,0.088395422001481,0.089435165537366,0.089435165537366,0.088395422001481,0.088395422001481,0.337984177324871,1.278306496759767,1.238496407073678,0.712593448897173,0.577419369231255,0.551012099599034,0.551012099599034,0.529905169366979,0.522172530839346,0.507225277452594,0.500850202015526,0.447020155978862,0.397679564427415,0.350929157000693,0.309132505804313,0.170971716791414,0.106827106069718,0.087749265617622,0.087749265617622,0.087749265617622,0.087749265617622,0.094389254923961,0.093545815006597,0.093545815006597,0.093545815006597,0.093545815006597,0.093545815006597,0.093545815006597,0.093545815006597,0.097499695153351,0.093545815006597,0.097506134275554,0.098953212500249,0.097506134275554,0.097506134275554,0.097665993134484,0.097665993134484,0.098953212500249,0.097665993134484,0.097665993134484,0.097665993134484,0.097665993134484,0.097665993134484,0.097665993134484,0.097665993134484,0.097665993134484,0.097665993134484,0.097665993134484,0.097665993134484,0.097665993134484,0.097665993134484,0.106904033800521,0.106904033800521,0.103238345931528,0.097665993134484,0.110072358833031,0.111217826257073,0.111217826257073,0.117174295193545)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.141405397161858,0.137327382914044,0.135207214970779,0.134757903429417,0.134703268544514,0.134401697563037,0.129075544065331,0.127074911337121,0.126109487928426,0.125989826774604,0.125805270057707,0.125754347601681,0.125832100252816,0.126272669804859,0.127557972670744,0.152934447324465,0.722042682649208,0.69160286589661,0.380279638612742,0.330097665530464,0.307007305665206,0.301448475595385,0.298732032610284,0.286044193147165,0.252357478654052,0.222186630882794,0.179221169423659,0.145692535617542,0.120759662933593,0.104382767664277,0.089949030281268,0.08352388348484,0.078050220287686,0.074226309113866,0.072222274480985,0.070427683152527,0.069609511039439,0.069445057339806,0.069065402414541,0.069065402414541,0.06926882211356,0.069267663143561,0.069265029054327,0.069229296865407,0.069347985758215,0.069249576790505,0.069249576790505,0.069249576790505,0.069249576790505,0.069249576790505,0.06916767342981,0.069022440495077,0.069039877280606,0.069039877280606,0.068991281760654,0.069108740916851,0.069258951155565,0.069335472362349,0.069230968879955,0.069230968879955,0.069230968879955,0.06927402520872,0.069375540727275,0.069375540727275,0.069511959748455,0.069511959748455,0.069776547913631,0.069776547913631,0.07004271060763,0.07026749773147,0.07061063305221,0.071914618194645,0.07382742672655,0.081617433028182)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.476025611446446,0.305885536500532,0.305097362030144,0.305496477541463,0.306175378510389,0.307800688949191,0.235675953705346,0.153700815083162,0.094554109165479,0.089891624315581,0.087427280401868,0.086920964654351,0.086920964654351,0.086751240092808,0.086687122939439,0.086526280786526,0.086526280786526,0.086526280786526,0.085954541369945,0.085744857189155,0.085435000452275,0.085352858371841,0.084903856525851,0.084422876601433,0.083914903364987,0.083915939034805,0.083822598458912,0.083202083322396,0.082669046125206,0.082098456153351,0.0818684131852,0.08124260207202,0.080766578066374,0.079777449316698,0.077913216428441,0.076166750654065,0.075455041810789,0.074570256199241,0.073235686603753,0.071945824798751,0.07158080775601,0.070703828769668,0.069677152823656,0.069334928877545,0.069030285402865,0.068780712380217,0.068371317112186,0.068144939791498,0.06760287666329,0.067367163275487,0.067356442806294,0.067198682500578,0.067014922101659,0.067078812271695,0.067078812271695,0.066952603254891,0.066952603254891,0.066830968053053,0.066800152464227,0.066791351885249,0.066698479470324,0.066561173288836,0.066437085523285,0.066513602244695,0.066747034627616,0.066747034627616,0.066805459415738,0.066846758472619,0.066846758472619,0.067020900951502,0.067020900951502,0.067046381146447,0.067734279051293,0.067770009987216)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.334620214284587,-0.168558153586488,-0.169890147059365,-0.170738574112046,-0.171472109965875,-0.173398991386153,-0.106600409640015,-0.026625903746042,0.031555378762948,0.036098202459023,0.038377989655839,0.03883338294733,0.038911135598466,0.039521429712051,0.040870849731306,0.066408166537938,0.635516401862682,0.605076585110084,0.294325097242797,0.244352808341309,0.221572305212931,0.216095617223544,0.213828176084434,0.201621316545731,0.168442575289065,0.138270691847989,0.095398570964747,0.062490452295146,0.038090616808387,0.022284311510926,0.008080617096068,0.00228128141282,-0.002716357778688,-0.005551140202832,-0.005690941947455,-0.005739067501538,-0.005845530771349,-0.005125198859435,-0.004170284189212,-0.002880422384211,-0.00231198564245,-0.001436165626107,-0.00041212376933,-0.000105632012138,0.00031770035535,0.000468864410288,0.000878259678319,0.001104636999007,0.001646700127215,0.001882413515018,0.001811230623516,0.001823757994499,0.002024955178947,0.001961065008911,0.001912469488959,0.002156137661961,0.002306347900674,0.002504504309297,0.002430816415729,0.002439616994707,0.002532489409631,0.002712851919884,0.00293845520399,0.002861938482579,0.002764925120839,0.002764925120839,0.002971088497894,0.002929789441012,0.00319595213501,0.003246596779968,0.003589732100708,0.004868237048197,0.006093147675257,0.013847423040966)
trans=0.5
age=(0:(141-1))* -1
plot(age,age,type = 'n', ylim = c(0, 1.5093326622781813), xlim = c(-148.05,-59.95), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 1.6331035448799127), xlim = c(-148.05,-59.95), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-1.4864986587564015, 1.406137146435744), xlim = c(-148.05,-59.95), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()