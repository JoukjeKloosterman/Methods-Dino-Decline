# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.03246601547343,0.03246601547343,0.03246601547343,0.0358291066846,0.0358291066846,0.0358291066846,0.035894206914055,0.035894206914055,0.035894206914055,0.035894206914055,0.035894206914055,0.0358291066846,0.0358291066846,0.036451590848675,0.036451590848675,0.036451590848675,0.0358291066846,0.0358291066846,0.036680212250134,0.0358291066846,0.0358291066846,0.0358291066846,0.0358291066846,0.036680212250134,0.036451590848675,0.036451590848675,0.036451590848675,0.0358291066846,0.0358291066846,0.032527239203691,0.032527239203691,0.032527239203691,0.031711483697998,0.031711483697998,0.031711483697998,0.031711483697998,0.032527239203691,0.032527239203691,0.032527239203691,0.032527239203691,0.031711483697998,0.036451590848675,0.032527239203691,0.032527239203691,0.032527239203691,0.032527239203691,0.032527239203691,0.032527239203691,0.031010122732024,0.031010122732024,0.031010122732024,0.031010122732024,0.03128765807612,0.03128765807612,0.031010122732024,0.031010122732024,0.032527239203691,0.027445833849005,0.027445833849005,0.027445833849005,0.027445833849005,0.026798216358785,0.027478572502299,0.026798216358785,0.026798216358785,0.027445833849005,0.02597551101273,0.02597551101273)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.097848438038574,0.097848438038574,0.097848438038574,0.09928753936279,0.09928753936279,0.09928753936279,0.09928753936279,0.09928753936279,0.09928753936279,0.09928753936279,0.09928753936279,0.09928753936279,0.100228251542712,0.100355270075038,0.100355270075038,0.100355270075038,0.100355270075038,0.100355270075038,0.101807214488915,0.100355270075038,0.100355270075038,0.100355270075038,0.100355270075038,0.101807214488915,0.101807214488915,0.101807214488915,0.101807214488915,0.101807214488915,0.101807214488915,0.09928753936279,0.099405249777215,0.099405249777215,0.099405249777215,0.099405249777215,0.099405249777215,0.099405249777215,0.099405249777215,0.099405249777215,0.099405249777215,0.099405249777215,0.099405249777215,0.104013446663281,0.100355270075038,0.100355270075038,0.100355270075038,0.100355270075038,0.100355270075038,0.100355270075038,0.099405249777215,0.099405249777215,0.099405249777215,0.099405249777215,0.100355270075038,0.100355270075038,0.100355270075038,0.101807214488915,0.104385338376883,0.100228251542712,0.100355270075038,0.100355270075038,0.100355270075038,0.101807214488915,0.104385338376883,0.104385338376883,0.104385338376883,0.106345468355439,0.11150643898242,0.115270577301832)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.195091409979798,0.190863762202259,0.004725903996585,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586,0.003006301072586)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,1.002933777624736,1.012396198895345,0.764325319086444,0.49357758623105,0.21039381865063,0.04112030262048,0.038428769585792,0.038259585778207,0.038259585778207,0.03784078411231,0.03784078411231,0.03784078411231,0.03784078411231,0.036959471401918,0.036959471401918,0.036959471401918,0.036959471401918,0.036959471401918,0.03784078411231,0.03784078411231,0.03784078411231,0.03784078411231,0.03784078411231,0.036959471401918,0.036959471401918,0.036959471401918,0.036959471401918,0.036959471401918,0.036959471401918,0.036883654941447,0.036883654941447,0.036883654941447,0.036883654941447,0.036883654941447,0.036883654941447,0.036883654941447,0.036883654941447,0.036959471401918,0.03784078411231,0.03784078411231,0.03784078411231,0.03808755900616,0.03808755900616,0.03808755900616,0.03808755900616,0.03808755900616,0.03808755900616,0.03808755900616,0.03808755900616,0.03808755900616,0.038259585778207,0.038259585778207,0.038259585778207,0.038259585778207,0.038259585778207,0.038259585778207,0.038259585778207,0.038259585778207,0.038259585778207,0.038259585778207,0.038259585778207,0.038259585778207,0.038259585778207,0.038512313523557,0.038692840041,0.039715531701102,0.039784604351785,0.039890463976276)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.9438842518459,-0.96850919337499,-0.706021718744684,-0.436218172430274,-0.152340064960612,0.013299221277127,0.01532959709203,0.014984432474683,0.013896338911114,0.013896338911114,0.013896338911114,0.013896338911114,0.013896338911114,0.013896338911114,0.013896338911114,0.015543340131734,0.015543340131734,0.015543340131734,0.015543340131734,0.015543340131734,0.015543340131734,0.015543340131734,0.015543340131734,0.015543340131734,0.014984432474683,0.014984432474683,0.014984432474683,0.014984432474683,0.014984432474683,0.014984432474683,0.014296942091172,0.014296942091172,0.014296942091172,0.014296942091172,0.014296942091172,0.014296942091172,0.013896338911114,0.013896338911114,0.013896338911114,0.013896338911114,0.013896338911114,0.013896338911114,0.014110931604259,0.014110931604259,0.014110931604259,0.014110931604259,0.014110931604259,0.013896338911114,0.014110931604259,0.014110931604259,0.013896338911114,0.013896338911114,0.013299221277127,0.013299221277127,0.013299221277127,0.013299221277127,0.013299221277127,0.009079746577532,0.009079746577532,0.009079746577532,0.009079746577532,0.009225949155194,0.008398983013643,0.006689297507626,0.006243911350404,0.001039557818863,-0.006716958544351,0.001039557818863)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.126883129594723,-0.127829986971698,0.073711033767691,0.090691694682545,0.1026447127237,0.088585578478202,0.087268822107863,0.086639555122905,0.085067581094512,0.084708327717796,0.084708327717796,0.084708327717796,0.084708327717796,0.084708327717796,0.084708327717796,0.086952222915553,0.087116016407431,0.087116016407431,0.087268822107863,0.087268822107863,0.087268822107863,0.087268822107863,0.087268822107863,0.087268822107863,0.087116016407431,0.087116016407431,0.087116016407431,0.087268822107863,0.087268822107863,0.087423574519804,0.087268822107863,0.087268822107863,0.087423574519804,0.087423574519804,0.087423574519804,0.087423574519804,0.086639555122905,0.086639555122905,0.086952222915553,0.086952222915553,0.086639555122905,0.086639555122905,0.087423574519804,0.087423574519804,0.087423574519804,0.087423574519804,0.087423574519804,0.087423574519804,0.088724846798137,0.088724846798137,0.088724846798137,0.088724846798137,0.088585578478202,0.088585578478202,0.089283278639693,0.090121619881102,0.090691694682545,0.087423574519804,0.087423574519804,0.087423574519804,0.087423574519804,0.088724846798137,0.088724846798137,0.088724846798137,0.088724846798137,0.088724846798137,0.089527446245583,0.103460115332163)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.066402019940891,0.066402019940891,0.066402019940891,0.065695186356812,0.065695186356812,0.065695186356812,0.065596685612555,0.065596685612555,0.065596685612555,0.065743506439658,0.065743506439658,0.065804273843678,0.065866578699527,0.066062453349954,0.066390047597156,0.066715368861108,0.066789156409149,0.066798136845512,0.066927400352574,0.066966751262571,0.066966751262571,0.066966751262571,0.066966751262571,0.066904840789813,0.066986730577462,0.066887063522352,0.066887063522352,0.066882359501191,0.066882359501191,0.066760533279579,0.066669073560882,0.066669073560882,0.066667460200625,0.066673537903366,0.06670204283103,0.06665995057825,0.066544125111788,0.066538687076261,0.066538687076261,0.066530586536674,0.066609991183247,0.066655291108154,0.066551473740302,0.066541524585429,0.066541524585429,0.066525568522794,0.066525568522794,0.066429458768243,0.066339964896052,0.066349214658091,0.066349214658091,0.066369564368085,0.066292920423264,0.066267789276609,0.066400118484056,0.066622015665199,0.066747815264501,0.066843311002948,0.066770134796917,0.066770134796917,0.066770134796917,0.067667572393903,0.06850716758754,0.068661840836841,0.068661840836841,0.06946172398343,0.071409173558273,0.074165365590754)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.542542299007294,0.533290028020952,0.383546645436607,0.106408394480141,0.037387272910764,0.022151791926429,0.019751879880543,0.019600425320905,0.019260741986076,0.019191429105342,0.019191429105342,0.019193965341568,0.019193965341568,0.019146514119269,0.019146514119269,0.019146514119269,0.019146514119269,0.019146514119269,0.019167119642696,0.019167119642696,0.019167119642696,0.019167119642696,0.019167119642696,0.019156824707739,0.019156824707739,0.019156824707739,0.019145757275757,0.019149960230418,0.019149960230418,0.019089628845031,0.019089628845031,0.019076284136248,0.019076284136248,0.019076284136248,0.019031415986252,0.019031415986252,0.019031415986252,0.019057969693199,0.01909449345936,0.01909449345936,0.01909449345936,0.019100524312005,0.019100524312005,0.01913401017043,0.019121909347313,0.019121909347313,0.019121909347313,0.019121909347313,0.019158689031414,0.019158689031414,0.019226117962806,0.019226117962806,0.019226117962806,0.019226117962806,0.019226117962806,0.019226117962806,0.019226117962806,0.019226117962806,0.019226117962806,0.019226117962806,0.019226117962806,0.019226117962806,0.019226117962806,0.019631504881634,0.019767302625429,0.020076220873632,0.020143344162685,0.02028654301627)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.476140279066403,-0.466888008080061,-0.317144625495717,-0.040713208123328,0.028307913446048,0.043543394430383,0.045844805732013,0.045996260291651,0.04633594362648,0.046552077334316,0.046552077334316,0.04661030850211,0.046672613357959,0.046915939230685,0.047243533477888,0.04756885474184,0.04764264228988,0.047651622726244,0.047760280709878,0.047799631619875,0.047799631619875,0.047799631619875,0.047799631619875,0.047748016082074,0.047829905869724,0.047730238814613,0.047741306246594,0.047732399270773,0.047732399270773,0.047670904434548,0.047579444715851,0.047592789424634,0.047591176064377,0.047597253767117,0.047670626844778,0.047628534591998,0.047512709125536,0.047480717383062,0.047444193616901,0.047436093077314,0.047515497723887,0.047554766796149,0.047450949428298,0.047407514414999,0.047419615238116,0.047403659175482,0.047403659175482,0.04730754942093,0.047181275864639,0.047190525626678,0.047123096695285,0.047143446405279,0.047066802460458,0.047041671313803,0.04717400052125,0.047395897702393,0.047521697301695,0.047617193040142,0.047544016834111,0.047544016834111,0.047544016834111,0.048441454431097,0.049281049624734,0.049030335955207,0.048894538211412,0.049385503109799,0.051265829395588,0.053878822574483)
trans=0.5
age=(0:(135-1))* -1
plot(age,age,type = 'n', ylim = c(0, 0.12679763503201522), xlim = c(-141.75,-60.25), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 1.1136358187848796), xlim = c(-141.75,-60.25), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-1.065360112712489, 0.1138061268653793), xlim = c(-141.75,-60.25), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()