# 1 files combined:
# 	./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates.log

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)

pdf(file='./PyRate_Inputs_2_BDMCMC_Grj_marginal_rates_RTT.pdf',width=10.8, height=8.4)
par(mfrow=c(2,2))
library(scales)
plot_RTT <- function (age,hpd_M,hpd_m,mean_m,color){
    N=100
    beta=(1:(N-1))/N
    alpha_shape=0.25
    cat=1-(beta^(1./alpha_shape))
    for (i in 1:(N-1)){
        trans= 1/N + 2/N
        polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
    }
    lines(rev(age), rev(mean_m), col = color, lwd=3)
}
    
L_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.030524779466807,0.030524779466807,0.030524779466807,0.030524779466807,0.031146104342239,0.031876021438056,0.031592791555868,0.031592791555868,0.031146104342239,0.031592791555868,0.030524779466807,0.030524779466807,0.026376858236347,0.029911067956465,0.030428087509587,0.00745169249797,0.032450891153435,0.033099960298226,0.049374134079071,0.055875693087274,0.040732033173472,0.049374134079071,0.055875693087274)
L_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.40291479660793,0.263338017366587,0.232505012832718,0.199270268586309,0.126177415103084,0.1195793324314,0.114704903797575,0.112056036264094,0.109668471419768,0.109668471419768,0.109668471419768,0.109668471419768,0.109668471419768,0.114704903797575,0.119355587198637,0.336432058988311,0.798920378272561,0.829035575039723,0.869906989164326,0.884900265706555,0.89959812860238,0.938729627323192,1.015132680680122)
M_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.146558763324985,0.152174478625622,0.152893475764596,0.152893475764596,0.152174478625622,0.146558763324985,0.019804768935824,0.015991136337547,0.011675232231854,0.007483544294629,0.011376426456356,0.011376426456356,0.011376426456356,0.011376426456356,0.011376426456356,0.011376426456356,0.011376426456356,0.011376426456356,0.011438179149772,0.011438179149772,0.011438179149772,0.011376426456356,0.011376426456356)
M_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.50104999065278,0.461148134228917,0.452566578250626,0.452566578250626,0.455658408595038,0.457254240299821,0.408411685782044,0.312118713105277,0.272260872237682,0.170629938809764,0.069336105438603,0.067132082442799,0.067061990533057,0.067061990533057,0.067222842040209,0.067484960339971,0.068000395433384,0.068353690784435,0.068353690784435,0.068353690784435,0.068353690784435,0.06846748182225,0.069336105438603)
R_hpd_m95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.424058629631854,-0.412726583340671,-0.404602650404364,-0.414323492682806,-0.384653315841468,-0.384653315841468,-0.349462723715715,-0.248635261879785,-0.199221889389124,-0.09913176933371,-0.013450249093131,-0.014165831537291,-0.013329377893681,-0.013980729423522,-0.014756740646053,-0.038150595828486,-0.014165831537291,0.00262726406615,-0.008231573915879,0.004624546705035,0.004624546705035,0.024456808317101,0.027042949342478)
R_hpd_M95=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.272064911626692,0.014848471947956,-0.024073497860153,-0.044623826897642,-0.053341552283696,-0.059317716772632,0.056333924779314,0.078063225765084,0.087740387303472,0.104209494460588,0.087740387303472,0.084593268269288,0.087740387303472,0.087740387303472,0.090657913351825,0.294799738204345,0.755892898591512,0.812994363094705,0.813014725654063,0.834771831474211,0.863815181275885,0.907522258437088,0.963756231570048)
L_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.128486638390883,0.1000155245241,0.093568407472535,0.090565350506466,0.07769210498538,0.074745085736087,0.073249365435404,0.072724381611882,0.072484680676381,0.072397927628087,0.07197184040639,0.071434020232789,0.070632857680215,0.070542742449162,0.072095070995664,0.098063372218047,0.338326653809766,0.415562941584601,0.443231311062962,0.461782125944808,0.484362340452958,0.504463118717014,0.541684207557734)
M_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.31992910711398,0.28993670094959,0.287350628303986,0.288108424491046,0.290218664315734,0.291254923722788,0.233472231985007,0.142939300453367,0.099420148399527,0.049632559640814,0.038614235686918,0.037478792499744,0.037294366747757,0.037311365565636,0.037320947069386,0.037108277714398,0.036798976783976,0.036697978347726,0.03658957784043,0.036569130731362,0.036546612785183,0.036687641498798,0.03691563970099)
R_mean=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,-0.191442468723097,-0.18992117642549,-0.193782220831451,-0.19754307398458,-0.212526559330354,-0.216509837986701,-0.160222866549603,-0.070214918841485,-0.026935467723146,0.022765367987273,0.033357604719472,0.033955227733045,0.033338490932459,0.033231376883526,0.034774123926278,0.060955094503649,0.30152767702579,0.378864963236875,0.406641733222532,0.425212995213446,0.447815727667775,0.467775477218216,0.504768567856744)
trans=0.5
age=(0:(90-1))* -1
plot(age,age,type = 'n', ylim = c(0, 1.1166459487481342), xlim = c(-94.5,-62.5), ylab = 'Speciation rate', xlab = 'Ma',main='PyRate' )
plot_RTT(age,L_hpd_M95,L_hpd_m95,L_mean,"#4c4cec")
lines(rev(age), rev(L_mean), col = "#4c4cec", lwd=3)
plot(age,age,type = 'n', ylim = c(0, 0.5511549897180581), xlim = c(-94.5,-62.5), ylab = 'Extinction rate', xlab = 'Ma' )
plot_RTT(age,M_hpd_M95,M_hpd_m95,M_mean,"#e34a33")
lines(rev(age), rev(M_mean), col = "#e34a33", lwd=3)
plot(age,age,type = 'n', ylim = c(-0.4664644925950394, 1.0601318547270528), xlim = c(-94.5,-62.5), ylab = 'Net diversification rate', xlab = 'Ma' )
abline(h=0,lty=2,col="darkred")
plot_RTT(age,R_hpd_M95,R_hpd_m95,R_mean,"#504A4B")
lines(rev(age), rev(R_mean), col = "#504A4B", lwd=3)
n <- dev.off()