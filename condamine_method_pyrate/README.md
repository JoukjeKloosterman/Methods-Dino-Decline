# PyRate
This directory contains all the data, scripts and output used in our analysis using PyRate.

## Dependencies
Set up a virtual environment to ensure all dependencies are installed according to this [tutorial](https://github.com/dsilvestro/PyRate/blob/master/tutorials/pyrate_tutorial_0.md).
Before installing the PyRate dependencies, clone the GitHub repository:

```shell
git clone https://github.com/dsilvestro/PyRate.git
```

After activating the virtual environment, install the PyRate depencencies according to this [tutorial](https://github.com/dsilvestro/PyRate/blob/master/tutorials/pyrate_tutorial_0.md).

## Usage
This [template](template_run_analysis.sh) allows you to run the whole analysis that we have applied to PyRate.
It utilizes four different scripts. The first script installs all the R packages used in this analysis. 
The second script generates a fossil occurrence table, the third script generates a PyRate input file, and the last script runs the PyRate commands used in this analysis.

### Install R packages
```shell
Rscript "install_packages.R"
```

### Prepare fossil fccurence data
```

Usage: prepare_pyrate_data.R [options]


Options:
        -i INPUT, --input=INPUT
                Dataset file name.

        -o OUT, --out=OUT
                Output file name [default= PyRate_Inputs.txt].

        -d DIRECTORY, --directory=DIRECTORY
                Output directory.

        -c CLASS, --class=CLASS
                Select class type to include in the analysis.

              Comma separate more classes. eg. Ornithischia,Saurischia

        -r RANK, --rank=RANK
                Select accepted rank to include in the analysis.

              Comma separate more ranks. eg. species,genus

              [default = species,genus]

        -n COUNTRY, --country=COUNTRY
                Select the country to include in the analysis.

              Comma seperate the two letter abriviations. eg. MX,US

        -f FAMILY, --family=FAMILY
                Select the family to include in the analysis.

              Comma seperate more families. eg. Ceratopsidae,Hadrosauridae

        -g DOWNLOAD, --download=DOWNLOAD
                Set T/TRUE to download the latest dinosaur dataset from Paleobiology Database.

        -t TIME, --time=TIME
                Set time interval limit for downloading dataset from Paleobiology Database. eg. 145,66

        -h, --help
                Show this help message and exit
```

### Running PyRate utilities
```
Usage: running_pyrate_utilities.R [options]


Options:
        -i INPUT, --input=INPUT
                PyRate dataset input file name. 

              With four columns:

               1) Taxon name, 2) Max age, 3) Min age, and 4) extinct or extant.

        -p PYRATE, --pyrate=PYRATE
                Path to PyRate utilities R file; pyrate_utilities.r

        -d DIRECTORY, --directory=DIRECTORY
                Output directory.

        -h, --help
                Show this help message and exit
```
### Running PyRate commands
```
Usage: running_pyrate_commands.sh [-i input] [-p pyrate] [-s stages]
Options:
  -i input: Input prefix for PyRate scripts (default: PyRate_Inputs)
  -p pyrate: Path to the PyRate executable (required)
  -s stages: Stages parameter for PyRate (required)
  -h: Display this help message
```

## Output
We have analyzed PyRate for the four different datasets mentioned [here](../README.md). These results can be found in these directories:
```
output/condamine_edited_data
output/condamine_raw_data
output/our_data
output/sakamoto_data
```
The output of an analysis will contain the following files and directories:

```
BDMCMC/
RJMCMC/
PyRate_Inputs.txt
PyRate_Inputs_PyRate.py
PyRate_Inputs_TaxonList.txt
```

This analysis shows both output of the RJMCMC and BDMCMC algorithms, notably, we only described the output from the BDMCMC algorithms. 
In the two directories of the algorithms, you can find a ``pyrate_mcmc_log`` directory, in which a PDF file can be found, containing the plots generated by the algorithms. 

For our report we have adapted the R code provided for each analysis. The code and output can be found [here](output/figures).
## Author
Joukje Kloosterman

## License
Code released under the MIT license. 